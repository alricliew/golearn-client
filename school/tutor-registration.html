<!doctype html>
<html lang="en">

<head>
  <!-- Meta -->
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>GoLearn School</title>
  <meta name=description content="GoLearn School&trade; is Malaysia #1 teaching platform to run your tuition business and manage your lessons. Start now for Free!">
  <meta property=og:title content="GoLearn School">
  <meta property=og:site_name content="GoLearn School">
  <meta property=og:type content=website>
  <meta property=og:url content=https://app.golearn.com.my/school/transaction/ >
  <meta property=og:image content=https://app.golearn.com.my/assets/img/icon-apple-touch-180x180.png>
  <meta property=og:description content="GoLearn School&trade; is Malaysia #1 teaching platform to run your tuition business and manage your lessons. Start now for Free!">
  <link rel=apple-touch-icon sizes=180x180 href=https://app.golearn.com.my/assets/img/icon-apple-touch-180x180.png>
  <link rel=icon type=image/png sizes=32x32 href=https://app.golearn.com.my/assets/img/icon-32x32.png>
  <link rel=icon type=image/png sizes=16x16 href=https://app.golearn.com.my/assets/img/icon-16x16.png>
  <!-- Fonts and icons -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" rel="stylesheet" type="text/css" />
  <script src="https://kit.fontawesome.com/2bdd669e92.js" crossorigin="anonymous"></script>
  <!-- Material Kit CSS -->
  <link href="../assets/css/material-dashboard.css?v=2.1.2" rel="stylesheet" />
  <!-- Firebase Init -->
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-firestore.js"></script>
  <script src="../assets/js/firebase.js"></script>
  <!-- Tutor Portal specific CSS -->
  <link href="../assets/css/tutor-portal.css" rel="stylesheet" />
  <link href="../assets/css/multistepform.css" rel="stylesheet" />
  <link href="../assets/css/mc-calendar.min.css" rel="stylesheet"/>
  <link href="../assets/css/star-rating.css" media="all" rel="stylesheet" type="text/css"/>
  <link href="../assets/css/intlTelInput.css" rel="stylesheet">

  <style>
    .centered {
      position: fixed;
      top: 50%;
      left: 50%;
      /* bring your own prefixes */
      transform: translate(-50%, -50%);
    }
    .loader {
      border: 16px solid #f3f3f3; /* Light grey */
      border-top: 16px solid #3498db; /* Blue */
      border-radius: 50%;
      width: 120px;
      height: 120px;
      animation: spin 2s linear infinite;
      position: absolute;
      z-index: 1500;
      top: 50%;
      left: 40%;
      /* transform: translate(-50%, -50%); */

    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

  </style>
</head>

<body>


  <div class="wrapper ">
  
    <div class="main-panel">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top ">
        <div class="container-fluid">
          <div class="navbar-wrapper">
            <a class="navbar-brand" href="javascript:;">Tutor Online Registration</a>
          </div>

          <button class="navbar-toggler" type="button" data-toggle="collapse" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
          </button>
          <div class="collapse navbar-collapse justify-content-end">
            <form class="navbar-form">
            </form>

            <ul class="navbar-nav">
              <li class="nav-item" id="activationNavItem">
                <a href="#" class="btn btn-primary btn-round btn-sm" style="visibility: hidden;" id="btnActivateAccount"></a>
              </li>
              <li class="nav-item">
                <a class="navbar-brand" href="javascript:;">
                   Hi <span id="user"></span> !
                </a> 
              </li>
              <!-- <li class="nav-item dropdown">
                <a class="nav-link" href="javascript:;" id="navbarDropdownNotification" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="material-icons">notifications</i> Notifications
                </a>
								<div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
									<p style="padding: 1em;" >No notification</p>
                </div>
              </li>
			  
			  			<li class="nav-item dropdown">
                <a class="nav-link" href="javascript:;" id="navbarDropdownProfile" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="material-icons">person</i>
                  <p class="d-lg-none d-md-block">
                    Account
                  </p>
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownProfile">
                  <a class="dropdown-item" href="./edit-profile.html">Edit Profile</a>
                  <a id="navPublicProfile" class="dropdown-item" href="#">My Public Profile</a>
									<a class="display:block; dropdown-item" href="./about.html">About</a>
									<div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="javascript:;" onclick="signOutFunction()" id="btn-logout">Log out</a>
									<div class="dropdown-divider"></div>
									<a style="font-weight: 500 ;padding: 0.5em ;text-align: center; width: 200px; background-color: #428dd4 ;display: block; color: #fff;" href="https://golearn.com.my/pricing/" target="_blank" id="btnUpgradeToPro">Upgrade to Pro</a>

                </div>
              </li> -->
            </ul>
          </div>
        </div>
      </nav>
      <!-- End Navbar -->

			<!-- Modal Start -->
      <!-- Uploading Progress modal -->
      <div class="row">
        <div class="modal fade" id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="uploadModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="uploadModalLabel">Uploading...</h5>
              </div>
              <div class="modal-body" id="uploadModalBody">
                <div id="myProgress" style="width: 100%; background-color: grey;">
                  <div id="myBar" style="width: 1%; height: 30px; background-color: green;"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sign-out modal -->
      <div class="row">
        <div class="modal fade" id="signOutModal" tabindex="-1" role="dialog" aria-labelledby="signOutModalLabel" aria-hidden="true">
          <div class="modal-dialog  modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="signOutLabel">Logging Out</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="signOutModalBody">
                Are you sure you want to continue?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnSignOutModalUpdate">Confirm</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="container">
          <div class="container overflow-hidden">
            <div class="row">


              <!-- Invalid screen -->
              <div class="col-md-9" id="invalid-screen" style="display: none;">
                <h2>Invalid Registration Link...</h2>
              </div>

              <!-- Invalid screen -->
              <div class="col-md-9" id="registration-complete-screen" style="display: none;">
                <h2>You have completed your registration!</h2>
                <a href="./" class="btn btn-outline-primary btn-round" id="btnBack">View my profile <i class="material-icons" style="color: #2e74b6; margin-right: 0.5em; padding-bottom: 0.2em;">east</i></a>

              </div>

    
              <!-- Main content -->
              <div class="col-md-9" id="multisteps-form">
                <!--multisteps-form navbar-->
                <div class="row" >
                  <div class="col-12 col-lg-12 ml-auto mr-auto mb-4">
                    <div class="multisteps-form__progress">
                      <button class="multisteps-form__progress-btn js-active" type="button" title="Login">Login</button>
                      <button class="multisteps-form__progress-btn" type="button" title="Student Info">Tutor Profile</button>
                    </div>
                  </div>
                </div>

                <!--multisteps-form-->
                <div class="multisteps-form" >
                  <!--form panels-->
                  <div class="row">
              
                    <div class="col-12">
                      <form class="multisteps-form__form">

                        <!-- Login form panel-->
                        <div class="multisteps-form__panel shadow p-4 rounded bg-white js-active" data-animation="scaleIn">
                          <h4 class="multisteps-form__title">Login</h4>

                          <div class="multisteps-form__content">
 
                            <div class="row">

                              <div class="col-md-12">
                
                                <div class="social">
                                  <h4><span> <button class="btn btn-just-icon btn-round btn-facebook">
                                    <p>1</p>
                                    </button></span> Enter Your Contact Number</h4>
                                </div>
                                
                  
                                <div class="card-body">
                                  <div class="form-group  d-flex justify-content-center">
                                    <div class="input-group">
                                      <input id="phone" name="phone" type="tel"  class="form-control">
                                      <span id="valid-msg" class="hide" style="color: #42ba96;">✓ Valid</span>
                                      <span id="error-msg" class="hide" style="color: #F32013;"></span>
                                    </div>
                                  </div>
                                  <div class="form-group">
                                    <div class="input-group">
                                      <div id="recaptcha-container"></div>
                                    </div>
                                  </div>
                                  <div class="form-group">
                                    <div class="input-group">
                                      <button id="btnVerify" class="btn btn-primary btn-round" data-dismiss="modal" type="button">
                                        Verify
                                      </button>
                                    </div>
                                  </div>
                                </div>

                                <div class="social">
                                  <h4 ><span> <button class="btn btn-just-icon btn-round btn-facebook">
                                    <p>2</p>
                                    </button></span> Verification </h4>
                                  <p>Enter the 6-digit verification code from your SMS.</p>
                                </div>

                                <div class="card-body">
                                  <div class="form-group">
                                    <div class="input-group">

                                      <div id="divOuter" style="width: 240px; ">
                                        <div id="divInner" style="left: 0; position: sticky;">
                                          <input style="background-color: transparent; border: 0; width: 280px; letter-spacing: 30px; padding-left: 10px; margin-left:0em; background-position-x: 25px!important;  background-repeat: repeat-x; background-size: 40px 1px;  background-position: bottom; background-image: linear-gradient(to left, black 70%, rgba(255, 255, 255, 0) 0%);" type="text" id="verificationCode" maxlength="6" placeholder="">                            
                                        </div>
                                      </div>

                                      <!-- <div id="divOuter" style="width: 250px; overflow: hidden;">
                                        <div id="divInner" style="left: 0; position: sticky;">
                                          <input style="background-color: transparent; border: 0; width: 280px; letter-spacing: 31px;  padding-left: 20px; margin-left:0em; background-position-x: 0;  background-repeat: repeat-x;background-size: 40px 1px;  background-position: bottom; background-image: linear-gradient(to left, black 70%, rgba(255, 255, 255, 0) 0%);" type="text" id="verificationCode" maxlength="6" placeholder="">                            
                                        </div>
                                      </div> -->
                                    </div>
                                  </div>
                                  <div class="form-group">
                                    <div class="input-group">
                                      <a href="#" class="btn btn-primary btn-round" id="btnLogin" type="button">Confirm and Login</a>
                                    </div>
                                  </div>
                                </div>

                              </div>
                            </div>
                            <div class="button-row d-flex mt-4">
                            </div>
                          </div>
                        </div>
                        <!-- Tutor form panel-->
                        <div class="multisteps-form__panel shadow p-4 rounded bg-white" data-animation="scaleIn">
                          <h4 class="multisteps-form__title">Edit Tutor Profile</h4>
                          <div class="multisteps-form__content">
                            <div class="row">
                              <div class="col-md-12" id="tutorNull">
                                <div class="card card-profile">
                                  <div class="card-avatar" style="height: 150px;width: 150px;">
                                    <a href="javascript:;" >
                                      <img class="img" id="tutorImgUrl" style="height: 100%; width:100%; object-fit: cover; border-radius: 50%;" src="https://app.golearn.com.my/assets/img/empty-photo.png"/>
                                    </a>
                                  </div>
                                  <div class="card-body">
                                    
                                    <input type="file" id="select_image" name="image" style="display:none" accept="image/x-png,image/jpeg">
                                    
                                    <div class="input-group" style="padding: 1rem;">

                                      <div class="input-group-prepend">

                                        <span class="input-group-text">
                                          <i class="material-icons">perm_identity</i>
                                        </span>
                                      </div>

                                      <input type="text" class="form-control" id="name" placeholder="Name" data-compulsory="true" oninput="this.className = 'form-control'">
                                    </div>
                                    
                                    <div class="input-group" style="padding-top: 1.5rem; padding-left: 1rem; padding-right: 1rem; padding-bottom: 1rem;">
                                      <div class="input-group-prepend">
                                        <span class="input-group-text">
                                          <i class="material-icons">phone</i>
                                        </span>
                                      </div>
                                      <!-- <input type="text" class="form-control" id="phone" placeholder="Phone Number" readonly> -->
                                      <input id="phoneTutor" name="phone" type="tel"  class="form-control" readonly>
                                      <span id="valid-msgTutor" class="hide" style="color: #42ba96;">✓ Valid</span>
                                      <span id="error-msgTutor" class="hide" style="color: #F32013;"></span>
                                    </div>
                    
                                    <div class="input-group" style="padding-top: 1.5rem; padding-left: 1rem; padding-right: 1rem; padding-bottom: 1rem;">
                                      <div class="input-group-prepend">
                                        <span class="input-group-text">
                                          <i class="material-icons">email</i>
                                        </span>
                                      </div>
                                      <input type="text" class="form-control" id="email" placeholder="Email Address">
                                    </div>
                    
                                    <div class="row">
                                      <div class="col-md-6">
                                        <div class="input-group" style="padding-top: 1.5rem; padding-left: 1rem; padding-right: 1rem; padding-bottom: 1rem;">
                                          <div class="input-group-prepend">
                                            <span class="input-group-text">
                                              <i class="material-icons">contacts</i>
                                            </span>
                                          </div>
                                          <input type="number" class="form-control" id="age" placeholder="Age" min="0" max="100">
                                        </div>
                                      </div>
                                      <div class="col-md-6" style="padding-top: 1.5rem; padding-left: 1rem; padding-right: 1rem; padding-bottom: 1rem;">
                                        <div class="form-group">
                                          <div class="form-check form-check-radio form-check-inline">
                                            <label class="form-check-label">
                                              <input class="form-check-input" type="radio" name="genderRadios" id="radio-male" value="optionMale" >
                                                Male
                                              <span class="circle">
                                                <span class="check"></span>
                                              </span>
                                            </label>
                                          </div>
                                          <div class="form-check form-check-radio form-check-inline">
                                            <label class="form-check-label">
                                              <input class="form-check-input" type="radio" name="genderRadios" id="radio-female" value="optionFemale">
                                                Female
                                              <span class="circle">
                                                <span class="check"></span>
                                              </span>
                                            </label>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                     
                                    <div class="input-group" style="padding-top: 1.5rem; padding-left: 1rem; padding-right: 1rem; padding-bottom: 1rem;">
                                      <div class="input-group-prepend">
                                        <span class="input-group-text">
                                          <i class="material-icons" style="margin-left: 24px;"></i>
                                        </span>
                                      </div>
                                      <input type="text" class="form-control" id="address1" placeholder="Address 1">
                                    </div>
                                    <div class="input-group" style="padding-top: 0.5rem; padding-left: 1rem; padding-right: 1rem; padding-bottom: 1rem;">
                                      <div class="input-group-prepend">
                                        <span class="input-group-text">
                                          <i class="material-icons">place</i>
                                        </span>
                                      </div>
                                      <input type="text" class="form-control" id="address2" placeholder="Address 2">
                                    </div>
                    
                                    <div class="row">
                                      <div class="col-md-6">
                                        <div class="input-group" style="padding-top: 0.5rem; padding-left: 1rem; padding-right: 1rem; padding-bottom: 1rem;">
                                          <div class="input-group-prepend">
                                            <span class="input-group-text">
                                              <i class="material-icons"  style="margin-left: 24px;" ></i>
                                            </span>
                                          </div>
                                          <input type="number" class="form-control" id="addressPostCode" placeholder="Postcode">
                                        </div>
                                      </div>
                                      <div class="col-md-6">
                                        <div class="input-group" style="padding-top: 0.5rem; padding-left: 1rem; padding-right: 1rem; padding-bottom: 1rem;">
                                          <div class="input-group-prepend">
                                            <span class="input-group-text">
                                              <!-- <i class="material-icons">contacts</i> -->
                                            </span>
                                          </div>
                                          <input type="text" class="form-control" id="addressState" placeholder="State">
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>


                            <div class="button-row d-flex mt-4">
                              <!-- <button class="btn btn-primary js-btn-prev" type="button" title="Prev">Prev</button> -->
                              <button class="btn btn-success ml-auto js-btn-send" type="button" title="Send" id="btnRegister" >Update & Join </button>
                            </div>

                          </div>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <footer class="footer">
        <div class="container-fluid">
          <nav class="float-left">
          <ul>
            <!-- <li>
            <a href="https://golearn.com.my/join-us" target="_blank">
              Visit GoLearn Tutor
            </a>
            </li> -->
          </ul>
          </nav>
          <!-- <div class="copyright float-right">
            &copy;
            <script>
              document.write(new Date().getFullYear())
            </script> 
            , made with <i class="material-icons">favorite</i> by <a href="#" >GoLearn Team</a>
          </div> -->
          <!-- your footer here -->
        </div>
      </footer>
    </div>
	  
  </div>

  <!-- Loading screen -->
  <!-- background-color: #e4e4e463;  -->
  <div class="" style="height: 100%; background-color: #e4e4e463; position: fixed; overflow: hidden; z-index: 1700;top: 0;left: 0; ">
    <!-- <p>hihih</p> -->
    <div class="loader"></div>
  </div>

  <script src="../assets/js/core/jquery.min.js"></script>
  <script src="../assets/js/core/popper.min.js"></script>
  <script src="../assets/js/core/bootstrap-material-design.min.js"></script>
  <script src="../assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
  <!-- Plugin for the momentJs  -->
  <script src="../assets/js/plugins/moment.min.js"></script>
  <!--  Plugin for Sweet Alert -->
  <script src="../assets/js/plugins/sweetalert2.js"></script>
  <!-- Forms Validations Plugin -->
  <script src="../assets/js/plugins/jquery.validate.min.js"></script>
  <!-- Plugin for the Wizard, full documentation here: https://github.com/VinceG/twitter-bootstrap-wizard -->
  <!-- <script src="assets/js/plugins/jquery.bootstrap-wizard.js"></script> -->
  <!-- 	Plugin for Select, full documentation here: http://silviomoreto.github.io/bootstrap-select -->
  <!-- <script src="assets/js/plugins/bootstrap-selectpicker.js"></script> -->
  <!--  Plugin for the DateTimePicker, full documentation here: https://eonasdan.github.io/bootstrap-datetimepicker/ -->
  <!-- <script src="assets/js/plugins/bootstrap-datetimepicker.min.js"></script> -->
  <!--  DataTables.net Plugin, full documentation here: https://datatables.net/  -->
  <!-- <script src="assets/js/plugins/jquery.dataTables.min.js"></script> -->
  <!-- 	Plugin for Tags, full documentation here: https://github.com/bootstrap-tagsinput/bootstrap-tagsinputs  -->
  <!-- <script src="assets/js/plugins/bootstrap-tagsinput.js"></script> -->
  <!-- Plugin for Fileupload, full documentation here: http://www.jasny.net/bootstrap/javascript/#fileinput -->
  <!-- <script src="assets/js/plugins/jasny-bootstrap.min.js"></script> -->
  <!--  Full Calendar Plugin, full documentation here: https://github.com/fullcalendar/fullcalendar    -->
  <!-- <script src="assets/js/plugins/fullcalendar.min.js"></script> -->
  <!-- Vector Map plugin, full documentation here: http://jvectormap.com/documentation/ -->
  <!-- <script src="assets/js/plugins/jquery-jvectormap.js"></script> -->
  <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
  <!-- <script src="assets/js/plugins/nouislider.min.js"></script> -->
  <!-- Include a polyfill for ES6 Promises (optional) for IE11, UC Browser and Android browser support SweetAlert -->
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/core-js/2.4.1/core.js"></script> -->
  <!-- Library for adding dinamically elements -->
  <!-- <script src="assets/js/plugins/arrive.min.js"></script> -->
  <!--  Google Maps Plugin    -->
  <!-- <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script> -->
  <!-- Chartist JS -->
  <!-- <script src="assets/js/plugins/chartist.min.js"></script> -->
  <!--  Notifications Plugin    -->
  <script src="../assets/js/plugins/bootstrap-notify.js"></script>
  <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="../assets/js/material-dashboard.js?v=2.1.2" type="text/javascript"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.min.js" integrity="sha384-lpyLfhYuitXl2zRZ5Bn2fqnhNAKOAaM/0Kr9laMspuaMiZfGmfwRNFh8HlMy49eQ" crossorigin="anonymous"></script>
  <!-- Common constants -->
  <script src="../assets/js/common.js" type="text/javascript"></script>
  <!-- General Info -->
  <script src="../assets/js/const.js" type="text/javascript"></script>
  <!-- Core Tutor Js -->
  <script src="../assets/js/tutor-core.js" type="text/javascript"></script>
  <!-- Datepicker -->
  <script src="../assets/js/mc-calendar.min.js" type="text/javascript"></script>
  <!-- ClockPicker -->
  <script type="text/javascript" src="../assets/js/bootstrap-clockpicker.min.js"></script>
  <script src="../assets/js/star-rating.js" type="text/javascript"></script>
  <script src="../assets/js/star-rating-theme.js" type="text/javascript"></script>
  <!-- International Telephone Input -->
  <script src="../assets/js/plugins/intlTelInput/intlTelInput.js"></script>
  <!-- Login specific -->
  <!-- <script src="js/tutor-portal-auth.js" type="text/javascript"></script> -->

  <script>
    // Global Variables
    var tutorId;
    var current_name, current_email, current_phone, current_imgUri, current_nric,
      current_address1, current_address2, current_addressPostCode, current_addressState, current_address,
      currentYearsExperience, current_weburl;
    // Global Variables for Admin
    var admin_name, admin_email, admin_phone, admin_imgUri,
      admin_address1, admin_address2, admin_addressPostCode, admin_addressState, admin_address,
      admin_weburl;
    var currentObj = null; // Session Storage for Dependant Module
    // var action; // Action: JOINSTUDENT(enroll as student), JOINSTUDENTNCLASS (enroll as student and class)
    const JOIN_AS_STUDENT = 'joinAsStudent';
    const JOIN_AS_STUDENT_AND_CLASS = 'joinAsStudentNClass';
    const JOIN_AS_STUDENT_AND_ADD_DEPENDANT = 'joinAsStudentNAddDependant';
    const JOIN_AS_STUDENT_CLASS_AND_ADD_DEPENDANT = 'joinAsStudentClassNAddDependant';
    const JOIN_AS_STUDENT_WITH_DEPID = 'joinAsStudentWithDepId'; // User selected a dependant
    const JOIN_AS_STUDENT_AND_CLASS_WITH_DEPID = 'joinAsStudentNClassWithDepId';

    var db = firebase.firestore();
		db.settings({ timestampsInSnapshots: true });

    // Check URL
    var url_string = window.location.href;
    var url = new URL(url_string);

    var adminId = '';
    adminId = url.searchParams.get("aid");

    // http://127.0.0.1:8080/tutor-portal/tutor-registration.html?aid=%2B60138252818
    // ?aid=%2B60138252818
    // console.log(adminId);
    // Check validity of URL params
    if (adminId === "" || adminId == null){
      // console.log('Invalid Url params');
      invalidatePage();
    }
    else{

      // Step 1: Check if the Admin exists
      let docRefAdmin = db.collection("Tutor").doc(adminId);

      docRefAdmin.get().then((doc) => {
        if (doc.exists) {
          admin_name = (doc.data().name == null || doc.data().name == "")? "New Tutor" : doc.data().name;
          admin_email = (doc.data().email == null || doc.data().email == "")? "" : doc.data().email; 
          admin_phone= (doc.data().phone == null || doc.data().phone == "")? "" : doc.data().phone;
          admin_imgUri = (doc.data().imgUrl == null || doc.data().imgUrl == "")? "https://app.golearn.com.my/assets/img/hello.gif" : doc.data().imgUrl;
          admin_accountStatus = doc.data().accountStatus; 
          admin_address1= (doc.data().address1 == null || doc.data().address1 == "")? '' : doc.data().address1 + ', ';
          admin_address2= (doc.data().address2 == null || doc.data().address2 == "")? '' : doc.data().address2 + ', '; 
          admin_addressPostCode= (doc.data().addressPostCode == null || doc.data().addressPostCode == "")? '' : doc.data().addressPostCode + ', ';
          admin_addressState= (doc.data().addressState == null || doc.data().addressState == "")? '' : doc.data().addressState;
          admin_address = admin_address1 + admin_address2 + admin_addressPostCode + admin_addressState;
          admin_weburl = doc.data().aWebUrl;
            
        } else {
          // console.log("No such admin Id!");
          invalidatePage();
        }
      })
      .catch((error) => {
        // Error: Invalid Tutor/ organization
        console.log("Error getting document:", error);
        invalidatePage();

      });
    }

    function invalidatePage(){
      let multisteps = document.getElementById("multisteps-form"); 
      multisteps.setAttribute('style', 'display: none;');
      let invalid_screen = document.getElementById("invalid-screen"); 
      invalid_screen.className = 'centered';
      invalid_screen.setAttribute('style', 'display: inline;');
      func.showNotification('top','center', 'danger', 'error_outline', "Invalid Link: Please contact your class owner to fix this for you." );
    }

    function registrationCompletePage(){
      let multisteps = document.getElementById("multisteps-form"); 
      multisteps.setAttribute('style', 'display: none;');
      let invalid_screen = document.getElementById("registration-complete-screen"); 
      invalid_screen.className = 'centered';
      invalid_screen.setAttribute('style', 'display: inline;');
    }

		firebase.auth().onAuthStateChanged(function(user){
      
			if(!user){
        // Return to login if user does not exist.

				// window.location.href = "login.html"
			}else{
        // if the displayName is null, it means user register using Phone
        if (firebase.auth().currentUser.displayName == null ){
            tutorId = firebase.auth().currentUser.phoneNumber;
        }else
            tutorId = firebase.auth().currentUser.email.replace("[^a-zA-Z0-9]", "_").toLowerCase();

        loadUserInfo(tutorId);
        // User exist. Move to Step 1.
        setActiveStep(1);
        setActivePanel(1);        
			}
		});

    // Tutor Specific
    function loadUserInfo(tutorId){
      // Tutor Id must be a phone with +60, no spacing or other chars
      var docRef = db.collection("Tutor").doc(tutorId);
      

      // docRef.get().then((doc) => {
      docRef.onSnapshot((doc) => {

        if (doc.exists) {
          // console.log("Document data:", doc.data());

          current_name = (doc.data().name == null || doc.data().name == "")? "New Tutor" : doc.data().name;
          current_email = (doc.data().email == null || doc.data().email == "")? "" : doc.data().email; 
          current_phone= (doc.data().phone == null || doc.data().phone == "")? "" : doc.data().phone;
          
          current_age = (doc.data().age == null || doc.data().age == "")? "18" : doc.data().age; 
          current_gender= (doc.data().gender == 0)? "Male" : "Female"; 
          current_imgUri = (doc.data().imgUrl == null || doc.data().imgUrl == "")? "https://app.golearn.com.my/assets/img/hello.gif" : doc.data().imgUrl;
          current_accountStatus = doc.data().accountStatus; 
          current_address1= (doc.data().address1 == null || doc.data().address1 == "")? '' : doc.data().address1 + ', ';
          current_address2= (doc.data().address2 == null || doc.data().address2 == "")? '' : doc.data().address2 + ', '; 
          current_addressPostCode= (doc.data().addressPostCode == null || doc.data().addressPostCode == "")? '' : doc.data().addressPostCode + ', ';
          current_addressState= (doc.data().addressState == null || doc.data().addressState == "")? '' : doc.data().addressState;
          current_address = current_address1 + current_address2 + current_addressPostCode + current_addressState;
          currentYearsExperience = doc.data().yearsExperience; // number
          // currentTutoringExperience = doc.data().tutoringExperience;
          // currentTutoringApproach = doc.data().tutoringApproach;
          // currentQualification= doc.data().qualification;
          current_aweburl = doc.data().aWebUrl;

          //------ edit-profile.html specific Start -------------//
          document.getElementById("tutorImgUrl").src = current_imgUri;
          imgUrl_temp = current_imgUri;
          document.getElementById("name").value = doc.data().name;
          document.getElementById("email").value = doc.data().email;
          document.getElementById("phoneTutor").value = doc.data().phone;
          document.getElementById("age").value = doc.data().age;
          document.getElementById("address1").value = doc.data().address1;
          document.getElementById("address2").value = doc.data().address2;
          document.getElementById("addressPostCode").value = doc.data().addressPostCode;
          document.getElementById("addressState").value = doc.data().addressState;

          if (doc.data().gender === 0){ // Male
            document.getElementById("radio-male").checked = true;
          }else if (doc.data().gender === 1 ){
            document.getElementById("radio-female").checked = true
          }else{
            document.getElementById("radio-male").checked = true;
          }

          // Re-Enable img upload and save button
          document.getElementById("tutorImgUrl").setAttribute("style", "height: 100%; width:100%; object-fit: cover; border-radius: 50%; pointer-events: auto;");
          //------ edit-profile.html specific End -------------//



        } else {
            //  Error: Invalid user
        }
      });

    };

    
    function ValidateTutorInTutorDB(){

      // Check if the adminId & tutorId match. If exist, it means the the tutor already under the admin, 
      // so reactivate them (TUTOR_STATUS_TYPE_ACTIVE) & do not add the tutor to admin's tutor pool.
      console.log('ValidateTutorInTutorDB: ');
      let docRef = db.collection("Class")
        .doc("v1")
        .collection("Tutor")
        .where(TUTOR_ADMIN_ID, "==", adminId)
        .where(TUTOR_TUTOR_ID, "==", tutorId)
        // .where(TUTOR_STATUS_ADMIN, "in", [TUTOR_STATUS_TYPE_ACTIVE, TUTOR_STATUS_TYPE_PASSIVE])
        .limit(1);
        
      docRef
        .get()
        .then((querySnapshot) => {
          if(querySnapshot.empty){
            // CREATE NEW Tutor 
            AddTutorToTutorDB();
          }else{
            querySnapshot.forEach((doc) =>{
              // console.log(doc.data())
              // console.log(doc.data()[TUTOR_ID])
              SetAdminStatusToActive(doc.data()[TUTOR_ID], doc.data()[TUTOR_STATUS_ADMIN]);

            })

          }
        });
    }
    // Set the statuses to active and update the details
    function SetAdminStatusToActive(docId, statusAdmin){
      // NEW: Add tutor to the Tutor Module
      let tutorModuleDocRef = db.collection("Class").doc('v1').collection('Tutor').doc(docId);
      let tutorModuleData = {
        [TUTOR_ADMIN_NAME]: admin_name,
        [TUTOR_ADMIN_PHONE]: admin_phone,
        [TUTOR_ADMIN_EMAIL]: admin_email,
        [TUTOR_ADMIN_ADDR]: admin_address,
        [TUTOR_ADMIN_IMG_URL]: admin_imgUri,
        [TUTOR_ADMIN_WEB_URL]: admin_weburl,
        // Tutor specific
        [TUTOR_TUTOR_NAME]: document.getElementById("name").value,
        [TUTOR_TUTOR_EMAIL]: document.getElementById("email").value,
        [TUTOR_TUTOR_PHONE]: document.getElementById("phoneTutor").value,
        [TUTOR_TUTOR_AGE]: parseInt(document.getElementById("age").value, 10),
        [TUTOR_TUTOR_GENDER]: gender_temp,
        [TUTOR_TUTOR_ADDR]: final_address,
        [TUTOR_TUTOR_IMG_URL]: imgUrl_temp,
        [TUTOR_TUTOR_WEB_URL]: current_aweburl,

        [TUTOR_DATE_EDIT]: new Date(),
        [TUTOR_STATUS_ADMIN]: TUTOR_STATUS_TYPE_ACTIVE,
        [TUTOR_STATUS_TUTOR]: TUTOR_STATUS_TYPE_ACTIVE,
   
      }
      tutorModuleDocRef
      .set(tutorModuleData, { merge: true })
      .then(()=> {
        func.showNotification('top','center', 'success', 'error_outline', "You are successfully registered!");

        if (statusAdmin === TUTOR_STATUS_TYPE_ACTIVE || statusAdmin === TUTOR_STATUS_TYPE_PASSIVE) {
          registrationCompletePage();
        }
        else{
          // statusAdmin === TUTOR_STATUS_TYPE_DELETE
          // Update the the Tutor Num before running registration Page Complete
          updateTeacherNum(1);
        }

      });
    }


    // Add New Student to Student Module
    function AddTutorToTutorDB(){
      
      // NEW: Add tutor to the Tutor Module
      let tutorModuleDocRef = db.collection("Class").doc('v1').collection('Tutor').doc();
      let tutorModuleData = {
        [TUTOR_ID]: tutorModuleDocRef.id,
        [TUTOR_ADMIN_ID]: adminId,
        [TUTOR_TUTOR_ID]: tutorId,
        [TUTOR_DATE_ADD]: new Date(),
        [TUTOR_DATE_EDIT]: '',
        [TUTOR_DATE_DEL]: '',
        [TUTOR_STATUS_ADMIN]: TUTOR_STATUS_TYPE_ACTIVE,
        [TUTOR_STATUS_TUTOR]: TUTOR_STATUS_TYPE_ACTIVE,
        // Admin specific
        [TUTOR_ADMIN_NAME]: admin_name,
        [TUTOR_ADMIN_PHONE]: admin_phone,
        [TUTOR_ADMIN_EMAIL]: admin_email,
        [TUTOR_ADMIN_ADDR]: admin_address,
        [TUTOR_ADMIN_IMG_URL]: admin_imgUri,
        [TUTOR_ADMIN_WEB_URL]: admin_weburl,
        // Tutor specific
        [TUTOR_TUTOR_NAME]: document.getElementById("name").value,
        [TUTOR_TUTOR_EMAIL]: document.getElementById("email").value,
        [TUTOR_TUTOR_PHONE]: document.getElementById("phoneTutor").value,
        [TUTOR_TUTOR_AGE]: parseInt(document.getElementById("age").value, 10),
        [TUTOR_TUTOR_GENDER]: gender_temp,
        [TUTOR_TUTOR_ADDR]: final_address,
        [TUTOR_TUTOR_IMG_URL]: imgUrl_temp,
        [TUTOR_TUTOR_WEB_URL]: current_aweburl,
        // Employement (Entered by Admin only)
        [TUTOR_BANK_NAME]: '',
        [TUTOR_AC_NO]: '',
        [TUTOR_EPF]: '',
        [TUTOR_SOCSO]: '',
      }
      tutorModuleDocRef
      .set(tutorModuleData, { merge: true })
      .then(()=> {
        func.showNotification('top','center', 'success', 'error_outline', "You are successfully registered!");
        
        updateTeacherNum(1);
        
      });
    }

    var final_address, gender_temp;

    // Update Tutor Profile
    function UpdateTutorProfile(){
      // Step 1: Update tutor profile
      // let gender_temp = 1;
      let gender_string_temp = "Female";
      if (document.getElementById("radio-male").checked){
        gender_temp = 0;
        gender_string_temp = "Male";
      }else if (document.getElementById("radio-female").checked){
        gender_temp = 1;
        gender_string_temp = "Female";
      }else{
        gender_temp = 1;
        gender_string_temp = "Female";
      }
      // console.log("imgUrl: "+ imgUrl_temp);


      let docRef = db.collection("Tutor").doc(tutorId);

      let data = {
        [NAME_KEY]: document.getElementById("name").value,
        [EMAIL_KEY]: document.getElementById("email").value,
        [PHONE_KEY]: document.getElementById("phoneTutor").value,
        [ADDRESS_1_KEY]: document.getElementById("address1").value,
        [ADDRESS_2_KEY]: document.getElementById("address2").value,
        [ADDRESS_POSTCODE_KEY]: document.getElementById("addressPostCode").value,
        [ADDRESS_STATE_KEY]: document.getElementById("addressState").value,
        [IMAGE_KEY]: imgUrl_temp,
        [AGE_KEY]: parseInt(document.getElementById("age").value, 10),
        [GENDER_KEY]: gender_temp
      }
      // console.log('Tutor Data');
      // console.log(data);
      let docRefWithMerge = docRef.set( data, { merge: true });

      // Update all active course
      // let final_address = document.getElementById("address1").value + ", " +
      //   document.getElementById("address2").value + ", " + 
      //   document.getElementById("addressPostCode").value + ", " +
      //   document.getElementById("addressState").value;
      let final_address1 = (document.getElementById("address1").value == null ||  document.getElementById("address1").value == "")? '' : document.getElementById("address1").value + ", ";
      let final_address2 = (document.getElementById("address1").value == null ||  document.getElementById("address1").value == "")? '' : document.getElementById("address2").value + ", ";
      let final_addressPostCode = (document.getElementById("address1").value == null ||  document.getElementById("address1").value == "")? '' : document.getElementById("addressPostCode").value + ", ";
      let final_addressState = (document.getElementById("address1").value == null ||  document.getElementById("address1").value == "")? '' : document.getElementById("addressState").value + ", ";
      final_address = final_address1 + final_address2 +final_addressPostCode + final_addressState

      var allActiveCourseData = {
        [NAME_KEY]: document.getElementById("name").value,
        [EMAIL_KEY]: document.getElementById("email").value,
        [PHONE_KEY]: document.getElementById("phoneTutor").value,
        [ADDRESS_KEY]: final_address,
        [AGE_KEY]: parseInt(document.getElementById("age").value, 10),
        [GENDER_KEY]: gender_temp,
        [IMAGE_KEY]: imgUrl_temp,
      }
      // Update the profile pic, name, & etc of all the active courses..

      updateInfoInAllActiveCourse(allActiveCourseData);


      // If admin is filling the form themselves, skill action
      if (admin_weburl == current_aweburl){
        func.showNotification('top','center', 'warning', 'error_outline', "You are attempting to add yourself as tutor. Action restricted.");
        ValidateTutorInTutorDB();
        
      }
      else{
        ValidateTutorInTutorDB();

      }

     
 


      // Update metadata and sitemaps
      // Update meta data of user's public profile
      if (current_accountStatus == DEACTIVATED_ACCOUNT_STATUS_KEY || 
        current_accountStatus == DEACTIVATED_ACCOUNT_STATUS_KEY){
        // Do nothing if the account is new, deactivated or suspended

      }
      else {


        // Check if aWebUrl Exist or not. Update only if it exists.
        if (current_aweburl == null || current_aweburl == ""  ){
          // Do nothing
        }
        else{

          let detail_temp =""
          if (currentYearsExperience == 0 || currentYearsExperience == null)
            detail_temp = gender_string_temp + " | " + document.getElementById("age").value;
          else if (currentYearsExperience == 1)
            detail_temp = gender_string_temp + " | " + document.getElementById("age").value + " |  1 year of experience";
          else
            detail_temp = gender_string_temp + " | " + document.getElementById("age").value + " | "+ currentYearsExperience + " years of experience";
          
          // console.log(current_aweburl);
          // console.log(document.getElementById("name").value);
          // console.log(detail_temp);
          // console.log(imgUrl_temp);
          updateMetaData(current_aweburl, document.getElementById("name").value, detail_temp, imgUrl_temp);
          updateSitemap(current_aweburl);
        }
        
      
      }
      
      // func.showNotification('top','center', 'success', 'check_circle', "Your profile is updated.");

    }

    // Update profile pic, name, & etc of tutor for all active courses
    function updateInfoInAllActiveCourse(allActiveCourseData) {

      var allActiveCourseCol = db.collection("Tutor").doc(tutorId).collection("Courses")
      .where("status", "==", true);

      allActiveCourseCol
      .get()
      .then((querySnapshot) => {
        let docId;
        querySnapshot.forEach((doc) => {
          docId = doc.id;
          // Updating Offline class
          if (doc.data().online){
            // Online class
            // console.log('Updating online class: '+doc.data().id);
            var allSubjectColRef = 
              db.collection("country")
              .doc("malaysia")
              .collection("state")
              .doc("online")
              .collection("category")
              .doc(doc.data().categoryId)
              .collection("subject")
              .doc(doc.data().subjectId)
              .collection("tutor")
              .doc(tutorId);

              // Update the course
              allSubjectColRef.set(allActiveCourseData, { merge: true });

              // Update the history as well
              allSubjectColRef.collection("AllCourses").doc(docId)
                .set(allActiveCourseData, { merge: true });

          }
          // Updating Offline class
          else{
            // Offline class
            // console.log('Updating Offline class: '+doc.data().id);
            for ( let i = 0; i <  doc.data().preferedAreaList.length; i++){
              let State_Area = doc.data().preferedAreaList[i].split("-");

              var allSubjectColRef = 
                db.collection("country")
                .doc("malaysia")
                .collection("state")
                .doc(State_Area[0].toLowerCase())
                .collection("area")
                .doc(State_Area[1])
                .collection("category")
                .doc(doc.data().categoryId)
                .collection("subject")
                .doc(doc.data().subjectId)
                .collection("tutor")
                .doc(tutorId);

                // Update the course
                allSubjectColRef.set(allActiveCourseData, { merge: true });

                // Update the history as well
                allSubjectColRef.collection("AllCourses").doc(docId)
                  .set(allActiveCourseData, { merge: true });
            }
          }
        });

      }).catch((error) => {
        console.log("Error getting documents: ", error);
      });

    }


    function updateMetaData(aWebUrl, name, detail, imgUrl){
        // This function create-tutor public profile based on aweburl param.
      // All the data fields are required to contruct the static meta data of the profile							
      var temp_name = encodeURIComponent(name);
      var temp_detail = encodeURIComponent(detail);
      var temp_imgUrl = encodeURIComponent(imgUrl);		

      let param = "https://golearn.com.my/tutor/a-source/create-tutor.php?aweburl="+aWebUrl+"&name="+temp_name+"&detail="+temp_detail+"&imgUrl="+temp_imgUrl;				  
      $.ajax({
        type: "GET",
        url: param,
        data: $(this).serialize(),
        success: function(response)
        {
          var jsonData = JSON.parse(response);

          // user is logged in successfully in the back-end
          // let's redirect
          if (jsonData.success == "1")
          {
            alert('Tutor Created!');
          }
          else
          {
            alert('Invalid Credentials!');
          }
        }
      });

    }

    function updateSitemap(aWebUrl){

      // Add the url to sitemap
      let sitemapParam = "https://golearn.com.my/update-sitemap.php?action=add&path=tutor/"+aWebUrl+"&lastmod=";
      $.ajax({
        type: "GET",
        url: sitemapParam,
        data: $(this).serialize(),
        success: function(response)
        {
          var jsonData = JSON.parse(response);

          // user is logged in successfully in the back-end
          // let's redirect
          if (jsonData.success == "1")
          {
            alert('Tutor Created!');
          }
          else
          {
            alert('Invalid Credentials!');
          }
        }
      });
    }


    // Report: Update Teacher Number
    function updateTeacherNum(value){
  
      let docRef = db.collection("Report")
        .doc("v1")
        .collection("General")
        .where(NUM_ADMIN_ID, "==", adminId)
        .where(NUM_TYPE, "==", NUM_TYPE_TEACHER)
        .limit(1);


      docRef
      .get()
      .then((querySnapshot) => {

        if(querySnapshot.empty) {
          console.log("Empty. create new doc ");
          let reportDocRef = db.collection("Report")
            .doc("v1")
            .collection("General")
            .doc();
            
          reportData ={
            [NUM_ID]: reportDocRef.id,
            [NUM_ADMIN_ID]: adminId,
            [NUM_TYPE]: NUM_TYPE_TEACHER,
            [NUM_VALUE]: (value == null || value == "" || value == 0 || isNaN(value)) ? 1 : parseInt(value),
            [NUM_DATE_EDIT]: new Date(),
          }

          console.log(reportData)
          reportDocRef
            .set(reportData, { merge: true })
            .then(() => {
              registrationCompletePage();
            });

        } 
        else {
          // console.log("Data found Update: ");
          
          querySnapshot.forEach((doc) => {

            console.log(doc.data());

            let reportDocRef = db.collection("Report")
              .doc("v1")
              .collection("General")
              .doc(doc.data()[NUM_ID]);
              

            reportData ={
              // [NUM_ID]: reportDocRef.id,
              // [NUM_ADMIN_ID]: tutorId,
              // [NUM_TYPE]: ,
              [NUM_VALUE]: (value == null || value == "" || value == 0 || isNaN(value)) ? 1 : parseInt(doc.data()[NUM_VALUE]) + parseInt(value),
              [NUM_DATE_EDIT]: new Date(),
            }

            console.log(reportData)
            reportDocRef
              .set(reportData, { merge: true })
              .then(() => {
                registrationCompletePage();
              });

          });


        }


      });

    }


  </script>

  <script>

    // Global var
    var gState ='';
    var gArea ='';
    var gStateName='';
    var gAreaName ='';

    $( document ).ready(function() {

      //------------- Login Panel -----------//
      //Disable the step 1 button
      document.getElementById("btnVerify").setAttribute("style", "background-color: #c1c1c1; cursor: not-allowed");
      // document.getElementById("btnVerify").style.cursor='not-allowed';
      // document.getElementById("btnVerify").disabled = true;

      //Disable the step 2 button
      document.getElementById("btnLogin").setAttribute("style", "background-color: #c1c1c1; cursor: not-allowed");
      // document.getElementById("btnLogin").style.cursor='not-allowed';
      // document.getElementById("btnLogin").disabled = true;

      $('#btnVerify').on('click', function(){
        // let number = itiPhone.getNumber();
        // console.log(number);
        phoneAuth();

        document.getElementById("btnVerify").setAttribute("style", "background-color: #c1c1c1; cursor: not-allowed");
        // document.getElementById("btnVerify").disabled = true;
        document.getElementById("phone").setAttribute("style", "background-color: #c1c1c1; cursor: not-allowed");
        // document.getElementById("phone").disabled = true;

      });

      $('#btnLogin').on('click', function(){
        codeverify();
      });
   
      //---------------- Tutor Profile Panel ----------------//
      // Script to trigger the select image
      $('#tutorImgUrl').click(function(){
         $('#select_image').trigger('click'); 
      });
  
    });

  </script>

   
  <!-- Multiform-specific script -->
  <script>
    //DOM elements
    const DOMstrings = {
      stepsBtnClass: 'multisteps-form__progress-btn',
      stepsBtns: document.querySelectorAll(`.multisteps-form__progress-btn`),
      stepsBar: document.querySelector('.multisteps-form__progress'),
      stepsForm: document.querySelector('.multisteps-form__form'),
      stepsFormTextareas: document.querySelectorAll('.multisteps-form__textarea'),
      stepFormPanelClass: 'multisteps-form__panel',
      stepFormPanels: document.querySelectorAll('.multisteps-form__panel'),
      stepPrevBtnClass: 'js-btn-prev',
      stepNextBtnClass: 'js-btn-next',
      stepSendBtnClass: 'js-btn-send' };


    //remove class from a set of items
    const removeClasses = (elemSet, className) => {

      elemSet.forEach(elem => {

        elem.classList.remove(className);

      });

    };

    //return exect parent node of the element
    const findParent = (elem, parentClass) => {

      let currentNode = elem;

      while (!currentNode.classList.contains(parentClass)) {
        currentNode = currentNode.parentNode;
      }

      return currentNode;

    };

    //get active button step number
    const getActiveStep = elem => {
      return Array.from(DOMstrings.stepsBtns).indexOf(elem);
    };

    //set all steps before clicked (and clicked too) to active
    const setActiveStep = activeStepNum => {

      //remove active state from all the state
      removeClasses(DOMstrings.stepsBtns, 'js-active');

      //set picked items to active
      DOMstrings.stepsBtns.forEach((elem, index) => {

        if (index <= activeStepNum) {
          elem.classList.add('js-active');
        }

      });
    };

    //get active panel
    const getActivePanel = () => {

      let activePanel;

      DOMstrings.stepFormPanels.forEach(elem => {

        if (elem.classList.contains('js-active')) {

          activePanel = elem;

        }

      });

      return activePanel;

    };

    //open active panel (and close unactive panels)
    const setActivePanel = activePanelNum => {

      //remove active class from all the panels
      removeClasses(DOMstrings.stepFormPanels, 'js-active');

      //show active panel
      DOMstrings.stepFormPanels.forEach((elem, index) => {
        if (index === activePanelNum) {

          elem.classList.add('js-active');

          setFormHeight(elem);

        }
      });

    };

    //set form height equal to current panel height
    const formHeight = activePanel => {

      const activePanelHeight = activePanel.offsetHeight;

      DOMstrings.stepsForm.style.height = `${activePanelHeight}px`;

    };

    const setFormHeight = () => {
      const activePanel = getActivePanel();

      formHeight(activePanel);
    };

    //STEPS BAR CLICK FUNCTION
    DOMstrings.stepsBar.addEventListener('click', e => {

      //check if click target is a step button
      const eventTarget = e.target;

      if (!eventTarget.classList.contains(`${DOMstrings.stepsBtnClass}`)) {
        return;
      }

      //get active button step number
      const activeStep = getActiveStep(eventTarget);

      //set all steps before clicked (and clicked too) to active
      setActiveStep(activeStep);

      //open active panel
      setActivePanel(activeStep);

    });

    //PREV/NEXT BTNS CLICK
    DOMstrings.stepsForm.addEventListener('click', e => {
      const eventTarget = e.target;

      //find active panel
      const activePanel = findParent(eventTarget, `${DOMstrings.stepFormPanelClass}`);

      let activePanelNum = Array.from(DOMstrings.stepFormPanels).indexOf(activePanel);
      // console.log(action);

      //check if we clicked on `PREV` or NEXT` buttons
      if (eventTarget.classList.contains(`${DOMstrings.stepSendBtnClass}`))
      {
        validateForm(activePanelNum);
    
        if (validateForm(activePanelNum)){
          // TODO: Create Tutor
          UpdateTutorProfile();
          console.log('All guardian fields are valid');

        }else{
          // If the compulsory fields is not filled up, return and do not proceed to add student
          return;
        }
        
      }
      else if (eventTarget.classList.contains(`${DOMstrings.stepPrevBtnClass}`)) {
        activePanelNum--;
        setActiveStep(activePanelNum);
        setActivePanel(activePanelNum);
      } 
      else if (eventTarget.classList.contains(`${DOMstrings.stepNextBtnClass}`)) {
        
        let activePanelAllFilled = validateForm(activePanelNum);
        console.log(activePanelAllFilled, activePanelNum );

        if (activePanelAllFilled)
        {
          activePanelNum++;
          setActiveStep(activePanelNum);
          setActivePanel(activePanelNum);
        }
        else{
            // inputPhone.className += " invalid";
        }
         
      }
      else{
        // Do nothing and return 
        return;
        
      }
      
      // setActiveStep(activePanelNum);
      // setActivePanel(activePanelNum);
    });

    //SETTING PROPER FORM HEIGHT ONLOAD
    window.addEventListener('load', setFormHeight, false);

    //SETTING PROPER FORM HEIGHT ONRESIZE
    window.addEventListener('resize', setFormHeight, false);

    //changing animation via animation select !!!YOU DON'T NEED THIS CODE (if you want to change animation type, just change form panels data-attr)

    const setAnimationType = newType => {
      DOMstrings.stepFormPanels.forEach(elem => {
        elem.dataset.animation = newType;
      });
    };

    function validateForm(activePanelNum) {
      // This function deals with validation of the form fields with data-compulsory = 'true'
      var x, y, i, valid = true;
      x = document.getElementsByClassName("multisteps-form__panel");
      // y = x[activePanelNum].getElementsByTagName("input") && x[activePanelNum].querySelectorAll('[type="text"]');
      y =x[activePanelNum].querySelectorAll('[data-compulsory="true"]');

      // A loop that checks every input field in the current tab:
      for (i = 0; i < y.length; i++) {
        // console.log(y[i].value)
        // If a field is empty...
        if (y[i].value == "") {
          // add an "invalid" class to the field:
          y[i].className += " invalid";
          // and set the current valid status to false:
          valid = false;
        }
      }
      // If the valid status is true, mark the step as finished and valid:
      if (valid) {
        // document.getElementsByClassName("step")[activePanelNum].className += " finish";
      }
      return valid; // return the valid status
    }

  </script>

  <!-- Tel input script -->
  <script>
    // Phone
    var inputPhone = document.querySelector("#phone");
    var inputStudent = document.querySelector("#phoneTutor");
 
    var itiPhone = intlTelInput(inputPhone,{
      autoHideDialCode: false,
      nationalMode: false,
      // onlyCountries: ['MY', 'SG', 'TH', 'ID', 'VN', 'PH', 'BN', 'US', 'GB', 'SA'],
      preferredCountries: ['MY', 'SG', 'ID'],
      separateDialCode: true,
      utilsScript: "js/utils.js",
    });

    var itiStudent = intlTelInput(inputStudent,{
      autoHideDialCode: false,
      nationalMode: false,
      // onlyCountries: ['MY', 'SG', 'TH', 'ID', 'VN', 'PH', 'BN', 'US', 'GB', 'SA'],
      preferredCountries: ['MY', 'SG', 'ID'],
      separateDialCode: true,
      utilsScript: "js/utils.js",
      });
   
    
   
    var errorMsg = document.querySelector("#error-msg");
    var validMsg = document.querySelector("#valid-msg");
    var errorMsgStudent = document.querySelector("#error-msgTutor");
    var validMsgStudent = document.querySelector("#valid-msgTutor");

    // here, the index maps to the error code returned from getValidationError - see readme
    var errorMap = ["Invalid number", "Invalid country code", "Too short", "Too long", "Invalid number"];

    var reset = function() {
      inputPhone.classList.remove("error");
      errorMsg.innerHTML = "";
      errorMsg.classList.add("hide");
      validMsg.classList.add("hide");
    };
    var resetStudent = function() {
      inputStudent.classList.remove("error");
      errorMsgStudent.innerHTML = "";
      errorMsgStudent.classList.add("hide");
      validMsgStudent.classList.add("hide");
    };
  

    // on blur: validate
    
    inputPhone.addEventListener('blur', function() {
      reset();
      
      if (inputPhone.value.trim()) {
        if (itiPhone.isValidNumber()) {
          validMsg.classList.remove("hide");
        } else {
          inputPhone.classList.add("error");
          var errorCode = itiPhone.getValidationError();
          errorMsg.innerHTML = errorMap[errorCode];
          errorMsg.classList.remove("hide");
        }
      }
    });
    inputStudent.addEventListener('blur', function() {
      resetStudent();
      if (inputStudent.value.trim()) {
        if (itiStudent.isValidNumber()) {
          validMsgStudent.classList.remove("hide");
        } else {
          inputStudent.classList.add("error");
          var errorCode = itiStudent.getValidationError();
          errorMsgStudent.innerHTML = errorMap[errorCode];
          errorMsgStudent.classList.remove("hide");
        }
      }
    });
    

    // on keyup / change flag: reset
    inputPhone.addEventListener('change', reset);
    inputPhone.addEventListener('keyup', reset);
    inputStudent.addEventListener('change', resetStudent);
    inputStudent.addEventListener('keyup', resetStudent);
 
    // Validate fields in based on parents. 
    function ValidateFields(parentId){
      // This function deals with validation of the form fields with data-compulsory = 'true'
      var x, y, i, valid = true;
      x = document.getElementById(parentId);
      
      y =x.querySelectorAll('[data-compulsory="true"]');

      // A loop that checks every input field in the current tab:
      for (i = 0; i < y.length; i++) {
        // console.log(y[i].value)
        // If a field is empty...
        if (y[i].value == "") {
          // add an "invalid" class to the field:
          y[i].className += " invalid";
          // and set the current valid status to false:
          valid = false;
        }
      }
      return valid; // return the valid status
    }

    // Validate fields - Phone Input specific. 
    function ValidatePhone(phoneId){
      var valid = true;
      let inPhone = document.querySelector("#"+phoneId);
      // console.log(inPhone.value)
      if (inPhone.value.trim()) {
        if (itiGuardian.isValidNumber()) {
          // Do nothing
        } else {
          inPhone.className += " invalid";
          valid = false;
        }
      }
      return valid; // return the valid status
    }
  </script>

  <!-- Upload Image -->
  <script>

    var fileinput = document.getElementById('select_image');

    // var preview = document.getElementById('preview');

    var form = document.getElementById('tutorImgUrl');

    var imgUrl_temp;

    // Img specific param
    var imgFile, type, size;// name, imgFile is a jSON obj

    
    function processfile(file) {
      
        if( !( /image/i ).test( file.type ) )
            {
                alert( "File "+ file.name +" is not an image." );
                return false;
            }

        // read the files
        var reader = new FileReader();
        reader.readAsArrayBuffer(file);
        
        reader.onload = function (event) {
          // blob stuff
          var blob = new Blob([event.target.result]); // create blob...
          window.URL = window.URL || window.webkitURL;
          var blobURL = window.URL.createObjectURL(blob); // and get it's URL
          
          // helper Image object
          var image = new Image();
          image.src = blobURL;
          //preview.appendChild(image); // preview commented out, I am using the canvas instead
          image.onload = function() {
            // have to wait till it's loaded
            var resized = resizeMe(image); // send it to canvas
            var newinput = document.createElement("input");
            newinput.type = 'hidden';
            newinput.name = 'images[]';
            newinput.value = resized; // put result from canvas into new hidden input
            // form.appendChild(newinput);
            // form.src = newinput;
            form.src = resized;
            var head = 'data:image/png;base64,';
            // console.log(Math.round((resized.length - head.length)*3/4));
            size = Math.round((resized.length - head.length)*3/4)

            uploadImage(resized, type, size, width, height);
          }
        };
    }

    function readfiles(files) {
      
        // remove the existing canvases and hidden inputs if user re-selects new pics
        var existinginputs = document.getElementsByName('images[]');
        var existingcanvases = document.getElementsByTagName('canvas');
        while (existinginputs.length > 0) { // it's a live list so removing the first element each time
          // DOMNode.prototype.remove = function() {this.parentNode.removeChild(this);}
          form.removeChild(existinginputs[0]);
          // preview.removeChild(existingcanvases[0]);
        } 
      
        for (var i = 0; i < files.length; i++) {
          // console.log(i)
          processfile(files[i]); // process each file at once
        }
        fileinput.value = ""; //remove the original files from fileinput
        // TODO remove the previous hidden inputs if user selects other files
    }

    // this is where it starts. event triggered when user selects files
    fileinput.onchange = function(){
      if ( !( window.File && window.FileReader && window.FileList && window.Blob ) ) {
        alert('The File APIs are not fully supported in this browser.');
        return false;
        }
      readfiles(fileinput.files);
    }

    // === RESIZE ====
    var max_height = 1024; 
    var max_width = 1024;
    var width = 0;
    var height = 0;
    function resizeMe(img) {
      
      var canvas = document.createElement('canvas');

      // console.log(width,height )
      width = img.width;
      height = img.height;
      // calculate the width and height, constraining the proportions
      if (width > height) {
        if (width > max_width) {
          //height *= max_width / width;
          height = Math.round(height *= max_width / width);
          width = max_width;
        }
      } else {
        if (height > max_height) {
          //width *= max_height / height;
          width = Math.round(width *= max_height / height);
          height = max_height;
        }
      }
      
      // resize the canvas and draw the image data into it
      canvas.width = width;
      canvas.height = height;
      var ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0, width, height);
      
      // preview.appendChild(canvas); // do the actual resized preview
      
      return canvas.toDataURL("image/jpeg",0.7); // get the data from canvas as 70% JPG (can be also PNG, etc.)

    }


    // Upload image to dB
    function uploadImage( file, type, size, width, height ){
      if(file != null) {
        $('#uploadModal').modal('show');

        // Create a root reference
        var storageRef = firebase.storage().ref("uploads");
        // Create a reference to 'tutorId.<imgType>'
        // var metadata = {
        //   contentType: type, 
        //   id: tutorId,
        //   size: size,
        //   width: width,
        //   height: height
        // };
        var metadata = {
          contentType: type, // Predefined by firestore
          customMetadata: {
            'id': tutorId,
            'size': size,
            'width': width,
            'height': height
          }
        };

        // Upload file and metadata to the object 'images/mountains.jpg'
        // var uploadTask = storageRef.child('images/' + tutorId).put(file, metadata);
        var uploadTask = storageRef.child('images/' + tutorId).putString(file, 'data_url', metadata);

        var elem = document.getElementById("myBar");
        // Listen for state changes, errors, and completion of the upload.
        uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED, // or 'state_changed'
          (snapshot) => {
            // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
            var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            console.log('Upload is ' + progress + '% done');
            elem.style.width = progress + "%";

            // if (progress == 100){
            //   $('#uploadModal').modal('hide');
            // }
            switch (snapshot.state) {
              case firebase.storage.TaskState.PAUSED: // or 'paused'
                console.log('Upload is paused');
                // alert("Upload is paused. Please try again.")
                // $('#uploadModal').modal('hide');
                func.showNotification('top','center', 'danger', 'error_outline', "Upload is paused. Please try again." );

                break;
              case firebase.storage.TaskState.RUNNING: // or 'running'
                console.log('Upload is running');
                break;
            }
            
          }, 
          (error) => {
            // A full list of error codes is available at
            // https://firebase.google.com/docs/storage/web/handle-errors
            switch (error.code) {
              case 'storage/unauthorized':
                // User doesn't have permission to access the object
                // alert("Upload failed. Please try again.")
                func.showNotification('top','center', 'danger', 'error_outline', "You do not have permission to upload. Please contact us." );

                $('#uploadModal').modal('hide');
                break;
              case 'storage/canceled':
                // User canceled the upload
                // alert("Upload canceled.")
                func.showNotification('top','center', 'danger', 'error_outline', "Upload canceled." );

                $('#uploadModal').modal('hide');
                break;

              // ...

              case 'storage/unknown':
                // alert("Upload failed. Please try again.");
                func.showNotification('top','center', 'danger', 'error_outline', "Upload failed. Please try again." );

                $('#uploadModal').modal('hide');
                // Unknown error occurred, inspect error.serverResponse
                break;
            }
          }, 
          () => {
            // Upload completed successfully, now we can get the download URL
            uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
              imgUrl_temp = downloadURL;


              // Once uploaded, update the new url
              var docRef = db.collection("Tutor").doc(tutorId);
              var docRefWithMerge = docRef.set({
                [IMAGE_KEY]: imgUrl_temp
              }, { merge: true });


              var allActiveCourseData = {
                [IMAGE_KEY]: imgUrl_temp,
              }
              // Update the profile pic, name, & etc of all the active courses..
              updateInfoInAllActiveCourse(allActiveCourseData);
              // TODO: Use promise to Update all courses under tutor profile
              // updateInfoInTutorCourse(allActiveCourseData);

              // Update metadata and sitemaps
              // Update meta data of user's public profile
              if (current_accountStatus == DEACTIVATED_ACCOUNT_STATUS_KEY || 
                current_accountStatus == SUSPENDED_ACCOUNT_STATUS_KEY){
                // Do nothing if the account is new, deactivated or suspended
                func.showNotification('top','center', 'success', 'check_circle', "Your profile picture is updated. Please activate your account." );

              }else {
                // Check if aWebUrl Exist or not. Update only if it exists.
                if (current_aweburl == null || current_aweburl == ""  ){
                  // Do nothing
                }else{
                  let detail_temp =""
                  if (currentYearsExperience == 0 || currentYearsExperience == null)
                    detail_temp = current_gender + " | " + current_age;
                  else if (currentYearsExperience == 1)
                    detail_temp = current_gender + " | " + current_age + " |  1 year of experience";
                  else
                    detail_temp = current_gender + " | " + current_age + " | "+ currentYearsExperience + " years of experience";
                  
                  console.log("detail: "+ detail_temp+ "   aweburl: "+current_aweburl);
                  updateMetaData(current_aweburl, current_name, detail_temp, imgUrl_temp);
                }
                func.showNotification('top','center', 'success', 'check_circle', "Your profile picture is updated.");
              }

              $('#uploadModal').modal('hide');

            });
          }
        );

      }
      
    }


  </script>
  
  <script>
    var coderesult;

    window.onload=function () {
      render();
    };
    function render() {
        // window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container');
        // recaptchaVerifier.render();

        window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
          // 'size': 'normal',
          'callback': (response) => {
              // reCAPTCHA solved, allow signInWithPhoneNumber.
              // ...
              // Enable the step1 verify button
              document.getElementById("btnVerify").setAttribute("style", "background-color: #2e74b6; cursor: pointer");
              // document.getElementById("btnVerify").style.cursor='pointer';
              // document.getElementById("btnVerify").disabled = false;

          },
          'expired-callback': () => {
              // Response expired. Ask user to solve reCAPTCHA again.
              // ...
          }
      });
        recaptchaVerifier.render();
            
    }
    function phoneAuth() {
      //get the number
      // let number = document.getElementById('phone').value;
      let number = itiPhone.getNumber();
      console.log(number)
      //phone number authentication function of firebase
      //it takes two parameter first one is number,,,second one is recaptcha
      firebase.auth().signInWithPhoneNumber(number,window.recaptchaVerifier).then(function (confirmationResult) {
          //s is in lowercase
        window.confirmationResult=confirmationResult;
        coderesult=confirmationResult;

        // Enable the step2 button
        document.getElementById("btnLogin").setAttribute("style", "background-color: #2e74b6; pointer");
        // document.getElementById("btnLogin").style.cursor='pointer';
        // document.getElementById("btnLogin").disabled = false;

        func.showNotification('top','center', 'success', 'check_circle', "We just sent a 6-digit verification code to "+document.getElementById('phone').value );

        console.log(coderesult);

      }).catch(function (error) {

        document.getElementById("phone").setAttribute("style", "background-color: #fff;");
        document.getElementById("phone").disabled = false;

        //Disable the step 1 button
        document.getElementById("btnVerify").setAttribute("style", "background-color: #c1c1c1; cursor: not-allowed");
        // document.getElementById("btnVerify").style.cursor='not-allowed';
        // document.getElementById("btnVerify").disabled = true;

        console.log("Phone Verification Failed Error Code: "+ error);
        func.showNotification('top','center', 'danger', 'error_outline', "Phone Verification Failed. Please make sure you enter a valid phone number." );

      });
    }
    function codeverify() {

        let code=document.getElementById('verificationCode').value;
        coderesult.confirm(code).then(function (result) {
          // alert("Successfully registered");
          let user=result.user;

          let tutorId = null;
          if (user.displayName == null ){
              tutorId = user.phoneNumber;
          }else
              tutorId = user.email.replace("[^a-zA-Z0-9]", "_").toLowerCase();

          // alert("Tutor Id: " + tutorId);
          // console.log("Tutor registered, ID: " + tutorId);

          const tutorRef = db.collection('Tutor').doc(tutorId);

          tutorRef.get()
            .then((docSnapshot) => {

              if (docSnapshot.exists) {

                // window.location.href = './'
                // User exist. Move to Step 1.
                setActiveStep(1);
                setActivePanel(1);      

              }else {
                // User does not exist. Register a new user.         
                var docData = {
                  [TOKEN_KEY]: null,    //main
                  [NAME_KEY] : 'New Tutor',    //main
                  [EMAIL_KEY]  : "", //main
                  [PHONE_KEY]  : itiPhone.getNumber(), //main
                  [AGE_KEY]  : 18, 
                  [GENDER_KEY]  : 1, // Female
                  [ADDRESS_1_KEY]  : "",
                  [ADDRESS_2_KEY]  : "",
                  [ADDRESS_POSTCODE_KEY]  : "",
                  [ADDRESS_STATE_KEY]  : "",
                  [IMAGE_KEY]  : "",
                  [NRIC_KEY]  : "",
                  [RATING_KEY]  : 0,
                  [RATING_TIMES_KEY]  : 0,
                  [RATING_FINAL_KEY]  : 0,
                  [PROFILE_STATUS_KEY]  : [false, false, false, false], // (identity, phone, qualification, location)
                  [CHECK_HOMETUTOR_KEY]  : false,  // Depreciated
                  [CHECK_PRIVATETUTOR_KEY]  : false, // Depreciated
                  [CHECK_GROUPTUTOR_KEY]  : false, // Depreciated
                  [CHECK_ONLINETUTOR_KEY]  : false, // Depreciated
                  [YEARS_EXPERIENCE_KEY]  : null,
                  [TUTORING_EXPERIENCE_KEY]  : "",
                  [TUTORING_APPROACH_KEY]  : "",
                  [QUALIFICATION_KEY]  : "",
                  [PREFERED_AREA_LIST_KEY]  : null,
                  [PREFERED_SUBJECT_LIST_KEY]  : null,
                  [AGENT_KEY]  : false,
                  [ACCOUNT_STATUS_KEY]  : DEACTIVATED_ACCOUNT_STATUS_KEY,
                  [CHECK_HOME_TUTOR_TO_STUDENT_KEY]  : false,
                  [CHECK_HOME_STUDENT_TO_TUTOR_KEY]  : false,
                  [CHECK_GROUP_KEY]  : false,
                  [CHECK_ONLINE_KEY]  : false,
                  [CHECK_ONLINE_GROUP_KEY]  : false,
                  [CHECK_TEACHING_LANGUAGE_ENGLISH_KEY]  : false,
                  [CHECK_TEACHING_LANGUAGE_BM_KEY]  : false,
                  [CHECK_TEACHING_LANGUAGE_BC_KEY]  : false,
                  [CHECK_TEACHING_LANGUAGE_BT_KEY]  : false,
                  [CHECK_TEACHING_LANGUAGE_OTHER_KEY]  : false,
                  [TUTOR_TIME_SLOT_MON_8AM_KEY]  : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_MON_12PM_KEY] : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_MON_3PM_KEY]  : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_MON_6PM_KEY]  : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_TUE_8AM_KEY]  : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_TUE_12PM_KEY] : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_TUE_3PM_KEY]  : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_TUE_6PM_KEY]  : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_WED_8AM_KEY]  : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_WED_12PM_KEY] : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_WED_3PM_KEY]  : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_WED_6PM_KEY]  : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_THU_8AM_KEY]  : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_THU_12PM_KEY] : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_THU_3PM_KEY]  : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_THU_6PM_KEY]  : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_FRI_8AM_KEY]  : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_FRI_12PM_KEY] : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_FRI_3PM_KEY]  : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_FRI_6PM_KEY]  : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_SAT_8AM_KEY]  : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_SAT_12PM_KEY] : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_SAT_3PM_KEY]  : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_SAT_6PM_KEY]  : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_SUN_8AM_KEY]  : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_SUN_12PM_KEY] : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_SUN_3PM_KEY]  : TUTOR_TIME_SLOT_CLOSE_KEY,
                  [TUTOR_TIME_SLOT_SUN_6PM_KEY]  : TUTOR_TIME_SLOT_CLOSE_KEY,
                  // Create a placeholder for aWebUrl. This param can only initiated by admin
                  // manually through https://golearn.com.my/admin/
                  [ADMIN_WEB_URL_KEY]  : "",
                  [ADMIN_PREMIUM_SUBJECT_LIMIT_KEY]  : 10,
                  [ADMIN_PREMIUM_CONNECT_LIMIT_KEY]  : 0,
                  [ADMIN_TOTAL_SUBJECT_LIMIT_KEY]  : 40,
                  [ADMIN_TOTAL_CONNECT_LIMIT_KEY]  : 0,
                  [ADMIN_PREFFERED_AREA_LIMIT_KEY]  : 5,
                  [ADMIN_PREFERRED_SUBJECT_LIMIT_KEY]  : 40,
                  [SYSTEM_LAST_ONLINE_KEY]  : firebase.firestore.Timestamp.fromDate(new Date())
                }

                db.collection("Tutor").doc(tutorId)
                  .set(docData, {merge: true})
                  .then(() => {
                      // window.location.href = './'

                    // User exist. Move to Step 1.
                    setActiveStep(1);
                    setActivePanel(1);  
                  })
                  .catch((error) => {
                    func.showNotification('top','center', 'danger', 'error_outline', "Registration failed. Please try again" );
                    // console.error("Error writing document: ", error);
                  });

                console.log("USer does not exist! Create a new one: "+ tutorId );
                // alert("USer does not exist! Create a new one: "+ tutorId );

              }
          });

        })
        .catch(function (error) {
          func.showNotification('top','center', 'danger', 'error_outline', "Phone Verification Failed. Please make sure you enter a valid 6-digit verification code." );
          console.log("Phone Verification Failed. Please make sure you enter a valid 6-digit verification code."+  error.message);
        });
    }

    // Use this after signin
    // Source: https://firebase.google.com/docs/auth/admin/verify-id-tokens#android
    function getToken(){
      firebase.auth().currentUser.getIdToken(/* forceRefresh */ true).then(function(idToken) {
        // Send token to your backend via HTTPS
        userToken = idToken;
        }).catch(function(error) {
          // Handle error
          
        });
    }

  </script>

</body>

</html>