<!doctype html>
<html lang="en">

<head>
  <title>GoLearn Tutor</title>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <!-- Fonts and icons -->
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
  <script src="https://kit.fontawesome.com/2bdd669e92.js" crossorigin="anonymous"></script>
  <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> -->

  <!-- Material Kit CSS -->
  <link href="../assets/css/material-dashboard.css?v=2.1.2" rel="stylesheet" />
  <!-- Firebase Init -->
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-firestore.js"></script>
  <script src="../js/firebase.js"></script>
  <!-- Tutor Portal specific CSS -->
  <link href="../css/tutor-portal.css" rel="stylesheet" />

  <!-- Rich Text Editor Init -->
  <script src="https://cdn.tiny.cloud/1/5dm77axvxwkliu22hg2ejlaqh4s246uo83bz98ogo4c3yeev/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
  <script>
    tinymce.init({
      selector:'#invNotes',
      plugins: "link",
      // toolbar: "link | undo redo",
      // menubar: false,
      setup: function (editor) {
        editor.on('change', function (e) {
          // console.log(e);
          invNotesOnChangeHandler();
        });
      }
    });
    tinymce.init({
      selector:'#invFooterNotes',
      plugins: "link",
      setup: function (editor) {
        editor.on('change', function (e) {
          // console.log(e);
          invFooterNotesOnChangeHandler();
        });
      }
    });
  </script>

  <style>
    .table {
        border: 1px solid #ccc;
        border-collapse: collapse;
    }
    .table th,
    .table td {
        border: 1px solid #ccc;
    }
    .table th,
    .table td {
        padding: 0.5rem;
    }
    .draggable {
        cursor: move;
        user-select: none;
    }
    .placeholder {
        background-color: #edf2f7;
        border: 2px dashed #cbd5e0;
    }
    .clone-list {
        border-top: 1px solid #ccc;
    }
    .clone-table {
        border-collapse: collapse;
        border: none;
    }
    .clone-table th{
        border: 1px solid #ccc;
        border-top: none;
        padding: 0.5rem;
        font-size: 1.2em;
        font-weight: 300;
    }

    .clone-table td {
        border: 1px solid #ccc;
        border-top: none;
        padding: 0.5rem;

        font-weight: 300;
    }
    .dragging {
        background: #fff;
        border-top: 1px solid #ccc;
        z-index: 999;
    }

    /* page view for A4  */
    page {
      background: white;
      display: block;
      margin: 0 auto;
      /* margin-bottom: 0.5cm; */
      box-shadow: 0 0 0.5cm rgba(0,0,0,0.5);
    }
    page[size="A4"] {  
      width: 21cm;
      height: auto; 
      min-height: 29.65cm; 
      /* Use a  height value slightly lower than 29.7 to avoid page break  */
      /* height: 29.7cm;  */
    }
    page[size="A4"][layout="landscape"] {
      width: 29.7cm;
      height: 21cm;  
    }

    
    /* .card-body footer1 {
        position: fixed;
    }
    
    .card-body footer1 {
        bottom: 0;
    } */
    .textarea1 {
      display: block;
      width: 100%;
      overflow: hidden;
      resize: both;
      min-height: 40px;
      line-height: 20px;
    }

    .textarea[contenteditable]:empty::before {
      content: "Placeholder still possible";
      color: gray;
    }
  </style>
</head>

<body>

  <div class="wrapper ">
    
    <div class="sidebar" data-color="purple" data-background-color="white" data-image="../assets/img/sidebar-3.jpg">
      <div class="logo">
        <a href="../" class="simple-text logo-mini">
			<img src="../source/logo.png" style="width: 216px; height: auto;" alt=""></img>
          
        </a>
        <a href="../" class="simple-text logo-normal">
         Welcome!
        </a>
      </div>
      <div class="sidebar-wrapper">
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link" href="../class/">
              <i class="material-icons">home</i>
              <p>Class</p>
            </a>
          </li>
		  		<li class="nav-item">
            <a class="nav-link" href="../student/">
              <i class="material-icons">work_outline</i>
              <p>Students</p>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="../teacher/">
              <i class="material-icons">format_list_bulleted</i>
              <p>Teachers</p>
            </a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="./">
              <i class="material-icons">attach_money</i>
              <p>Financial</p>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="main-panel">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top ">
        <div class="container-fluid">
          <div class="navbar-wrapper">
            <a class="navbar-brand" href="javascript:;">Financial <span><i class="material-icons" style="color: gray;">chevron_right</i></span> Create Invoice</a>
          </div>
          <button class="navbar-toggler" type="button" data-toggle="collapse" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
          </button>
          <div class="collapse navbar-collapse justify-content-end">
            <form class="navbar-form">
              <!-- Put empty placeholder here -->
            </form>

            <ul class="navbar-nav">
              <li class="nav-item" id="activationNavItem">
                <a href="#" class="btn btn-danger btn-round" style="visibility: hidden;" id="btnActivateAccount" ></a>
              </li>
              <li class="nav-item">
                <a class="navbar-brand" href="javascript:;">
                   Hi <span id="user"></span> !
                </a> 
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link" href="javascript:;" id="navbarDropdownNotification" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="material-icons">notifications</i> Notifications
                </a>
                <!-- <a class="nav-link" href="http://example.com" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="material-icons">notifications</i>
                  <span class="notification">5</span>
                  <p class="d-lg-none d-md-block">
                    Some Actions
                  </p>
                </a> -->
								<div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
									<p style="padding: 1em;" >No notification</p>
                  <!-- <a class="dropdown-item" href="#">Mike John responded to your email</a>
                  <a class="dropdown-item" href="#">You have 5 new tasks</a>
                  <a class="dropdown-item" href="#">You're now friend with Andrew</a>
                  <a class="dropdown-item" href="#">Another Notification</a>
                  <a class="dropdown-item" href="#">Another One</a> -->
                </div>
              </li>
              <!-- your navbar here -->
			  
			  			<li class="nav-item dropdown">
                <a class="nav-link" href="javascript:;" id="navbarDropdownProfile" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="material-icons">person</i>
                  <p class="d-lg-none d-md-block">
                    Account
                  </p>
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownProfile">
                  <a class="dropdown-item" href="../edit-profile.html">Edit Profile</a>
                  <a id="navPublicProfile" class="dropdown-item" href="#">My Public Profile</a>
									<a class="display:block; dropdown-item" href="../about.html">About</a>
									<div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="javascript:;" onclick="signOutFunction()" id="btn-logout">Log out</a>
									<div class="dropdown-divider"></div>
									<a style="font-weight: 500 ;padding: 0.5em ;text-align: center; width: 200px; background-color: #428dd4 ;display: block; color: #fff;" href="https://golearn.com.my/pricing/" target="_blank" id="btnUpgradeToPro">Upgrade to Pro</a>

                </div>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <!-- End Navbar -->

			<!-- Modal Start -->

      <!-- Edit Selected Client modal -->
      <div class="row">
        <div class="modal fade" id="editClientModal" tabindex="-1" role="dialog" aria-labelledby="editClientModalLabel" aria-hidden="true">
          <div class="modal-dialog  modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="editClientModalLabel">Edit Client Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="btEeditClientModalClose1">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="editClientModalBody">
                <div id="inClientId" value =''></div>
                <div class="form-group">
                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Name*</span> 
                  <input type="text" class="form-control" id="inClientName" data-compulsory="true" oninput="this.className = 'form-control'"  maxlength="40" readonly>
                </div>

                <div class="form-group">
                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Contact*</span> 
                  <input type="text" class="form-control" id="inClientContact" data-compulsory="true" oninput="this.className = 'form-control'"  maxlength="40" readonly>
                </div>
                <div class="form-group">
                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Email (Optional)</span> 
                  <input type="text" class="form-control" id="inClientEmail" data-compulsory="true" oninput="this.className = 'form-control'"  maxlength="40">
                </div>
                <div class="form-group">
                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Address (Optional) </span> 
                  <textarea class="form-control" maxlength="250" rows="4"  id="inClientAddr" data-compulsory="false"></textarea>
                </div>
                
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="btnEditClientModalClose2">Not Now</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnEditClientModalUpdate">Confirm</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- List / Load Admin's Students Modal -->
      <div class="row">
        <div class="modal fade" id="addStudentModal" tabindex="-1" role="dialog" aria-labelledby="addStudentModalLabel" aria-hidden="true">
          <div class="modal-dialog  modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="addStudentModalLabel">Select A Client (Parents / Guardian)</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <div class="row">
                  <div class="col-md-12" id="loadAdminStudentTop">

                    <div class="container" id="add-student-modal-container">
                      <!-- Student header -->
                      <div class="row lesson-header">
                        <!-- <div class="col-md-3">
                          <p>Student Name</p>
                        </div>
                        <div class="col-md-3">
                          <p>Gender</p>
                        </div>
                        <div class="col-md-3">
                          <p>Guardian Name</p>
                        </div> -->
                        <div class="col-md-3">
                          <p>Guardian Phone</p>
                        </div>
                        <div class="col-md-3">
                          <p>Guardian Name</p>
                        </div>
                        <div class="col-md-3">
                          <p>Student Name</p>
                        </div>
                        <div class="col-md-3">
                          <p>Action</p> 
                        </div>
                      </div>

                      <!-- Student List Start -->
                      
                    </div>
        
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-12 align-content-center">
                    <button type="button" class="btn btn-outline-primary btn-sm btn-round" id="btnAddAdminStudentModalLoadMore" >Load More</button>
                  </div>
                </div>

              </div>
              <div class="modal-footer">
                <!-- <button type="button" class="btn btn-success" data-dismiss="modal" id="" >Add New Teacher</button> -->
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <!-- <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnAddStudentModalUpdate" >Add</button> -->
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Edit business address and contact details modal -->
      <div class="row">
        <div class="modal fade" id="addBusinessDetailModal" tabindex="-1" role="dialog" aria-labelledby="addBusinessDetailModalLabel" aria-hidden="true">
          <div class="modal-dialog  modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="addBusinessDetailModalLabel">Edit Business Address and Contact</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="btnAddBusinessDetailModalClose1">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="addBusinessDetailModalBody">
                <div class="form-group">
                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Personal / Business Name* <span id="countName" style="color: grey; margin-left: 1rem;">0/40</span></span> 
                  <input type="text" class="form-control" id="inName" data-compulsory="true" oninput="this.className = 'form-control'"  maxlength="40">
                </div>

                <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0; margin-top: 1rem;">Current Business Details</span> 
                <p id="inDetails" style="padding : 1rem; border: solid thin #2e74b6;"></p>
                <div class="form-group">
                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">New Business Contact </span> 
                  <input type="text" class="form-control" id="inContact" data-compulsory="true" oninput="this.className = 'form-control'"  maxlength="40">
                </div>
                <div class="form-group">
                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">New Business Email </span> 
                  <input type="text" class="form-control" id="inEmail" data-compulsory="true" oninput="this.className = 'form-control'"  maxlength="40">
                </div>
                <div class="form-group">
                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">New Business Address </span> 
                  <textarea class="form-control" maxlength="250" rows="4"  id="inAddr" data-compulsory="false"></textarea>
                </div>
                
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="btnAddBusinessDetailModalClose2">Not Now</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnAddBusinessDetailModalUpdate">Confirm</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Activation modal -->
      <div class="row">
        <div class="modal fade" id="activationModal" tabindex="-1" role="dialog" aria-labelledby="activationModalLabel" aria-hidden="true">
          <div class="modal-dialog  modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="activationModalLabel">New message</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="btnActivationModalClose1">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="activationModalBody">
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="btnActivationModalClose2">Not Now</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnActivationModalUpdate">Join Us</button>
              </div>
            </div>
          </div>
        </div>
      </div>
			
      <!-- Sign Out modal -->
      <div class="row">
        <div class="modal fade" id="signOutModal" tabindex="-1" role="dialog" aria-labelledby="signOutModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="signOutLabel">Logging Out</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="btnSignOutModalClose1">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="signOutModalBody">
                Are you sure you want to continue?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="btnSignOutModalClose2">Cancel</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnSignOutModalUpdate">Confirm</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- View Tutor Modal -->
       <div class="row">
        <div class="modal fade" id="viewTutorModal" tabindex="-1" role="dialog" aria-labelledby="viewTutorModalLabel" aria-hidden="true">
          <div class="modal-dialog  modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="viewTutorModalLabel">Tutor Profile</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <div class="row">
                  <div class="col-md-4 text-center">
                    <div style="height: 140px;width: 140px; display: inline-block; position: relative; overflow: hidden; border-radius: 50%;">
                      <img id="viewTutorImgUrl" style="height: 100%;width: 100%; object-fit: cover;" src="../../assets/img/empty-photo.png"/>
                    </div>

                  </div>

                  <div class="col-md-8">
                    <span class="" style="font-size: smaller; font-weight: 300; color: gray; padding-right: 2rem;">Name</span> 
                    <input id="viewTutorName"  type="text" value='' class="form-control" style="pointer-events: none;" readonly>

                    <div class="row">
                      <div class="col-md-6">
                        <span class="" style="font-size: smaller; font-weight: 300; color: gray; padding-right: 2rem;">Phone</span> 
                        <input id="viewTutorPhone"  type="text" value='' class="form-control" style="pointer-events: none;" readonly>
    
                      </div>
                      <div class="col-md-6">
                        <span class="" style="font-size: smaller; font-weight: 300; color: gray; padding-right: 2rem;">Email</span> 
                        <input id="viewTutorEmail"  type="text" value='' class="form-control" style="pointer-events: none;" readonly>
                      </div>
                    </div>

   
                    <div class="row">
                      <div class="col-md-6">
                        <span class="" style="font-size: smaller; font-weight: 300; color: gray; padding-right: 2rem;">Gender</span> 
                        <div class="form-group">
                          <div class="form-check form-check-radio form-check-inline">
                            <label class="form-check-label">
                              <input class="form-check-input" type="radio" name="tutorGender" id="viewTutorGenderRadioMale" value="optionActive" data-compulsory="false" disabled>
                              Male
                              <span class="circle">
                                <span class="check"></span>
                              </span>
                            </label>
                          </div>
                          <div class="form-check form-check-radio form-check-inline">
                            <label class="form-check-label">
                              <input class="form-check-input" type="radio" name="tutorGender" id="viewTutorGenderRadioFemale" value="optionInactive" data-compulsory="false" disabled>
                              Female
                              <span class="circle">
                                <span class="check"></span>
                              </span>
                            </label>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <span class="" style="font-size: smaller; font-weight: 300; color: gray; padding-right: 2rem;">Age</span> 
                        <input id="viewTutorAge"  type="text" value='' class="form-control" style="pointer-events: none;" readonly>
    
                      </div>
                    </div>

                  </div>

                </div>
              </div>
              <div class="modal-footer">
                <a type="button" class="btn btn-primary" href="#" id="btnViewTutorModalFullProfile" disabled>View Full Profile</a>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <!-- <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnViewTutorModalUpdate">Update</button> -->
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Main content -->
      <div class="content">
        <div class="container-fluid">
          <!-- your content here -->

          <!-- Main content -->
          <!-- Button -->
          <div class="row d-flex" id="desciption-row" >
            <div class="p-2">
              <a href="./" class="btn btn-outline-primary btn-round" id="btnBack"><i class="material-icons" style="color: #2e74b6; margin-right: 0.5em; padding-bottom: 0.2em;">west</i> Back</a>
            </div>
            <div class="p-2">
              <!-- <button type="button" id="btnDownloadPdf"></button>  -->              
              <a href="javascript:;" class="btn btn-outline-primary btn-round" id="" onclick="generatePDFeKoopmans('invTemplate')"> Download as PDF</a>
            </div>

            <div class="ml-auto p-2">
              <a href="" class="btn btn-primary btn-round" id="btnSave" data-toggle="modal" data-target="#saveModal">Save and Continue <i class="material-icons" style="color: #fff; margin-left: 0.5em; padding-bottom: 0.2em;">east</i> </a>
            </div>
          </div>

          <!-- Main panel -->
          <div class="row">
            <div class="col-md-12">
              <div class="accordion" id="accordionExample" >
                <div class="card">
                  <div class="card-header" id="headingOne" style="padding: 0; margin: 0; ">
                    <h2 class="mb-0">
                      <a class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne" style="text-transform: none; font-size: medium;">
                        Add business details and logo
                      </a>
                    </h2>
                  </div>
              
                  <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample" style="padding: 0; margin: 0; ">
                    <div class="card-body" >
                      <div class="row">
                        <div class="col-md-4 text-center">

                          <div class="form-group">
                            
                            <div style="height: 150px;width: 225px; display: inline-block; position: relative; overflow: hidden; cursor: pointer;">
                              <img id="tutorImgUrl" style="height: 100%;width: 100%; object-fit: cover;" src="../../assets/img/empty-photo.png"/>
                            </div>
                            <input type="file" id="select_image" name="image" style="display:none" accept="image/x-png,image/jpeg"> </input>

                            <!-- <h6>Add Logo</h6> -->
                            <!-- <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0; line-height: 0">Maximum 5MB in size. JPEG or PNG formats. <br>Recommended size: 300 x 200 pixels</span>  -->
                          </div>
                        </div>

                        <div class="col-md-4">
                          <!--  Do nothing -->
                        </div>

                        <div class="col-md-4 text-right">
                          <h4 style="font-size: xx-large;margin-top: 1rem;">INVOICE</h4> 

                          <div class="form-group">
                            <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Summary (e.g class name, description of invoice) <span id="countTitle" style="color: grey; margin-left: 1rem;">0/40</span></span> 
                            <input type="text" class="form-control" id="invTitle" data-compulsory="true" oninput="this.className = 'form-control'"  maxlength="40" style="border: solid #2e74b6 thin; display: block;  padding-left: 0.5rem;">
                          </div>
                          <h4 id="invBizName" style="font-weight: 500;">Your Name</h4>
                          <h6 id="invBizDetails"  style="text-transform: none; font-weight: 300;"></h6>
                          <a href="javascript:;" data-toggle="modal" data-target="#addBusinessDetailModal">Edit Business Address and Contact</a>
                        </div>

                      </div>
                    
                    </div>
                  </div>
                </div>

                <div class="card">
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-4">
                        <h6>Billed To:</h6>
                        <h4 id="invClientName" style="font-weight: 500;"></h4>
                        <h6 id="invClientDetails" style="text-transform: none; font-weight: 300;"></h6>
                        <div class="div">
                          <a href="javascript:;" data-toggle="modal" data-target="#addStudentModal">Add Client</a>
                        </div>
                      </div>

                      <div class="col-md-4"></div>
                      <div class="col-md-4">
                        <div class="row">
                          <div class="col-6 text-right" style="padding-right: 0;">
                            <div style="margin-top: 0.8rem;">
                              <p style="font-weight: 500; text-transform: uppercase;">Invoice Number</p>                            
                            </div>
                            <div style="margin-top: 0.8rem;">
                              <p style="font-weight: 500; text-transform: uppercase;">Invoice Date</p>                           
                            </div>
                            <div style="margin-top: 0.8rem;">
                              <p style="font-weight: 500; text-transform: uppercase; color: red; ">Payment Due</p>                            
                            </div>
                            <div style="margin-top: 0.8rem;">
                              <p style="font-weight: 500; text-transform: uppercase;">Status</p>                            
                            </div>
                          </div>
                          <div class="col-6 text-left">
                            <input type="text" class="form-control" id="invNum" data-compulsory="true" oninput="this.className = 'form-control'"  maxlength="40" style="border: solid #2e74b6 thin; display: block; margin: 0.3rem; padding-left: 0.5rem;">
                            <input type="text" class="form-control" id="invIssueDate" data-compulsory="true" oninput="this.className = 'form-control'"  maxlength="40" style="border: solid #2e74b6 thin; display: block; margin: 0.3rem; padding-left: 0.5rem;">
                            <input type="text" class="form-control" id="invPaymentDue" data-compulsory="true" oninput="this.className = 'form-control'"  maxlength="40" style="border: solid #2e74b6 thin; display: block; margin: 0.3rem; padding-left: 0.5rem;">
                            <input type="text" class="form-control" id="invStatus" data-compulsory="true" oninput="this.className = 'form-control'"  maxlength="40" style="border: solid #2e74b6 thin; display: block; margin: 0.3rem; padding-left: 0.5rem;" value='New' readonly>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div style="margin-top: 1rem;"></div>
                    
                    <div class="row">
                      <div class="col-12"  style="overflow-x:auto;">
                        <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Note*: Quantity - Number of classes, hour of lessons conducated or relevant items</span>

                        <table id="table" class="table-light table-sm" cellspacing="0" width="100%">
                          <thead  style="background-color: grey; color: white;">
                            <tr>
                              <th style="width: 30px; min-width: 30px;"></th>
                              <th style="min-width: 200px;">Items</th>
                              <th style="width: 100px; min-width: 100px;text-align: right;">Quantity*</th>
                              <th style="width: 100px; min-width: 100px;text-align: right;">Price</th>
                              <th style="width: 100px; min-width: 100px;text-align: right;">Amount</th>
                              <th style="width: 30px; min-width: 30px;"></th>
                            </tr>
                          </thead>
                          <tbody id="itemBody">
                            <tr class="item">
                              <td><i class="fas fa-grip-vertical"></i></td>
                              <td><input type="text" class="form-control" style="border: solid #2e74b6 thin;" placeholder=" Enter item and description" oninput="printPreview();"></td>
                              <td><input type="number" class="form-control" style="border: solid #2e74b6 thin; text-align: right;" value="-" oninput="calculateAmount(); printPreview();"></td>
                              <td><input type="number" class="form-control" style="border: solid #2e74b6 thin; text-align: right;" value="-" oninput="calculateAmount(); printPreview();"></td>
                              <td style="text-align: right;"></td>
                              <td><i class="fas fa-minus-circle" style="color: red; cursor: pointer;" onclick="removeRow(this); printPreview();"></i></td>
                            </tr>
                            <tr class="subtotal">
                              <td></td>
                              <td></td>
                              <td></td>
                              <td style="text-align: right; font-weight: 500;">Subtotal</td>
                              <td style="text-align: right; font-weight: 500;" id="subtotalItem"></td>
                              <td></td>
                            </tr>
                          </tbody>
                        </table>

                        <table id="tableAdditionalItem" class="table-light table-sm" cellspacing="0" width="100%">
                          <thead style="visibility: collapse;">
                            <tr>
                              <th style="width: 30px; min-width: 30px;"></th>
                              <th style="min-width: 200px;">Items</th>
                              <th style="width: 100px; min-width: 100px;text-align: right;">Quantity</th>
                              <th style="width: 100px; min-width: 100px;text-align: right;">Price</th>
                              <th style="width: 100px; min-width: 100px;text-align: right;">Amount</th>
                              <th style="width: 30px; min-width: 30px;"></th>

                            </tr>
                          </thead>
                          <tbody>
                            <tr class="additional">
                              <td></td>
                              <td style="text-align: right;">
                                <div class="dropdown">
                                  <a class="btn btn-primary dropdown-toggle bg-white text-dark text-right" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="text-transform: none; padding: 0.6rem; margin: 0;">Select one</a>
                                  <div class="dropdown-menu" aria-labelledby="SortBy" id="sort-dropdown-menu">
                                    <a class="dropdown-item" href="javascript:;" onclick="disabledAdditionalItem(this); calculateAmount(); printPreview();" style="text-transform: none;">Select one</a>
                                    <a class="dropdown-item" href="javascript:;" onclick="enabledAdditionalItem(this, 'Discount'); calculateAmount(); printPreview();" style="text-transform: none;">Discount ( - )</a>
                                    <a class="dropdown-item" href="javascript:;" onclick="enabledAdditionalItem(this, 'Tax'); calculateAmount(); printPreview();" style="text-transform: none;">Tax Rate (%)</a>
                                  </div>
                                </div>
                              </td>
                              <td><input type="text" class="form-control" style="border: solid #2e74b6 thin; text-align: right; padding-right: 1rem;" placeholder='Item' oninput='printPreview();' readonly></td>
                              <td><input type="number" class="form-control" style="border: solid #2e74b6 thin; text-align: right;" value="0" oninput="calculateAmount(); printPreview();" readonly></td>
                              <td style="text-align: right;"></td>
                              <td></td>
                            </tr>
                          </tbody>
                        </table>
                      </div>

                      <div class="col-12">
                        <h3 style="text-align: right; font-weight: 500;">Total <span style="margin-left: 2rem;" id="grandTotal">RM0.00</span></h3>
                        <a href="javascript:;" class="btn btn-primary btn-round" id="addRow" style="text-transform: none;">Add New Item <i class="fas fa-plus-circle" style="color: #fff; margin-left: 0.5em; padding-bottom: 0.2em;"></i></a>
                        <a href="javascript:;" class="btn btn-primary btn-round" id="addAdditionalRow" style="text-transform: none;">Add New Additional Item <i class="fas fa-plus-circle" style="color: #fff; margin-left: 0.5em; padding-bottom: 0.2em;"></i></a>
                      </div>

                      <div class="col-12">
                        <div class="form-group">
                          <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin: 0;">Enter Notes <span id="countNotes" style="color: grey; margin-left: 1rem;">0/250</span></span> 
                          <textarea class="form-control" maxlength="250" rows="3"  id="invNotes" data-compulsory="false" placeholder="Enter notes that are visible to your client. (e.g payment guidelines) " oninput="" ></textarea>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="card">
                  <div class="card-header" id="headingThree" style="padding: 0; margin: 0; ">
                    <h2 class="mb-0">
                      <a class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree" style="text-transform: none; font-size: medium;">
                        Footer
                      </a>
                    </h2>
                  </div>
                  <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordionExample" style="padding: 0; margin: 0; ">
                    <div class="card-body" style="padding-top: 0; margin-top: 0; ">
                      <div class="form-group">
                        <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin: 0;">Enter Footer Notes <span id="countFooterNotes" style="color: grey; margin-left: 1rem;">0/250</span></span> 
                        <textarea class="form-control" maxlength="250" rows="3"  id="invFooterNotes" data-compulsory="false" placeholder="Write something ..."></textarea>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Preview -->
          <page size="A4" id="invTemplate" style="position: relative;">

            <div class="card-body" >
              <div class="row">
                <div class="col-4 text-center">

                  <div class="form-group">
                    <!-- <canvas id="myCanvas" style="height: 150px;width: 225px; object-fit: cover;" ></canvas> -->
                    <div style="height: 150px;width: 225px; display: inline-block; position: relative; overflow: hidden; cursor: pointer;">
                      <img id="previewTutorImgUrl" style="height: 100%;width: 100%; object-fit: cover;" src="../../assets/img/empty-photo.png" crossorigin="anonymous" alt = ""/>
                      <!-- <canvas id="myCanvas" ></canvas> -->
                    </div>
                  </div>
                </div>

                <div class="col-2">
                  <!--  Do nothing -->
                </div>

                <div class="col-6 text-right">
                  <h4 style="font-size: xx-large;margin-top: 1rem;">INVOICE</h4> 
                  <h5 id="previewInvTitle"  style="font-weight: 500;"></h5>
                  <h4 id="previewInvBizName" style="font-weight: 500;">Your Name</h4>
                  <h6 id="previewInvBizDetails" style="text-transform: none; font-weight: 300;"></p>
                </div>

              </div>
            
            </div>

            <hr style="margin: 0rem">
            <!-- style="position: relative; bottom: 35px; width: 100%; margin-top: 2rem;" -->
            <div class="card-body" style="position: relative; bottom: 35px; width: 100%; margin-top: 2rem;"> 
              <div class="row">
                <div class="col-4">
                  <h6>Billed To:</h6>
                  <h4 id="previewInvClientName" style="font-weight: 500;"></h4>
                  <h6 id="previewInvClientDetails"  style="text-transform: none; font-weight: 300;"></h6>
                </div>

                <div class="col-3"></div>
                <div class="col-5">
                  <div class="row">
                    <div class="col-6 text-right" style="padding-right: 0;">
                      <h6>Invoice Number</h6>
                      <h6>Invoice Date</h6>
                      <h6 style="color: red;">Payment Due</h6>
                      <h6>Status</h6>
                      
                      <!-- <p style="margin: 0.3rem; font-weight: bold;">Invoice Number</p>                            
                      <p style="margin: 0.3rem; font-weight: bold;">Invoice Date</p>                           
                      <p style="margin: 0.3rem; font-weight: bold;">Payment Due</p>                            
                      <p style="margin: 0.3rem; font-weight: bold;">Status</p> -->
                    </div>
                    <div class="col-6 text-left">
                      <h6 id="previewInvNum" style="font-weight: normal;"> - </h6>
                      <h6 id="previewInvIssueDate"> - </h6>
                      <h6 id="previewInvPaymentDue" style="color: red;"> - </h6>
                      <h6 id="previewInvStatus"> - </h6>
                      <!-- <p style="margin: 0.3rem;">0100010101</p>  
                      <p style="margin: 0.3rem;">Status</p>  
                      <p style="margin: 0.3rem;">Status</p>  
                      <p style="margin: 0.3rem;">Status</p>   -->
                     </div>
                  </div>
                </div>
              </div>

              <div style="margin-top: 1rem;"></div>
              
              <div class="row">
                <div class="col-12"  style="overflow-x:auto;">
                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Note*: Quantity - Number of classes, hour of lessons conducated or relevant items</span>
                  <table id="tablePreview" class="table-light table-sm" cellspacing="0" width="100%" >
                    <thead style="background-color: grey; color: white;">
                      <tr>
                        <th style="min-width: 200px; font-size: small;">Items</th>
                        <th style="width: 100px; min-width: 100px;text-align: right; font-size: small;">Quantity</th>
                        <th style="width: 100px; min-width: 100px;text-align: right; font-size: small;">Price</th>
                        <th style="width: 100px; min-width: 100px;text-align: right; font-size: small;">Amount</th>
                      </tr>
                    </thead>
                    <tbody id="previewItemBody">
                      <!-- <tr class="item">
                        <td style="font-size: small;"></td>
                        <td style="text-align: right; font-size: small;"></td>
                        <td style="text-align: right; font-size: small;"></td>
                        <td style="text-align: right; font-size: small;"></td>
                      </tr> -->
                      <tr class="subtotal" id='previewItemSubtotal'>
                        <td></td>
                        <td></td>
                        <td style="text-align: right; font-weight: 500; font-size: small;">Subtotal</td>
                        <td style="text-align: right; font-weight: 500; font-size: small;" id="previewSubtotalItem"></td>
                      </tr>
                    </tbody>
                  </table>

                  <table id="tableAdditionalItemPreview" class="table-light table-sm" cellspacing="0" width="100%">
                    <thead style="visibility: collapse;">
                      <tr>
                        <th style="min-width: 200px;">Items</th>
                        <th style="width: 100px; min-width: 100px;text-align: right;">Quantity</th>
                        <th style="width: 100px; min-width: 100px;text-align: right;">Price</th>
                        <th style="width: 100px; min-width: 100px;text-align: right;">Amount</th>
                      </tr>
                    </thead>
                    <tbody id="previewAdditionalItemBody">
                      <tr class="additional">
                        <td></td>
                        <td></td>
                        <td style="text-align: right; font-size: small;"></td>
                        <td style="text-align: right; font-size: small;"></td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <div class="col-12">
                  <h3 style="text-align: right; font-weight: 500;">Total <span style="margin-left: 2rem;" id="previewGrandTotal">RM0.00</span></h3>
                </div>

                <div class="col-12">
                  <!-- <p><strong>Solution with JS (only deals with line breaks): </strong> <textarea class="textarea resize-ta"></textarea></p> -->

                  <!-- <div class="form-group"> -->
                    <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin: 0;">Notes</span>
                    <span  id="previewInvNotes"></span>
                    <!-- <textarea class="form-control" maxlength="250" rows='3' oninput="console.log(this.scrollHeight); this.style.height = (this.scrollHeight) + 'px';// this.setAttribute('rows', 12)" style="height: 4300px; max-height: max-content; overflow: hidden;" id="previewInvNotes" data-compulsory="false" placeholder="Enter notes that are visible to your client. (e.g payment guidelines) " ></textarea> -->

                  <!-- </div> -->
                </div>
              </div>
            </div>
            
            <div class="card-body" id="preview-footer" style="padding-top: 0; margin-top: 0; position: absolute; bottom: 0; width: 100%;">
              <p id="previewInvFooterNotes" ></p>
            </div>

          </page>


        </div>

        <footer class="footer">
          <div class="container-fluid">
            <nav class="float-left">
            <ul>
              <!-- <li>
              <a href="https://golearn.com.my/join-us" target="_blank">
                Visit GoLearn Tutor
              </a>
              </li> -->
            </ul>
            </nav>
          </div>
        </footer>
      </div>
    </div>

  <div class="fixed-plugin">
    <div class="dropdown show-dropdown">
      <a href="#" data-toggle="dropdown">
				<i class="material-icons" style="font-size: 36px; padding: 0.2em; color: white;">apps</i>
      </a>
      <ul class="dropdown-menu">
		    <br>
        <li class="header-title">Get More Tuition Jobs?</li>
        <li class="button-container">
          <a href="https://golearn.com.my/job/" target="_blank" class="btn btn-primary btn-block">Apply Now</a>
        </li>
        
        <li class="button-container">
          <a href="https://golearn.com.my/" target="_blank" class="btn btn-default btn-block">
            Visit our website
          </a>
        </li>
       
        <li class="header-title">Follow and Like Us!</li>
        <li class="button-container text-center">
			    <button id="facebook" class="btn btn-round btn-facebook" onclick="window.open('https://www.facebook.com/FindTutorInMalaysia/', '_blank');"><i class="fa fa-facebook-f"></i> &middot; facebook</button>
          <button id="twitter"  class="btn btn-round btn-twitter" onclick="window.open('https://twitter.com/golearnmalaysia', '_blank');"><i class="fa fa-twitter"></i> &middot; twitter</button>
          <button id="instagram"  class="btn btn-round btn-twitter" style="background: linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%); " onclick="window.open('https://www.instagram.com/golearn.education/', '_blank');"><i class="fa fa-instagram"></i> &middot; instagram</button>
          <br>
          <br>
        </li>
        <li class="header-title">Found a problem? </li>
        <li class="button-container">
          <a href="https://golearn.com.my/submit-anything-to-us/" target="_blank" class="btn btn-warning btn-block">
            Let us know
          </a>
          <br>
        </li>
      </ul>
    </div>
  </div>
  
  <script src="../assets/js/core/jquery.min.js"></script>
  <script src="../assets/js/core/popper.min.js"></script>
  <script src="../assets/js/core/bootstrap-material-design.min.js"></script>
  <script src="../assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
  <!-- Plugin for the momentJs  -->
  <script src="../assets/js/plugins/moment.min.js"></script>
  <!--  Plugin for Sweet Alert -->
  <script src="../assets/js/plugins/sweetalert2.js"></script>
  <!-- Forms Validations Plugin -->
  <script src="../assets/js/plugins/jquery.validate.min.js"></script>
  <!-- Plugin for the Wizard, full documentation here: https://github.com/VinceG/twitter-bootstrap-wizard -->
  <!-- <script src="assets/js/plugins/jquery.bootstrap-wizard.js"></script> -->
  <!-- 	Plugin for Select, full documentation here: http://silviomoreto.github.io/bootstrap-select -->
  <!-- <script src="assets/js/plugins/bootstrap-selectpicker.js"></script> -->
  <!--  Plugin for the DateTimePicker, full documentation here: https://eonasdan.github.io/bootstrap-datetimepicker/ -->
  <!-- <script src="assets/js/plugins/bootstrap-datetimepicker.min.js"></script> -->
  <!--  DataTables.net Plugin, full documentation here: https://datatables.net/  -->
  <!-- <script src="assets/js/plugins/jquery.dataTables.min.js"></script> -->
  <!-- 	Plugin for Tags, full documentation here: https://github.com/bootstrap-tagsinput/bootstrap-tagsinputs  -->
  <!-- <script src="assets/js/plugins/bootstrap-tagsinput.js"></script> -->
  <!-- Plugin for Fileupload, full documentation here: http://www.jasny.net/bootstrap/javascript/#fileinput -->
  <!-- <script src="assets/js/plugins/jasny-bootstrap.min.js"></script> -->
  <!--  Full Calendar Plugin, full documentation here: https://github.com/fullcalendar/fullcalendar    -->
  <!-- <script src="assets/js/plugins/fullcalendar.min.js"></script> -->
  <!-- Vector Map plugin, full documentation here: http://jvectormap.com/documentation/ -->
  <!-- <script src="assets/js/plugins/jquery-jvectormap.js"></script> -->
  <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
  <!-- <script src="assets/js/plugins/nouislider.min.js"></script> -->
  <!-- Include a polyfill for ES6 Promises (optional) for IE11, UC Browser and Android browser support SweetAlert -->
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/core-js/2.4.1/core.js"></script> -->
  <!-- Library for adding dinamically elements -->
  <!-- <script src="assets/js/plugins/arrive.min.js"></script> -->
  <!--  Google Maps Plugin    -->
  <!-- <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script> -->
  <!-- Chartist JS -->
  <!-- <script src="assets/js/plugins/chartist.min.js"></script> -->
  <!--  Notifications Plugin    -->
  <script src="../assets/js/plugins/bootstrap-notify.js"></script>
  <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="../assets/js/material-dashboard.js?v=2.1.2" type="text/javascript"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.min.js" integrity="sha384-lpyLfhYuitXl2zRZ5Bn2fqnhNAKOAaM/0Kr9laMspuaMiZfGmfwRNFh8HlMy49eQ"  crossorigin="anonymous"></script>   
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8" crossorigin="anonymous"></script>
  
  <!-- Common constants -->
  <script src="../../assets/js/common.js" type="text/javascript"></script>
  <!-- Core Tutor Js -->
  <script src="../../assets/js/tutor-core.js" type="text/javascript"></script>
  <!-- HTML -> PDF -->
  <!-- <script src="../../assets/js/html2pdf.js" type="text/javascript"></script> -->

  <script src="https://raw.githack.com/eKoopmans/html2pdf/master/dist/html2pdf.bundle.js"></script> 


	<script>
    // Global Variables
    var tutorId;
    var current_name, current_email, current_phone, current_age, current_gender, current_imgUri, current_nric,
      current_address1, current_address2, current_addressPostCode, current_addressState,
      current_rating, current_ratingTimes, current_ratingFinal, current_profileStatus,
      current_token, current_agent, current_accountStatus;
    var currentYearsExperience, currentTutoringExperience, currentTutoringApproach, currentQualification, 
      current_preferedAreaList, current_preferedSubjectList;
    // Depreciated
    // var current_chk_homeTutor, current_chk_privateTutor, current_chk_groupTutor, current_chk_onlineTutor;
    var isModeHomeStudentToTutor, isModeHomeTutorToStudent, isModeGroup, isModeOnline, isModeOnlineGroup;
    var isLanEng, isLanBm, isLanBc, isLanBt, isLanOther;
    var current_chk_homeStudentToTutor, current_chk_homeTutorToStudent, current_chk_group, current_chk_online, current_chk_onlineGroup;
    var current_mon_8am, current_mon_12pm, current_mon_3pm, current_mon_6pm, 
      current_tue_8am, current_tue_12pm, current_tue_3pm, current_tue_6pm, 
      current_wed_8am, current_wed_12pm, current_wed_3pm, current_wed_6pm, 
      current_thu_8am, current_thu_12pm, current_thu_3pm, current_thu_6pm, 
      current_fri_8am, current_fri_12pm, current_fri_3pm, current_fri_6pm,
      current_sat_8am, current_sat_12pm, current_sat_3pm, current_sat_6pm, 
      current_sun_8am, current_sun_12pm, current_sun_3pm, current_sun_6pm;
    var current_aweburl, current_aPremiumSubjectLimit, current_aPremiumConnectLimit, current_aTotalSubjectLimit, 
     current_aTotalConnectLimit, current_aPreferredSubjectLimit, current_aPreferredAreaLimit;
     
    // Course-specific var
    var allCourseSize;

    var latestAdminStuDoc = null;// Store last document - Used for Admin's Student Load More btn in Add Student Modal

		var db = firebase.firestore();
		db.settings({ timestampsInSnapshots: true });

    // Set the nav name and global var, if user already login and have session Storage 
    var tutorInfoObj = null;
    if (JSON.parse(sessionStorage.getItem("tutorInfoObj")) == null ){
      // Do nothing
    }
    else{
      // Set the nav user name
      tutorInfoObj = JSON.parse(sessionStorage.getItem("tutorInfoObj"));
      document.getElementById("user").textContent = tutorInfoObj.name;

      current_name = (tutorInfoObj.name == null || tutorInfoObj.name == "")? "New Tutor" : tutorInfoObj.name;
      // current_email, 
      // current_phone, 
      current_age = (tutorInfoObj.age == null || tutorInfoObj.age == "")? "18" : tutorInfoObj.age; 
      current_gender= (tutorInfoObj.gender == 0)? "Male" : "Female"; 
      current_imgUri = (tutorInfoObj.imgUrl == null || tutorInfoObj.imgUrl == "")? "../assets/img/hello.gif" : tutorInfoObj.imgUrl;
      current_accountStatus = tutorInfoObj.accountStatus; // bool
      currentYearsExperience = tutorInfoObj.yearsExperience; // number
      currentTutoringExperience = tutorInfoObj.tutoringExperience;
      currentTutoringApproach = tutorInfoObj.tutoringApproach;
      currentQualification= tutorInfoObj.qualification;
      
      current_aweburl = tutorInfoObj.aWebUrl

      // updatePageView(current_accountStatus);
    }

		firebase.auth().onAuthStateChanged(function(user){
      
			if(!user){
        // Return to login if user does not exist.
				window.location.href = "../login.html"
			}else{
        // if the displayName is null, it means user register using Phone
        if (firebase.auth().currentUser.displayName == null ){
            tutorId = firebase.auth().currentUser.phoneNumber;
        }else{
          tutorId = firebase.auth().currentUser.email.replace("[^a-zA-Z0-9]", "_").toLowerCase();
        }
        loadUserInfo(tutorId);
        loadUserSettings(tutorId);
			}
		});


    // Load Tutor Settings
    function loadUserSettings(tutorId){
      
      // Tutor Id must be a phone with +60, no spacing or other chars
      var docRef = db.collection("Settings").doc(tutorId);
      
      docRef.get().then((doc) => {
        updatePageContent(doc);
      })
    }

    // Init Page View
    function updatePageContent(doc){

      // Business Profile
      document.getElementById("invBizName").textContent = doc.data()[SET_BIZ_NAME];
      let bizDetail = '';
      bizDetail += (doc.data()[SET_BIZ_PHONE] == null || doc.data()[SET_BIZ_PHONE] == '') ? '' : doc.data()[SET_BIZ_PHONE];
      bizDetail += (doc.data()[SET_BIZ_EMAIL] == null || doc.data()[SET_BIZ_EMAIL] == '') ? '' : ', <br>' + doc.data()[SET_BIZ_EMAIL];
      bizDetail += (doc.data()[SET_BIZ_ADDR] == null || doc.data()[SET_BIZ_ADDR] == '') ? '' : ', <br>' + doc.data()[SET_BIZ_ADDR];
      document.getElementById("invBizDetails").innerHTML = bizDetail;
      // document.getElementById("tutorImgUrl").src = doc.data()[SET_BIZ_IMG_URL] == null || doc.data()[SET_BIZ_IMG_URL] == '' ?  '../../assets/img/empty-photo.png' : doc.data()[SET_BIZ_IMG_URL];
      document.getElementById("tutorImgUrl").src = 'https://golearn.com.my/wp-content/uploads/Schedule-Management-Final.png';

      document.getElementById("invIssueDate").value = new Date().toLocaleDateString("en-GB");

      tinymce.get("invNotes").setContent(doc.data()[SET_INV_NOTE]);
      tinymce.get("invFooterNotes").setContent(doc.data()[SET_INV_FOOTER_NOTE]);
      // document.getElementById("invFooterNotes").innerHTML = doc.data()[SET_INV_FOOTER_NOTE];


      // Preview 
      // document.getElementById("previewTutorImgUrl").src = doc.data()[SET_BIZ_IMG_URL] == null || doc.data()[SET_BIZ_IMG_URL] == '' ?  '../../assets/img/empty-photo.png' : doc.data()[SET_BIZ_IMG_URL];
      // document.getElementById("previewTutorImgUrl").src = 'https://golearn.com.my/wp-content/uploads/Home-3-Simple-Steps-Photo-1-1-1536x1257.png';
      // document.getElementById("previewTutorImgUrl").src = '../../assets/img/empty-photo.png';


      // var c = document.getElementById("myCanvas");
      // var ctx = c.getContext("2d");
      // var img = document.getElementById("tutorImgUrl");
      // img.onload = function(){
      //   ctx.drawImage(img,0,0); // Or at whatever offset you like
      // };

      toDataURL(
        doc.data()[SET_BIZ_IMG_URL] == null || doc.data()[SET_BIZ_IMG_URL] == '' ?  '../../assets/img/empty-photo.png' : doc.data()[SET_BIZ_IMG_URL],
        function(dataUrl) {
          // console.log('RESULT:', dataUrl)
          
        }
      );

      
      // document.getElementById("previewInvTitle").textContent = doc.data()[SET_BIZ_NAME];
      document.getElementById("previewInvBizName").textContent = doc.data()[SET_BIZ_NAME];
      document.getElementById("previewInvBizDetails").innerHTML = bizDetail;

      document.getElementById("previewInvIssueDate").textContent = new Date().toLocaleDateString("en-GB");

      document.getElementById("previewInvNotes").innerHTML = doc.data()[SET_INV_NOTE];
      document.getElementById("previewInvFooterNotes").innerHTML = doc.data()[SET_INV_FOOTER_NOTE];

    }


    //---------- Init All Admin's Student details ----------//
    // Lesson Load More Button - Init
    const stuAdminLoadmore = document.querySelector('#btnAddAdminStudentModalLoadMore');
    stuAdminLoadmore.style.visibility='hidden';

    const stuAdminLoadMoreHandleClick = () =>{
      loadAllAdminStudents();
    }
    stuAdminLoadmore.addEventListener('click', stuAdminLoadMoreHandleClick );

    // Load All Admin's Students that owned by class admin. 
    var allStuModuleDoc = []; // Reset all students doc
    var allParentListDoc = []; // Get all the unique parents
    function loadAllAdminStudents(){

      allStuModuleDoc = []; // Init All Students Doc array
      // STUDENT Module
      let docRef = db.collection("Class")
          .doc("v1")
          .collection("Student")
          .where(STU_ADMIN_ID, "==", tutorId)
          .where(STU_STATUS_ADMIN, "==", true)
          .orderBy(STU_GUR_PHONE, 'asc')
          .startAfter(latestAdminStuDoc)
          .limit(10);

      docRef
      .get()
      .then((querySnapshot) => {
        querySnapshot.forEach((doc) => {
          
          allStuModuleDoc.push(doc.data());
          // console.log(doc.data());
          // renderAllAdminStudents(doc);
          renderAllAdminGuardian(doc);
          
        });
        
        console.log("allStuModuleDoc")
        console.log(allStuModuleDoc)

        latestAdminStuDoc = querySnapshot.docs[querySnapshot.docs.length - 1];
        // console.log(querySnapshot.docs.length)
        // Handle Lesson Load more btn
        if (querySnapshot.empty){
          stuAdminLoadmore.removeEventListener('click', stuAdminLoadMoreHandleClick );
        }

        if (querySnapshot.docs.length == 10){
          stuAdminLoadmore.style.visibility='visible';
        }else{
          stuAdminLoadmore.style.visibility='hidden';
        }
 
      }).catch((error) => {
          console.log("Error getting document:", error);
      });


    }

    
    // Render all admin's students in Add Student Modal
    function renderAllAdminGuardian(doc){
      
      let gurPhone_p = document.createElement('p');
      gurPhone_p.className = "student-item";
      gurPhone_p.textContent = doc.data()[STU_GUR_PHONE];
      let gurPhone_div = document.createElement('div');
      gurPhone_div.className = "col-md-3";
      gurPhone_div.appendChild(gurPhone_p);

      let gurName_p = document.createElement('p');
      gurName_p.className = "student-item";
      gurName_p.textContent = doc.data()[STU_GUR_NAME];
      let gurName_div = document.createElement('div');
      gurName_div.className = "col-md-3";
      gurName_div.appendChild(gurName_p);

      let stuName_p = document.createElement('p');
      stuName_p.className = "student-item";
      stuName_p.textContent = doc.data().childName;
      let stuName_div = document.createElement('div');
      stuName_div.className = "col-md-3";
      stuName_div.appendChild(stuName_p);

      // let stuGender_p = document.createElement('p');
      // stuGender_p.className = "student-item";
      // stuGender_p.textContent = (doc.data().childGender === 0) ? 'Male' : 'Female';
      // let stuGender_div = document.createElement('div');
      // stuGender_div.className = "col-md-3";
      // stuGender_div.appendChild(stuGender_p);

      let sel_btn = document.createElement('button');
      sel_btn.className = "btn btn-primary btn-sm";
      sel_btn.textContent = 'Select';
      sel_btn.setAttribute('data-dismiss','modal');
      sel_btn.setAttribute('data-toggle','modal');
      sel_btn.setAttribute('data-target','#editClientModal');
      sel_btn.setAttribute('type','button')
      // sel_btn.setAttribute('onclick',"AddNewStudentsToDB('"+doc.data().id+"')");
      sel_btn.setAttribute('data-gurid',doc.data()[STU_GUR_ID]);
      sel_btn.setAttribute('data-gurname',doc.data()[STU_GUR_NAME]);
      sel_btn.setAttribute('data-gurphone',doc.data()[STU_GUR_PHONE]);
      sel_btn.setAttribute('data-guremail',doc.data()[STU_GUR_EMAIL]);
      sel_btn.setAttribute('data-guraddr',doc.data()[STU_GUR_ADDR]);
      let sel_div = document.createElement('div');
      sel_div.className = "col-md-3";
      sel_div.appendChild(sel_btn);

      let stuDetail_div = document.createElement('div');
      stuDetail_div.className = 'row student-wrapper';
      stuDetail_div.appendChild(gurPhone_div);
      stuDetail_div.appendChild(gurName_div);
      stuDetail_div.appendChild(stuName_div);
      stuDetail_div.appendChild(sel_div);

      const add_student_modal_container = document.getElementById("add-student-modal-container");
      add_student_modal_container.appendChild(stuDetail_div)
      // add_student_modal_container.insertBefore(stuDetail_div, add_student_modal_container.children[1])
    }



    // Render all admin's students in Add Student Modal
    function renderAllAdminStudents(doc){
      
      let stuName_p = document.createElement('p');
      stuName_p.className = "student-item";
      stuName_p.textContent = doc.data().childName;
      let stuName_div = document.createElement('div');
      stuName_div.className = "col-md-3";
      stuName_div.appendChild(stuName_p);

      let stuGender_p = document.createElement('p');
      stuGender_p.className = "student-item";
      stuGender_p.textContent = (doc.data().childGender === 0) ? 'Male' : 'Female';
      let stuGender_div = document.createElement('div');
      stuGender_div.className = "col-md-3";
      stuGender_div.appendChild(stuGender_p);

      let gurName_p = document.createElement('p');
      gurName_p.className = "student-item";
      gurName_p.textContent = doc.data().gurName;
      let gurName_div = document.createElement('div');
      gurName_div.className = "col-md-3";
      gurName_div.appendChild(gurName_p);

      let sel_btn = document.createElement('button');
      sel_btn.className = "btn btn-primary btn-sm";
      sel_btn.textContent = 'Select';
      sel_btn.setAttribute('data-dismiss','modal');
      sel_btn.setAttribute('type','button')
      // sel_btn.setAttribute('onclick',"AddNewStudentsToDB('"+doc.data().id+"')");
      let sel_div = document.createElement('div');
      sel_div.className = "col-md-3";
      sel_div.appendChild(sel_btn);

      let stuDetail_div = document.createElement('div');
      stuDetail_div.className = 'row student-wrapper';
      stuDetail_div.appendChild(stuName_div);
      stuDetail_div.appendChild(stuGender_div);
      stuDetail_div.appendChild(gurName_div);
      stuDetail_div.appendChild(sel_div);

      const add_student_modal_container = document.getElementById("add-student-modal-container");
      add_student_modal_container.appendChild(stuDetail_div)
      // add_student_modal_container.insertBefore(stuDetail_div, add_student_modal_container.children[1])
    }


    // Tutor Specific
    function loadUserInfo(tutorId){
      // Tutor Id must be a phone with +60, no spacing or other chars
      var docRef = db.collection("Tutor").doc(tutorId);
      

      // docRef.get().then((doc) => {
      docRef.onSnapshot((doc) => {

        if (doc.exists) {
          // console.log("Document data:", doc.data());

          current_name = (doc.data().name == null || doc.data().name == "")? "New Tutor" : doc.data().name;
          // current_email, 
          // current_phone, 
          current_age = (doc.data().age == null || doc.data().age == "")? "18" : doc.data().age; 
          current_gender= (doc.data().gender == 0)? "Male" : "Female"; 
          current_imgUri = (doc.data().imgUrl == null || doc.data().imgUrl == "")? "../assets/img/hello.gif" : doc.data().imgUrl;
          current_accountStatus = doc.data().accountStatus; 
          currentYearsExperience = doc.data().yearsExperience; // number
          currentTutoringExperience = doc.data().tutoringExperience;
          currentTutoringApproach = doc.data().tutoringApproach;
          currentQualification= doc.data().qualification;
          current_mon_8am = doc.data().tMon8am;
          current_mon_12pm= doc.data().tMon12pm; 
          current_mon_3pm = doc.data().tMon3pm;  
          current_mon_6pm = doc.data().tMon6pm;  
          current_tue_8am = doc.data().tTue8am;  
          current_tue_12pm= doc.data().tTue12pm;  
          current_tue_3pm = doc.data().tTue3pm;  
          current_tue_6pm = doc.data().tTue6pm;  
          current_wed_8am = doc.data().tWed8am;  
          current_wed_12pm= doc.data().tWed12pm;  
          current_wed_3pm = doc.data().tWed3pm;  
          current_wed_6pm = doc.data().tWed6pm;  
          current_thu_8am = doc.data().tThu8am;  
          current_thu_12pm= doc.data().tThu12pm;  
          current_thu_3pm = doc.data().tThu3pm;  
          current_thu_6pm = doc.data().tThu6pm;  
          current_fri_8am = doc.data().tFri8am;  
          current_fri_12pm= doc.data().tFri12pm;  
          current_fri_3pm = doc.data().tFri3pm;  
          current_fri_6pm = doc.data().tFri6pm; 
          current_sat_8am = doc.data().tSat8am;  
          current_sat_12pm= doc.data().tSat12pm;  
          current_sat_3pm = doc.data().tSat3pm;  
          current_sat_6pm = doc.data().tSat6pm;  
          current_sun_8am = doc.data().tSun8am;  
          current_sun_12pm= doc.data().tSun12pm;  
          current_sun_3pm = doc.data().tSun3pm;  
          current_sun_6pm = doc.data().tSun6pm; 

          // Store data to sessionStorage
          var tutorDataObj = {
            [NAME_KEY] : doc.data().name,
            [EMAIL_KEY] : doc.data().email,
            [PHONE_KEY] : doc.data().phone,
            [AGE_KEY] : doc.data().age,
            [GENDER_KEY] : doc.data().gender,
            [ADDRESS_1_KEY] :doc.data().address1,
            [ADDRESS_2_KEY] :doc.data().address2,
            [ADDRESS_POSTCODE_KEY] :doc.data().addressPostCode,
            [ADDRESS_STATE_KEY] :doc.data().addressState,
            [IMAGE_KEY] : doc.data().imgUrl,
            // [NRIC_KEY] : doc.data().name,
            [RATING_KEY] : doc.data().rating,
            [RATING_TIMES_KEY] : doc.data().ratingTimes,
            [RATING_FINAL_KEY] : doc.data().ratingFinal,
            [PROFILE_STATUS_KEY] : doc.data().profileStatus,
            // [CHECK_HOMETUTOR_KEY] : doc.data().name,
            // [CHECK_PRIVATETUTOR_KEY] : doc.data().name,
            // [CHECK_GROUPTUTOR_KEY] : doc.data().name,
            // [CHECK_ONLINETUTOR_KEY] : doc.data().name,
            [YEARS_EXPERIENCE_KEY] :doc.data().yearsExperience,
            [TUTORING_EXPERIENCE_KEY] :doc.data().tutoringExperience,
            [TUTORING_APPROACH_KEY] : doc.data().tutoringApproach,
            [QUALIFICATION_KEY] : doc.data().qualification,
            [PREFERED_AREA_LIST_KEY] : doc.data().preferedAreaList,
            [PREFERED_SUBJECT_LIST_KEY] : doc.data().preferedSubjectList,
            [AGENT_KEY] : doc.data().agent,
            [ACCOUNT_STATUS_KEY] : doc.data().accountStatus,
            
            [CHECK_HOME_TUTOR_TO_STUDENT_KEY] : doc.data().modeHomeTutorToStudent,
            [CHECK_HOME_STUDENT_TO_TUTOR_KEY] : doc.data().modeHomeStudentToTutor,
            [CHECK_GROUP_KEY] : doc.data().modeGroup,
            [CHECK_ONLINE_KEY] : doc.data().modeOnline,
            [CHECK_ONLINE_GROUP_KEY] : doc.data().modeOnlineGroup,
            [CHECK_TEACHING_LANGUAGE_ENGLISH_KEY] : doc.data().lanEng,
            [CHECK_TEACHING_LANGUAGE_BM_KEY] : doc.data().lanBm,
            [CHECK_TEACHING_LANGUAGE_BC_KEY] : doc.data().lanBc,
            [CHECK_TEACHING_LANGUAGE_BT_KEY] : doc.data().lanBt,
            [CHECK_TEACHING_LANGUAGE_OTHER_KEY] : doc.data().lanOther,

            [TUTOR_TIME_SLOT_MON_8AM_KEY] : doc.data().tMon8am,
            [TUTOR_TIME_SLOT_MON_12PM_KEY] : doc.data().tMon12pm,
            [TUTOR_TIME_SLOT_MON_3PM_KEY] : doc.data().tMon3pm,
            [TUTOR_TIME_SLOT_MON_6PM_KEY] : doc.data().tMon6pm,
            [TUTOR_TIME_SLOT_TUE_8AM_KEY] : doc.data().tTue8am,
            [TUTOR_TIME_SLOT_TUE_12PM_KEY] : doc.data().tTue12pm,
            [TUTOR_TIME_SLOT_TUE_3PM_KEY] : doc.data().tTue3pm,
            [TUTOR_TIME_SLOT_TUE_6PM_KEY] : doc.data().tTue6pm,
            [TUTOR_TIME_SLOT_WED_8AM_KEY] : doc.data().tWed8am,
            [TUTOR_TIME_SLOT_WED_12PM_KEY] : doc.data().tWed12pm,
            [TUTOR_TIME_SLOT_WED_3PM_KEY] : doc.data().tWed3pm,
            [TUTOR_TIME_SLOT_WED_6PM_KEY] : doc.data().tWed6pm,
            [TUTOR_TIME_SLOT_THU_8AM_KEY] : doc.data().tThu8am,
            [TUTOR_TIME_SLOT_THU_12PM_KEY] : doc.data().tThu12pm,
            [TUTOR_TIME_SLOT_THU_3PM_KEY] : doc.data().tThu3pm,
            [TUTOR_TIME_SLOT_THU_6PM_KEY] : doc.data().tThu6pm,
            [TUTOR_TIME_SLOT_FRI_8AM_KEY] : doc.data().tFri8am,
            [TUTOR_TIME_SLOT_FRI_12PM_KEY] : doc.data().tFri12pm,
            [TUTOR_TIME_SLOT_FRI_3PM_KEY] : doc.data().tFri3pm,
            [TUTOR_TIME_SLOT_FRI_6PM_KEY] : doc.data().tFri6pm,
            [TUTOR_TIME_SLOT_SAT_8AM_KEY] : doc.data().tSat8am,
            [TUTOR_TIME_SLOT_SAT_12PM_KEY] : doc.data().tSat12pm,
            [TUTOR_TIME_SLOT_SAT_3PM_KEY] : doc.data().tSat3pm,
            [TUTOR_TIME_SLOT_SAT_6PM_KEY] : doc.data().tSat6pm,
            [TUTOR_TIME_SLOT_SUN_8AM_KEY] : doc.data().tSun8am,
            [TUTOR_TIME_SLOT_SUN_12PM_KEY] : doc.data().tSun12pm,
            [TUTOR_TIME_SLOT_SUN_3PM_KEY] : doc.data().tSun3pm,
            [TUTOR_TIME_SLOT_SUN_6PM_KEY] : doc.data().tSun6pm,
            // Create a placeholder for aWebUrl. This param can only initiated by admin
            // manually through https://golearn.com.my/admin/admin-portal.html
            [ADMIN_WEB_URL_KEY] : doc.data().aWebUrl,
            [ADMIN_PREMIUM_SUBJECT_LIMIT_KEY] : doc.data().aPremiumSubjectLimit,
            [ADMIN_PREMIUM_CONNECT_LIMIT_KEY] : doc.data().aPremiumConnectLimit,
            [ADMIN_TOTAL_SUBJECT_LIMIT_KEY] : doc.data().aTotalSubjectLimit,
            [ADMIN_TOTAL_CONNECT_LIMIT_KEY] : doc.data().aTotalConnectLimit,
            [ADMIN_PREFFERED_AREA_LIMIT_KEY] : doc.data().aPreferredAreaLimit,
            [ADMIN_PREFERRED_SUBJECT_LIMIT_KEY] : doc.data().aPreferredSubjectLimit
          }

          // Set tutorInfoObj as sessionStorage
          sessionStorage.setItem("tutorInfoObj", JSON.stringify(tutorDataObj));

          // Set the nav user name and public profile link
          document.getElementById("user").textContent = doc.data().name;

          if (doc.data().aWebUrl == null || doc.data().aWebUrl == ""){
            document.getElementById("navPublicProfile").href = "#"  ;
            document.getElementById("navPublicProfile").setAttribute("style", "background: #d6d6d6; pointer-events: none; cursor: default;")  
          } else{
            document.getElementById("navPublicProfile").href = "https://golearn.com.my/tutor/"+doc.data().aWebUrl;
            document.getElementById("navPublicProfile").target = "_blank";
          }
          
          if (current_accountStatus == DEACTIVATED_ACCOUNT_STATUS_KEY){
            document.getElementById("btnActivateAccount").setAttribute("style", "visibility: visible;" );
            document.getElementById("btnActivateAccount").textContent = "Activate My Account Now";
            document.getElementById("btnActivateAccount").href = "https://golearn.com.my/join-us/";
            document.getElementById("btnActivateAccount").target = "_blank";
          }else if (current_accountStatus == SUSPENDED_ACCOUNT_STATUS_KEY){
            document.getElementById("btnActivateAccount").setAttribute("style", "visibility: visible;" );
            document.getElementById("btnActivateAccount").textContent = "Account Suspended. Fix Now";
            document.getElementById("btnActivateAccount").href = "https://golearn.com.my/contact-us/";
            document.getElementById("btnActivateAccount").target = "_blank";
          }else {
            let activationNavItem = document.querySelector('#activationNavItem');
            let activationNavItemIsExist = document.querySelector('#activationNavItem') !== null;
            // console.log(activationNavItemIsExist)
            // Remove NavItem if exist
            if (activationNavItemIsExist){
              activationNavItem.parentNode.removeChild(activationNavItem);
            }else{
              // Do nothing
            }
          }
        } else {
           // Do nothing 
        }
      });

    };

    // Load client's active classes
    function loadAllClientClassInfo(clientId){

      var docRef = db.collection("Class")
          .doc("v1")
          .collection("Class")
          .where(CLASS_VIEWER_ID_ARR, "array-contains", clientId)
          .where(CLASS_ADMIN_ID, "==", tutorId)
          .where(STATUS_KEY, "==", true)
          .where(CLASS_STATUS, "==", CLASS_STATUS_ACTIVE)
          .orderBy(CLASS_NAME, 'asc');
          // .startAfter(latestClassDoc)
          // .limit(10);

      docRef
      .get()
      .then((querySnapshot) => {
        querySnapshot.forEach((doc) => {
          console.log(doc.data())
          // docsObj.push(doc.data());
          // courseId = doc.id;

          if (doc.data()[CLASS_FEES_TYPE_KEY] === FEES_TYPE_PER_MONTH_KEY){
            // Per month
            renderAllInvoiceItems(doc);
            
          }else{
            // Per Hour
            LoadLessonInfo(doc);//, doc.data()[CLASS_ID], doc.data()[CLASS_FEES_KEY] );
            

          }
        });
        // Assign draggle feature to all items
        assignDraggable();
        // Calculate the amount
        calculateAmount ();
        // Update preview
        printPreview();
      });

    };

    // Load Lesson Details
    function LoadLessonInfo( classDoc ){//classId, classPerHourFee){
      let today = new Date();
      let month = today.getUTCMonth() + 1; //months from 1-12
      let day = today.getUTCDate();
      let year = today.getUTCFullYear();
      console.log(''+month+year);
      
      // Get all lessons of this month
      let docRef = db.collection("Class")
          .doc("v1")
          .collection("Lesson")
          .where("classId", "==", classDoc.data()[CLASS_ID])
          .where(LESSON_MONTH_TYPE, "==", parseInt(''+year+month)) 
          .where("status", "==", true)
          .orderBy('lesDate', 'asc');
   
      docRef
      .get()
      .then((querySnapshot) => {
        console.log('Total Lessons Found: '+querySnapshot.docs.length);

        querySnapshot.forEach((doc) => {
          console.log(doc.data());
          
          renderAllLessonItems(doc, classDoc.data()[CLASS_FEES_KEY]);
          
        });
        renderAllInvoiceItems(classDoc);
        // Assign draggle feature to all items
        assignDraggable();
        // Calculate the amount
        calculateAmount();
        // Update preview
        printPreview();
 
      }).catch((error) => {
          console.log("Error getting document:", error);
      });

    }

    // Render class components
    function renderAllInvoiceItems(doc){
    // <tr class="item">
    //   <td><i class="fas fa-grip-vertical"></i></td>
    //   <td><input type="text" class="form-control" style="border: solid #2e74b6 thin;" placeholder=" Enter item and description"></td>
    //   <td><input type="number" class="form-control" style="border: solid #2e74b6 thin; text-align: right;" value="1" oninput="calculateAmount()"></td>
    //   <td><input type="number" class="form-control" style="border: solid #2e74b6 thin; text-align: right;" value="0" oninput="calculateAmount()"></td>
    //   <td style="text-align: right;"></td>
    //   <td><i class="fas fa-minus-circle" style="color: red; cursor: pointer;" onclick="removeRow(this)"></i></td>
    // </tr>

      let td1_html = '';
      td1_html = "<i class='fas fa-grip-vertical'></i>";
      let td1 = document.createElement('td');
      td1.innerHTML = td1_html;

      let td2_html = '';
      let className = doc.data()[CLASS_NAME];
      td2_html = "<input type='text' class='form-control' style='border: solid #2e74b6 thin; padding-left: 0.5rem;' placeholder='Enter item and description' value='"+ className +"' onclick='printPreview();'>";
      let td2 = document.createElement('td');
      td2.innerHTML = td2_html;

      let td3_html = '';
      let quantity = doc.data()[CLASS_FEES_TYPE_KEY] === FEES_TYPE_PER_MONTH_KEY ? 1 : '-';
      td3_html = "<input type='number' class='form-control' style='border: solid #2e74b6 thin; text-align: right;' oninput='calculateAmount(); printPreview();' value='"+ quantity +"'>";
      let td3 = document.createElement('td');
      td3.innerHTML = td3_html;

      let td4_html = '';
      let classFee = doc.data()[CLASS_FEES_TYPE_KEY] === FEES_TYPE_PER_MONTH_KEY ? doc.data()[CLASS_FEES_KEY] : '-';
      td4_html = "<input type='number' class='form-control' style='border: solid #2e74b6 thin; text-align: right;' oninput='calculateAmount(); printPreview();' value='"+ classFee +"'>";
      let td4 = document.createElement('td');
      td4.innerHTML = td4_html;
      
      let td5 = document.createElement('td');
      td5.setAttribute('style', "text-align: right;");

      let td6_html = '';
      td6_html = "<i class='fas fa-minus-circle' style='color: red; cursor: pointer;' onclick='removeRow(this); printPreview();'></i>";
      let td6 = document.createElement('td');
      td6.innerHTML = td6_html;

      // Tr top
      let tr = document.createElement('tr');
      tr.className = 'item';
      tr.appendChild(td1);
      tr.appendChild(td2);
      tr.appendChild(td3);
      tr.appendChild(td4);
      tr.appendChild(td5);
      tr.appendChild(td6);

      const itemBody = document.getElementById('itemBody');
      itemBody.insertBefore(tr, itemBody.children[0])
      // itemBody.appendChild(tr);
    }

    // Render Lesson components
    function renderAllLessonItems(doc, classPerHourFee){

      let td1_html = '';
      td1_html = "<i class='fas fa-grip-vertical'></i>";
      let td1 = document.createElement('td');
      td1.innerHTML = td1_html;

      let td2_html = '';
      let date = doc.data()[LESSON_DATE].toDate().toLocaleDateString("en-GB");

      // Timeslot
      let timeslot = '';
      let startTime, endTime = '';

      startTime = doc.data()[LESSON_START];
      endTime = doc.data()[LESSON_END];
      // console.log(parseInt(startTime.substring(0, 2)))
      startTime = (parseInt(startTime.substring(0, 2))>12) ? (parseInt(startTime.substring(0, 2)) - 12) + startTime.substring(2, 5) + 'PM' : startTime + 'AM';
      endTime = (parseInt(endTime.substring(0, 2))>12) ? (parseInt(endTime.substring(0, 2)) - 12) + endTime.substring(2, 5) + 'PM' : endTime + 'AM';
      
      timeslot = '  -  Lesson on '+ date+ ', '+startTime+'-'+endTime;

      td2_html = "<input type='text' class='form-control' style='border: solid #2e74b6 thin;' placeholder='Enter item and description' value='"+ timeslot +"'>";
      let td2 = document.createElement('td');
      td2.innerHTML = td2_html;

      let td3_html = '';
      //create date format          
      var timeStart = new Date("01/01/2007 " + doc.data()[LESSON_START]);
      var timeEnd = new Date("01/01/2007 " + doc.data()[LESSON_END]);
      let timeEllapsed = (timeEnd - timeStart)/1000/60/60; // Convert from ms to Hour

      let quantity = isNaN(timeEllapsed) ? 1 : timeEllapsed;
      td3_html = "<input type='number' class='form-control' style='border: solid #2e74b6 thin; text-align: right;' oninput='calculateAmount()' value='"+ quantity +"'>";
      let td3 = document.createElement('td');
      td3.innerHTML = td3_html;

      let td4_html = '';
      let classFee = isNaN(classPerHourFee) ? 0 : classPerHourFee;
      td4_html = "<input type='number' class='form-control' style='border: solid #2e74b6 thin; text-align: right;' oninput='calculateAmount()' value='"+ classFee +"'>";
      let td4 = document.createElement('td');
      td4.innerHTML = td4_html;
      
      let td5 = document.createElement('td');
      td5.setAttribute('style', "text-align: right;");

      let td6_html = '';
      td6_html = "<i class='fas fa-minus-circle' style='color: red; cursor: pointer;' onclick='removeRow(this)'></i>";
      let td6 = document.createElement('td');
      td6.innerHTML = td6_html;

      // Tr top
      let tr = document.createElement('tr');
      tr.className = 'item';
      tr.appendChild(td1);
      tr.appendChild(td2);
      tr.appendChild(td3);
      tr.appendChild(td4);
      tr.appendChild(td5);
      tr.appendChild(td6);

      const itemBody = document.getElementById('itemBody');
      itemBody.insertBefore(tr, itemBody.children[0])
      // itemBody.appendChild(tr);
    }



    //-------- Item Table Handling Start-----------------/
    const table = document.getElementById('table');
    const tableAdditionalItem = document.getElementById('tableAdditionalItem');
    let draggingEle;
    let draggingRowIndex;
    let placeholder;
    let list;
    let isDraggingStarted = false;

    // The current position of mouse relative to the dragging element
    let x = 0;
    let y = 0;

    // Swap two nodes
    const swap = function (nodeA, nodeB) {
        const parentA = nodeA.parentNode;
        const siblingA = nodeA.nextSibling === nodeB ? nodeA : nodeA.nextSibling;

        // Move `nodeA` to before the `nodeB`
        nodeB.parentNode.insertBefore(nodeA, nodeB);

        // Move `nodeB` to before the sibling of `nodeA`
        parentA.insertBefore(nodeB, siblingA);
    };

    // Check if `nodeA` is above `nodeB`
    const isAbove = function (nodeA, nodeB) {
        // Get the bounding rectangle of nodes
        const rectA = nodeA.getBoundingClientRect();
        const rectB = nodeB.getBoundingClientRect();

        return rectA.top + rectA.height / 2 < rectB.top + rectB.height / 2;
    };

    const cloneTable = function () {
      const rect = table.getBoundingClientRect();
      const width = parseInt(window.getComputedStyle(table).width);

      list = document.createElement('div');
      list.classList.add('clone-list');
      list.style.position = 'fixed';
      list.style.left = `${rect.left}px`;
      list.style.top = `${rect.top}px`;
      table.parentNode.insertBefore(list, table);

      // Hide the original table
      table.style.visibility = 'hidden';

      table.querySelectorAll('tr').forEach(function (row) {
        // Create a new table from given row
        const item = document.createElement('div');
        item.classList.add('draggable');

        const newTable = document.createElement('table');
        // newTable.setAttribute('class', 'clone-table');
        newTable.setAttribute('class', 'table-light table-sm');
        newTable.setAttribute('cellspacing', "0");
        newTable.setAttribute('width',"100%");
        newTable.style.width = `${width}px`;

        const newRow = document.createElement('tr');
        const cells = [].slice.call(row.children);
        cells.forEach(function (cell) {
          const newCell = cell.cloneNode(true);
          newCell.style.width = `${parseInt(window.getComputedStyle(cell).width)}px`;
          newRow.appendChild(newCell);
        });

        newTable.appendChild(newRow);
        item.appendChild(newTable);
        list.appendChild(item);
      });
    };

    const mouseDownHandler = function (e) {
        // Get the original row
        // Layer 1
        let originalRow = e.target.parentNode;
        if (originalRow.nodeName.toLowerCase() === 'tr'){
          // Correct parents node. Do nothing
        }else {
          // Layer 2
          originalRow = originalRow.parentNode;
          if (originalRow.nodeName.toLowerCase() === 'tr'){
          // Correct parents node. Do nothing
          }else {
            // Layer 3
            originalRow = originalRow.parentNode;
            if (originalRow.nodeName.toLowerCase() === 'tr'){
            // Correct parents node. Do nothing
            }else {
              // Layer 4
              // Impossible to  reach here
              originalRow = originalRow.parentNode;
              if (originalRow.nodeName.toLowerCase() === 'tr'){
              // Correct parents node. Do nothing
              }else {
                // Layer 5
                // Impossible to  reach here
                originalRow = originalRow.parentNode;
                if (originalRow.nodeName.toLowerCase() === 'tr'){
                  // Correct parents node. Do nothing
                }else {
                  // Layer 6
                  // Impossible to  reach here
                  originalRow = originalRow.parentNode;
                  if (originalRow.nodeName.toLowerCase() === 'tr'){
                    // Correct parents node. Do nothing
                  }else {
                    // There must be so many nested tag inside a cell. 
                    // Technically, it is impossible to reach here. 
                    // In case you are here, just add more layers.
                  }
                }
              }
            }
          }

        }

        draggingRowIndex = [].slice.call(table.querySelectorAll('tr')).indexOf(originalRow);
        // Determine the mouse position
        x = e.clientX;
        y = e.clientY;

        // Attach the listeners to `document`
        document.addEventListener('mousemove', mouseMoveHandler);
        document.addEventListener('mouseup', mouseUpHandler);
    };

    const mouseMoveHandler = function (e) {
      if (!isDraggingStarted) {
        isDraggingStarted = true;

        cloneTable();
        // console.log(draggingRowIndex);
        // console.log([].slice.call(list.children));
        draggingEle = [].slice.call(list.children)[draggingRowIndex];
        draggingEle.classList.add('dragging');

        // Let the placeholder take the height of dragging element
        // So the next element won't move up
        placeholder = document.createElement('div');
        placeholder.classList.add('placeholder');
        draggingEle.parentNode.insertBefore(placeholder, draggingEle.nextSibling);
        placeholder.style.height = `${draggingEle.offsetHeight}px`;
      }

      // Set position for dragging element
      draggingEle.style.position = 'absolute';
      draggingEle.style.top = `${draggingEle.offsetTop + e.clientY - y}px`;
      draggingEle.style.left = `${draggingEle.offsetLeft + e.clientX - x}px`;

      // Reassign the position of mouse
      x = e.clientX;
      y = e.clientY;

      // The current order
      // prevEle
      // draggingEle
      // placeholder
      // nextEle
      const prevEle = draggingEle.previousElementSibling;
      const nextEle = placeholder.nextElementSibling;

      // The dragging element is above the previous element
      // User moves the dragging element to the top
      // We don't allow to drop above the header
      // (which doesn't have `previousElementSibling`)
      if (prevEle && prevEle.previousElementSibling && isAbove(draggingEle, prevEle)) {
        // The current order    -> The new order
        // prevEle              -> placeholder
        // draggingEle          -> draggingEle
        // placeholder          -> prevEle
        swap(placeholder, draggingEle);
        swap(placeholder, prevEle);
        return;
      }

      // The dragging element is below the next element
      // User moves the dragging element to the bottom
      if (nextEle && isAbove(nextEle, draggingEle)) {
        // The current order    -> The new order
        // draggingEle          -> nextEle
        // placeholder          -> placeholder
        // nextEle              -> draggingEle
        swap(nextEle, placeholder);
        swap(nextEle, draggingEle);
      }
    };

    const mouseUpHandler = function () {
        // Remove the placeholder
        placeholder && placeholder.parentNode.removeChild(placeholder);

        draggingEle.classList.remove('dragging');
        draggingEle.style.removeProperty('top');
        draggingEle.style.removeProperty('left');
        draggingEle.style.removeProperty('position');

        // Get the end index
        const endRowIndex = [].slice.call(list.children).indexOf(draggingEle);

        isDraggingStarted = false;

        // Remove the `list` element
        list.parentNode.removeChild(list);

        // Move the dragged row to `endRowIndex`
        let rows = [].slice.call(table.querySelectorAll('tr'));
        draggingRowIndex > endRowIndex
            ? rows[endRowIndex].parentNode.insertBefore(rows[draggingRowIndex], rows[endRowIndex])
            : rows[endRowIndex].parentNode.insertBefore(
                  rows[draggingRowIndex],
                  rows[endRowIndex].nextSibling
              );

        // Bring back the table
        table.style.removeProperty('visibility');

        // Remove the handlers of `mousemove` and `mouseup`
        document.removeEventListener('mousemove', mouseMoveHandler);
        document.removeEventListener('mouseup', mouseUpHandler);
    };

    // Run first 
    const assignDraggable = function(){
      table.querySelectorAll('tr').forEach(function (row, index) {
        // Ignore the header
        // We don't want user to change the order of header
        if (index === 0) {
            return;
        }
        // Ignore row with certain class name
        else if(row.className != 'item'){
          return;
        } 

        // console.log(row)
        // console.log(row.className)
        const firstCell = row.firstElementChild;
        firstCell.classList.add('draggable');
        firstCell.addEventListener('mousedown', mouseDownHandler);
      });
    }

    // Find the parents node through while loops
    // ref: https://www.jsdiaries.com/how-to-loop-through-parent-nodes-in-javascript/
    const findAscendingTag = (el, tag) => {
        while (el.parentNode) {
          el = el.parentNode;
          // console.log(el.tagName)
          if (el.tagName === tag)
            return el;
          else{
            
          }
          // return el.tagName === tag ? el : null;
        }
      }

    // Discount Selected
    function calculateDiscount(elem){
      let selectedNode = elem.parentNode.parentNode.children[0];
      selectedNode.value = elem.textContent;
      selectedNode.textContent = elem.textContent;

      var trParent = findAscendingTag(elem, "TR");
      // TODO: Assign discount function to the cell next to this element
      console.log(trParent);
    }

    // Tax Rate Selected
    function calculateRate(elem){
      let selectedNode = elem.parentNode.parentNode.children[0];
      selectedNode.value = elem.textContent;
      selectedNode.textContent = elem.textContent;

      var trParent = findAscendingTag(elem, "TR");
      // TODO: Assign tax rate function to the cell next to this element

      // Calculate Subtotal of Item
      let subTotal = calculateSubtotal();

      console.log(trParent);
    }

    // Calculate the amount for Normal Items based on quantity and unit price
    function calculateAmount (){
      // // Get the value of Quantity at 3rd cell
      // let itemParent = findAscendingTag(elem, "TR");
      // let quantity = itemParent.children[2].getElementsByTagName("input")[0].value;
      // // Get the value of Price at 4th cell
      // let price = itemParent.children[3].getElementsByTagName("input")[0].value;
      // // Set the value of Amount at 5th cell
      // if (isNaN(quantity) ||isNaN(price) ){
      //   itemParent.children[4].textContent = 'INVALID'; 
      // }else {
      //   let amount = quantity * price;
      //   itemParent.children[4].textContent = (amount >= 0) ? 'RM'+amount.toFixed(2) : '- RM'+ Math.abs(amount).toFixed(2)
      // }
      
      let subTotal = calculateSubtotal();
      let total = calculateTotal(subTotal);
      
    }


    // Calculate the subtotal for all Normal Items
    function calculateSubtotal(){

      let subTotal = 0;
      let subTotalText = ''
      table.querySelectorAll('tr').forEach(function (row, index) {
        
        // Ignore the header
        // We don't want user to change the order of header
        if (index === 0) {
          return;
        }
        // Ignore row with certain class name
        else if(row.className != 'item'){
          return;
        }

        // console.log(row)
        // Calculate the subtotal amount
        let quantity = row.children[2].getElementsByTagName("input")[0].value;
        let price = row.children[3].getElementsByTagName("input")[0].value;

        // Set the value of Amount at 5th cell
        if (isNaN(quantity) ||isNaN(price) ){
          row.children[4].textContent = 'INVALID'; 
        }
        else if (quantity== '' && price== ''){
          // If no input to quantity and value, clear the amount.
          row.children[4].textContent = '';
        }
        else {
          let amount = quantity * price;
          subTotal += amount;
          row.children[4].textContent = (amount >= 0) ? 'RM'+amount.toFixed(2) : '- RM'+ Math.abs(amount).toFixed(2)
        }
      });

      if (isNaN(subTotal) ){
        subTotalText = 'INVALID';
        // console.log(subTotalText)
        document.getElementById("subtotalItem").textContent = subTotalText;
        return 0;
      }else {

        subTotalText = (subTotal >= 0) ? 'RM'+subTotal.toFixed(2) : '- RM'+ Math.abs(subTotal).toFixed(2)
        // console.log(subTotalText)
        document.getElementById("subtotalItem").textContent = subTotalText;
        return subTotal;

      }

    }

    // Calculate the subtotal for all Normal + Additional Items
    function calculateTotal(subTotal){

      let total = subTotal;
      let temp_amount = 0;
      let totalText = '';
      tableAdditionalItem.querySelectorAll('tr').forEach(function (row, index) {
        
        // Ignore the header
        // We don't want user to change the order of header
        if (index === 0) {
          return;
        }
        // Ignore row with certain class name
        else if(row.className != 'additional'){
          return;
        }

        // console.log(row)
        // Get the Action: 2rd TF tag cell > div tag > first A tag
        let action = row.children[1].children[0].children[0].textContent;

        // Get input value
        let input = parseFloat(row.children[3].getElementsByTagName("input")[0].value);

        // console.log(action);
        // console.log(input);

        if (action === 'Discount ( - )'){
          temp_amount = -input;
          total = total - input;
         
        }else if(action === 'Tax Rate (%)'){
          temp_amount = total * (input) / 100;
          total = total * (100 + input) / 100;
          
        }else{
          // No change
          temp_amount = 0;
          total = total;
          
        }
        // console.log('Total: '+total);
        // Set the value of Amount at 5th cell
        if (isNaN(temp_amount)){
          row.children[4].textContent = 'INVALID'; 
        }
        else {
          row.children[4].textContent = (temp_amount >= 0) ? '+ RM'+temp_amount.toFixed(2) : '- RM'+ Math.abs(temp_amount).toFixed(2)
        }
        // if (isNaN(total)){
        //   row.children[4].textContent = 'INVALID'; 
        // }else {
        //   row.children[4].textContent = (total >= 0) ? 'RM'+total.toFixed(2) : '- RM'+ Math.abs(total).toFixed(2)
        // }

      });

      // Set the grand total.
      if (isNaN(total) ){
          totalText = 'INVALID';
          // console.log(totalText)
          document.getElementById("grandTotal").textContent = totalText;
        }
      else 
      {
        totalText = (total >= 0) ? 'RM'+total.toFixed(2) : '- RM'+ Math.abs(total).toFixed(2)
        // console.log(totalText)
        document.getElementById("grandTotal").textContent = totalText;
      }

    }

    // Enable / Disable the first additional item when 'Select One' is picked
    function enabledAdditionalItem(elem, itemName){
      // let selectedNode = elem.parentNode.parentNode.children[0];
      // selectedNode.value = elem.textContent;
      // selectedNode.textContent = elem.textContent;

      // Get the TR parents node
      var trParent = findAscendingTag(elem, "TR");

      // Setup 2nd cell: dropdown menu - find the first A tag
      trParent.children[1].getElementsByTagName("a")[0].value = elem.textContent;
      trParent.children[1].getElementsByTagName("a")[0].textContent = elem.textContent;

      // Setup 3rd cell: itemName input
      // document.getElementById("firstAddItemName").removeAttribute("readonly");
      trParent.children[2].getElementsByTagName("input")[0].removeAttribute("readonly");
      // document.getElementById("firstAddItemName").value = itemName;
      trParent.children[2].getElementsByTagName("input")[0].value = itemName;

      // Setup 4th cell: itemAmount input
      // document.getElementById("firstAddItemPrice").removeAttribute("readonly");
      trParent.children[3].getElementsByTagName("input")[0].removeAttribute("readonly");
    }
    
    
    function disabledAdditionalItem(elem){
      // let selectedNode = elem.parentNode.parentNode.children[0];
      // selectedNode.value = elem.textContent;
      // selectedNode.textContent = elem.textContent;

      // Get the TR parents node
      var trParent = findAscendingTag(elem, "TR");

      // Setup 2nd cell: dropdown menu - find the first A tag
      trParent.children[1].getElementsByTagName("a")[0].value = elem.textContent;
      trParent.children[1].getElementsByTagName("a")[0].textContent = elem.textContent;

      // Setup 3rd cell: itemName input
      // document.getElementById("firstAddItemName").setAttribute("readonly", true);
      trParent.children[2].getElementsByTagName("input")[0].setAttribute("readonly", true);
      // document.getElementById("firstAddItemName").value = '';
      trParent.children[2].getElementsByTagName("input")[0].value = '';

      // Setup 4th cell: itemAmount input
      // document.getElementById("firstAddItemPrice").setAttribute("readonly", true);
      trParent.children[3].getElementsByTagName("input")[0].setAttribute("readonly", true);
      // document.getElementById("firstAddItemPrice").value = 0;
      trParent.children[3].getElementsByTagName("input")[0].value = 0;

    }

    // Add an item
    function addRow(){
      let draggableRowLastIndex = document.getElementById("table").querySelectorAll('.draggable').length;
      // Create an empty <tr> element and add it to the last position of draggable items.
      var row = table.insertRow(draggableRowLastIndex + 1);
      // console.log(draggableRowLastIndex);

      // Insert new cells (<td> elements) at the 1st and 2nd position of the "new" <tr> element:
      var cell1 = row.insertCell(0);
      var cell2 = row.insertCell(1);
      var cell3 = row.insertCell(2);
      var cell4 = row.insertCell(3);
      var cell5 = row.insertCell(4);
      var cell6 = row.insertCell(5);

      row.className = 'item'
      // Add some text to the new cells:
      cell1.innerHTML = "<i class='fas fa-grip-vertical'></i>";
      cell2.innerHTML = "<input type='text' class='form-control' style='border: solid #2e74b6 thin; padding-left: 0.5rem;' placeholder=' Enter item and description' oninput='printPreview();'>";
      cell3.innerHTML = "<input type='number' class='form-control' style='border: solid #2e74b6 thin; text-align: right;' value='1' oninput='calculateAmount(this); printPreview();'>";
      cell4.innerHTML = "<input type='number' class='form-control' style='border: solid #2e74b6 thin; text-align: right;' value='0' oninput='calculateAmount(this); printPreview();'>";
      cell5.setAttribute('style', 'text-align: right;');
      cell6.innerHTML = "<i class='fas fa-minus-circle' style='color: red; cursor: pointer;' onclick='removeRow(this); printPreview();'></i>";

      assignDraggable();
    }

    // Add an additional 
    function addAdditionalRow(){

      let draggableRowLastIndex = document.getElementById("tableAdditionalItem").querySelectorAll('.additional').length;
      // Create an empty <tr> element and add it to the last position of draggable items.
      var row = tableAdditionalItem.insertRow(draggableRowLastIndex + 1);
      row.className = 'additional'
      console.log(draggableRowLastIndex);

      // Insert new cells (<td> elements) at the 1st and 2nd position of the "new" <tr> element:
      var cell1 = row.insertCell(0);
      var cell2 = row.insertCell(1);
      var cell3 = row.insertCell(2);
      var cell4 = row.insertCell(3);
      var cell5 = row.insertCell(4);
      var cell6 = row.insertCell(5);

      // Add some text to the new cells:
      cell1.innerHTML = "";
    
      let dropdown_discount = document.createElement('a');
      dropdown_discount.className = 'dropdown-item';
      dropdown_discount.textContent = 'Discount ( - )';
      dropdown_discount.setAttribute('href', 'javascript:;');
      dropdown_discount.setAttribute('style', 'text-transform: none;');
      dropdown_discount.setAttribute('onclick', "enabledAdditionalItem(this, 'Discount'); calculateAmount(); printPreview();");
      let dropdown_tax = document.createElement('a');
      dropdown_tax.className = 'dropdown-item';
      dropdown_tax.textContent = 'Tax Rate (%)';
      dropdown_tax.setAttribute('href', 'javascript:;');
      dropdown_tax.setAttribute('style', 'text-transform: none;');
      dropdown_tax.setAttribute('onclick', "enabledAdditionalItem(this, 'Tax'); calculateAmount(); printPreview();");
      let dropdown = document.createElement('div');
      dropdown.className = 'dropdown-menu';
      dropdown.appendChild(dropdown_discount);
      dropdown.appendChild(dropdown_tax);
      let dropdown_btn = document.createElement('a');
      dropdown_btn.className = 'btn btn-primary dropdown-toggle bg-white text-dark text-right';
      dropdown_btn.type = 'Button';
      dropdown_btn.textContent = 'Select one';
      dropdown_btn.setAttribute('style', 'text-transform: none; padding: 0.6rem; margin: 0;');
      dropdown_btn.setAttribute('data-toggle', 'dropdown');
      dropdown_btn.setAttribute('aria-haspopup', 'true');
      dropdown_btn.setAttribute('aria-expanded', 'false');
      let dropdown_top = document.createElement('div');
      dropdown_top.className = 'dropdown';
      dropdown_top.appendChild(dropdown_btn);
      dropdown_top.appendChild(dropdown);

      cell2.setAttribute('style', "text-align: right");
      cell2.appendChild(dropdown_top);

      cell3.innerHTML = "<input type='text' class='form-control' style='border: solid #2e74b6 thin; text-align: right; padding-right: 1rem;' oninput='printPreview();'placeholder='Item' readonly>";

      cell4.innerHTML = "<input type='number' class='form-control' style='border: solid #2e74b6 thin; text-align: right;' value='0' oninput='calculateAmount(); printPreview();' readonly>";
      cell5.setAttribute('style', 'text-align: right;');
      cell6.innerHTML = "<i class='fas fa-minus-circle' style='color: red; cursor: pointer;' onclick='removeRow(this); printPreview();'></i>";

      assignDraggable();
    }

    // Remove an item
    function removeRow(elem){

      // console.log(elem)
      // Get the original row
      // Layer 1
      let originalRow = elem.parentNode;
      if (originalRow.nodeName.toLowerCase() === 'tr'){
        // Correct parents node. Do nothing
      }else {
        // Layer 2
        originalRow = originalRow.parentNode;
        if (originalRow.nodeName.toLowerCase() === 'tr'){
        // Correct parents node. Do nothing
        }else {
          // Layer 3
          originalRow = originalRow.parentNode;
          if (originalRow.nodeName.toLowerCase() === 'tr'){
          // Correct parents node. Do nothing
          }else {
            // Layer 4
            // Impossible to  reach here
            originalRow = originalRow.parentNode;
            if (originalRow.nodeName.toLowerCase() === 'tr'){
            // Correct parents node. Do nothing
            }else {
              // Layer 5
              // Impossible to  reach here
              originalRow = originalRow.parentNode;
              if (originalRow.nodeName.toLowerCase() === 'tr'){
                // Correct parents node. Do nothing
              }else {
                // Layer 6
                // Impossible to  reach here
                originalRow = originalRow.parentNode;
                if (originalRow.nodeName.toLowerCase() === 'tr'){
                  // Correct parents node. Do nothing
                }else {
                  // There must be so many nested tag inside a cell. 
                  // Technically, it is impossible to reach here. 
                  // In case you are here, just add more layers.
                }
              }
            }
          }
        }

      }


      // $( "#timeSlot-"+id ).remove();
      originalRow.parentNode.removeChild(originalRow);

      // After removing item, recalculate total
      calculateAmount();
    }
    
    const tablePreview = document.getElementById('tablePreview');
    const tableAdditionalItemPreview = document.getElementById('tableAdditionalItemPreview');
    // Print Preview
    function printPreview(){

      // init the preview template size 
      document.getElementById('invTemplate').style.height = 'auto';

      // clear all spaces details in preview
      let totalPreviewItem = tablePreview.querySelectorAll('.item').length;
      // console.log('totalPreviewItem ' + totalPreviewItem);
      tablePreview.querySelectorAll('.item').forEach(function (row, index) {
        row.remove();
      });

      let totalAdditionalItemPreview = tableAdditionalItemPreview.querySelectorAll('.additional').length;
      // console.log('totalPreviewItem ' + totalPreviewItem);
      tableAdditionalItemPreview.querySelectorAll('.additional').forEach(function (row, index) {
        row.remove();
      });

      document.getElementById('previewSubtotalItem').textContent='';
      document.getElementById('previewGrandTotal').textContent='';


      // Print Items
      // Print Additional Items
      let itemsLength = document.getElementById("table").querySelectorAll('.draggable').length;
      let additionalItemsLength = document.getElementById("tableAdditionalItem").querySelectorAll('.additional').length;
      
      console.log('additionalItemsLength: ' +additionalItemsLength);
      table.querySelectorAll('tr').forEach(function (row, index) {
        // Ignore the header
        // We don't want user to change the order of header
        if (index === 0) {
          return;
        }
        // Ignore row with certain class name
        else if(row.className != 'item'){
          return;
        }

        // Get the value of each item row
        let desc = row.children[1].getElementsByTagName("input")[0].value;
        let quantity = row.children[2].getElementsByTagName("input")[0].value;
        let price = row.children[3].getElementsByTagName("input")[0].value;
        let amount = row.children[4].textContent;
        // console.log(desc, quantity, price, amount);

        printItem(desc, quantity, price, amount);

      });


      tableAdditionalItem.querySelectorAll('tr').forEach(function (row, index) {
        // Ignore the header
        // We don't want user to change the order of header
        if (index === 0) {
          return;
        }
        // Ignore row with certain class name
        else if(row.className != 'additional'){
          return;
        }

        // Get the value of each additional item row
        let additionalSelector = row.children[1].getElementsByTagName("a")[0].textContent;
        let additionalItem = row.children[2].getElementsByTagName("input")[0].value;
        let additionalItemValue = row.children[3].getElementsByTagName("input")[0].value;
        let amount = row.children[4].textContent;
        
        // If the item is less than 1
        // if (additionalItemsLength <= 1){
          if (additionalSelector === 'Select one'){
            // Do nothing
          }
          else if (additionalSelector === 'Discount ( - )'){
            console.log(additionalItem, amount);
            printAdditionalItem(additionalItem, amount);
          }
          else if (additionalSelector === 'Tax Rate (%)'){
            console.log(additionalItem+' ('+additionalItemValue +'%)', amount);
            printAdditionalItem(additionalItem+' ('+additionalItemValue +'%)', amount);
          }
          else 
          {
            // Do nothing
          }
        // }

      });


      document.getElementById('previewSubtotalItem').textContent = document.getElementById('subtotalItem').textContent;
      document.getElementById('previewGrandTotal').textContent = document.getElementById('grandTotal').textContent;

      let bounderies = document.getElementById('invTemplate').getBoundingClientRect();
      console.log('item dim (h x w): '+ bounderies.height, bounderies.width );

      let width = document.getElementById('invTemplate').offsetWidth;
      let height = document.getElementById('invTemplate').offsetHeight;
      console.log('item dim in cm (h x w): '+ height*0.02645833, width*0.02645833 );

      if ( height*0.02645833 >= 29.7 && height*0.02645833 < 59.4){
        document.getElementById('invTemplate').style.height = '59.35cm'; // Slightly smaller than 59.4 - 2page
      }
      else if ( height*0.02645833 >= 59.4 && height*0.02645833 < 89.1){
        document.getElementById('invTemplate').style.height = '89.05cm';
      }
      else if ( height*0.02645833 >= 89.1 && height*0.02645833 < 118.8){
        document.getElementById('invTemplate').style.height = '118.75cm';
      }
      else if ( height*0.02645833 >= 118.8 && height*0.02645833 < 148.5){
        document.getElementById('invTemplate').style.height = '148.45cm';
      }
      else{
        // document.getElementById('invTemplate').style.height = 'auto';
      }
      

    }

    function printItem(desc, quantity, price, amount){
      // <tr class="item">
      //   <td style="font-size: small;"></td>
      //   <td style="text-align: right; font-size: small;"></td>
      //   <td style="text-align: right; font-size: small;"></td>
      //   <td style="text-align: right; font-size: small;"></td>
      // </tr>

      let td1 = document.createElement('td');
      td1.setAttribute('style', "font-size: small;");
      td1.textContent = desc

      let td2 = document.createElement('td');
      td2.setAttribute('style', "text-align: right; font-size: small;");
      td2.textContent = quantity

      let td3 = document.createElement('td');
      td3.setAttribute('style', "text-align: right; font-size: small;");
      td3.textContent = price

      let td4 = document.createElement('td');
      td4.setAttribute('style', "text-align: right; font-size: small;");
      td4.textContent = amount

      // Tr top
      let tr = document.createElement('tr');
      tr.className = 'item';
      tr.appendChild(td1);
      tr.appendChild(td2);
      tr.appendChild(td3);
      tr.appendChild(td4);

      const previewItemBody = document.getElementById('previewItemBody');
      const previewItemSubtotal = document.getElementById('previewItemSubtotal');
      previewItemBody.insertBefore(tr, previewItemSubtotal)
      // previewItemBody.insertBefore('#previewItemBody tr:nth-last-child(2)')
      // $( "#previewItemBody tr:nth-last-child(2)" ).append(tr);

      // previewItemBody.appendChild(tr);
    }


    function printAdditionalItem(additionalItem, amount){
    // <tr class="additional">
    //   <td></td>
    //   <td></td>
    //   <td style="text-align: right; font-size: small;"></td>
    //   <td style="text-align: right; font-size: small;"></td>
    // </tr>

      let td1 = document.createElement('td');
      let td2 = document.createElement('td');
      let td3 = document.createElement('td');
      td3.setAttribute('style', "text-align: right; font-size: small;");
      td3.textContent = additionalItem

      let td4 = document.createElement('td');
      td4.setAttribute('style', "text-align: right; font-size: small;");
      td4.textContent = amount

      // Tr top
      let tr = document.createElement('tr');
      tr.className = 'additional';
      tr.appendChild(td1);
      tr.appendChild(td2);
      tr.appendChild(td3);
      tr.appendChild(td4);

      const previewAdditionalItemBody = document.getElementById('previewAdditionalItemBody');
      // const previewItemSubtotal = document.getElementById('previewItemSubtotal');
      previewAdditionalItemBody.appendChild(tr);
    }


    // Rich Text Editor
    function invNotesOnChangeHandler() {
      // alert("Some one modified something");
      // alert("The HTML is now:" + inst.getBody().innerHTML);

      document.getElementById("previewInvNotes").innerHTML = tinymce.get("invNotes").getContent();

    }

    function invFooterNotesOnChangeHandler(inst) {
      // alert("Some one modified something");
      // alert("The HTML is now:" + inst.getBody().innerHTML);
      document.getElementById("previewInvFooterNotes").innerHTML = tinymce.get("invFooterNotes").getContent();

    }


    // Sign out
    function signOutFunction(){
      $('#signOutModal').modal('show');
      $("#signOutModal").appendTo("body");
    }
  
  </script>

  <script>
      var ID = ""; // Extract info from data-* attributes
      var NAME = ""; // Extract info from data-* attributes
      var PHONE = ""; // Extract info from data-* attributes
      var EMAIL = ""; // Extract info from data-* attributes
      var ADDRESS = ""; // Extract info from data-* attributes
		$( document ).ready(function() {




      // Drop down function
      // $("#sort-dropdown-menu .dropdown-item").click(function(){
        // $("#SortBy:first-child").text($(this).text());
        // $("#SortBy:first-child").val($(this).text());

        // 1. Duplicate a new row
        // 2. Change the 'Add item' => text, remove the exisiting dropdown and change it to input
        // 3. Add delete button to the first row. 

      // });

      // Find a <table> element with id="table":

      
      $('#addRow').on( 'click', function () {
        addRow();
        // <tr class="item">
        //   <td style="font-size: small;"></td>
        //   <td style="text-align: right; font-size: small;"></td>
        //   <td style="text-align: right; font-size: small;"></td>
        //   <td style="text-align: right; font-size: small;"></td>
        // </tr>

      });

      $('#addAdditionalRow').on( 'click', function () {
        addAdditionalRow();
      });

      // Populate the fields
      $('#addBusinessDetailModal').on('show.bs.modal', function (event) {
        document.getElementById("inName").value = document.getElementById("invBizName").textContent;
        document.getElementById("inDetails").textContent = document.getElementById("invBizDetails").textContent;
      });

      // Edit Business Details
      $('#btnAddBusinessDetailModalUpdate').on('click', function(){
        document.getElementById("invBizName").textContent =  document.getElementById("inName").value;
        let inPhone = document.getElementById("inContact").value;
        let inEmail = document.getElementById("inEmail").value;
        let inAddr = document.getElementById("inAddr").value;
        let invBizDetails = ''
        invBizDetails += (inPhone == null || inPhone == '')? '' : inPhone;
        invBizDetails += (inEmail == null || inEmail == '')? '' : ', <br>'+ inEmail;
        invBizDetails += (inAddr == null || inAddr == '')? '' : ', <br>'+ inAddr;

        document.getElementById("invBizDetails").innerHTML = invBizDetails;

        // Update preview
        document.getElementById("previewInvBizName").textContent = document.getElementById("inName").value;
        document.getElementById("previewInvBizDetails").innerHTML = invBizDetails;


      });
      
      // Counter, Autofiller
      $('#invTitle').on('input', function(){        
        document.getElementById("countTitle").textContent = this.value.length + '/40'
        document.getElementById("previewInvTitle").textContent = this.value;
      });

      $('#invNum').on('input', function(){        
        document.getElementById("previewInvNum").textContent = this.value;
      });
      $('#invIssueDate').on('input', function(){        
        document.getElementById("previewInvvIssueDate").textContent = this.value;
      });
      $('#invPaymentDue').on('input', function(){        
        document.getElementById("previewInvPaymentDue").textContent = this.value;
      });
      $('#invStatus').on('input', function(){        
        document.getElementById("previewStatus").textContent = this.value;
      });
      

      $('#invNotes').on('input', function(event){        
        document.getElementById("countNotes").textContent = this.value.length + '/250'
        document.getElementById("previewInvNotes").innerHTML = this.value;

      });

      $('#invFooterNotes').on('input', function(){        
        document.getElementById("countFooterNotes").textContent = this.value.length + '/250'
        document.getElementById("previewInvFooterNotes").textContent = this.value;
      });

      // Load all Admin Students
      $('#addStudentModal').on('show.bs.modal', function (event) {
        latestAdminStuDoc = null;
        loadAllAdminStudents();
      });

      // Remove all Admin Students when the Add Student Modal close
      $('#addStudentModal').on('hidden.bs.modal', function (event) {
        // NOTE: div:gt(4) - get the 5th div child in the parent node.
        $('#add-student-modal-container div:gt(4)').remove();

      });

      // Edit Client Modal on Load
      $('#editClientModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget) // Button/Components that triggered the modal
        ID = button.data('gurid') // Extract info from data-* attributes
        NAME = button.data('gurname') // Extract info from data-* attributes
        PHONE = button.data('gurphone') // Extract info from data-* attributes
        EMAIL = button.data('guremail') // Extract info from data-* attributes
        ADDRESS = button.data('guraddr') // Extract info from data-* attributes
        // Load Desription 
        document.getElementById("inClientId").setAttribute('value', ID);
        document.getElementById("inClientName").value = NAME;
        document.getElementById("inClientContact").value = PHONE;
        document.getElementById("inClientEmail").value = EMAIL;
        document.getElementById("inClientAddr").value = ADDRESS;

      });

      // Clear key and fields in modal when modal dismiss
      $('#editClientModal').on('hide.bs.modal', function (event) {
        ID = "";
        NAME = "";
        PHONE = "";
        EMAIL = "";
        ADDRESS = "";
        document.getElementById("inClientId").setAttribute('value', '');
        document.getElementById("inClientName").value = '';
        document.getElementById("inClientContact").value = '';
        document.getElementById("inClientEmail").value = '';
        document.getElementById("inClientAddr").value = '';
      });

      // Once confirmed, update the client view in Invoice
      $('#btnEditClientModalUpdate').on('click', function (e) {

        let clientName = document.getElementById("inClientName").value;
        let ClientId = document.getElementById("inClientId").getAttribute('value');
        let clientContact = document.getElementById("inClientContact").value;
        let ClientEmail = document.getElementById("inClientEmail").value;
        let ClientAddr = document.getElementById("inClientAddr").value;

        document.getElementById("invClientName").textContent = clientName;

        let clientDetails = '';
        clientDetails += (clientContact == null || clientContact == '')? '' : clientContact;
        clientDetails += (ClientEmail == null || ClientEmail == '')? '' : ', <br>' + ClientEmail;
        clientDetails += (ClientAddr == null || ClientAddr == '')? '' : ', <br>' + ClientAddr;
        document.getElementById("invClientDetails").innerHTML = clientDetails;


        // Update preview
        document.getElementById("previewInvClientName").textContent = clientName;
        document.getElementById("previewInvClientDetails").innerHTML = clientDetails;

        // Load all client's active class of this month.
        loadAllClientClassInfo(ClientId);
        
		  });
      


      $('#btnSignOutModalUpdate').on('click', function (e) {
      
        firebase.auth().signOut().then(() => {
            // Sign-out successful.
          }).catch((error) => {
            // window.alert("Logging out failed");
            func.showNotification('top','center', 'danger', 'error_outline', "Logging out failed." );

          });
        // Do something
        $('#signOutModal').modal('hide');
      });

      $('#btnSignOutModalClose1').on('click', function (e) {
        $('#signOutModal').modal('hide');
      });
      $('#btnSignOutModalClose2').on('click', function (e) {
        $('#signOutModal').modal('hide');
      });

		});

  </script>
  
  <!-- More functions -->
  <script>

    // Dealing with Textarea Height
    function calcHeight(value) {
      let numberOfLineBreaks = (value.match(/\n/g) || []).length;
      // min-height + lines x line-height + padding + border
      let newHeight = 20 + numberOfLineBreaks * 20 + 12 + 2;
      return newHeight;
    }

    // let textarea = document.querySelector(".resize-ta");
    // textarea.addEventListener("keyup", () => {
    //   textarea.style.height = calcHeight(textarea.value) + "px";
    // });

	  function editClassFunction(elem){
      // Get attribute and 
      if (JSON.parse(sessionStorage.getItem(SESSION_STORAGE_CLASS_ALL_DOCS_KEY)) == null ){
        console.log("Error: Impossible to reach this state");
        // Because this func only trigger when there's active class loaded
        return;
      }else{

        let classObj = null;
        let allClassList = null;

        // Set the fields
        allClassList = JSON.parse(sessionStorage.getItem(SESSION_STORAGE_CLASS_ALL_DOCS_KEY));
        // allClassList = classObj[SESSION_STORAGE_ALL_DOCS_KEY];
        allClassList.forEach((item) => {
          if (item.id === elem.getAttribute('data-id')){
            sessionStorage.setItem(SESSION_STORAGE_CLASS_CURRENT_DOC_KEY, JSON.stringify(item));
            sessionStorage.setItem(SESSION_STORAGE_CLASS_LOAD_KEY, true);
          }
          // window.location = './edit-class.html?id='+elem.getAttribute('data-id');
          window.location = './edit-class.html?id=';

          // console.log(item);
        });
        
      }
		}

  </script>

  <!-- Table Handler -->
  <script>
    // https://htmldom.dev/drag-and-drop-table-row/
    document.addEventListener('DOMContentLoaded', function () {
      table.querySelectorAll('tr').forEach(function (row, index) {
        // Ignore the header
        // We don't want user to change the order of header
        if (index === 0) {
            return;
        }
        // Ignore row with certain class name
        else if(row.className != 'item'){
          return;
        } 

        // console.log(row)
        // console.log(row.className)
        const firstCell = row.firstElementChild;
        firstCell.classList.add('draggable');
        firstCell.addEventListener('mousedown', mouseDownHandler);
      });
      assignDraggable();
    });
</script>
 




<script>
  // Generate PDF
  // https://ekoopmans.github.io/html2pdf.js/
  function generatePDFeKoopmans(id){

    element = document.getElementById(id);

    var opt = {
      margin:       [0, 0, 0, 0],
      filename:     'myfile.pdf',
      pagebreak:    { before: '.beforeClass', after: ['#after1', '#after2'], avoid: 'img' },
      image:        { type: 'jpeg', quality: 0.95 },
      html2canvas:  { scale: 2 },
      jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
    };

    html2pdf().set(opt).from(element).save();
  }

    function toDataURL(src, callback, outputFormat) {
    // var img = new Image();
    var img = document.getElementById("previewTutorImgUrl");
    var dataURL;
    // img.crossOrigin = 'Anonymous';
    img.onload = function() {
      var canvas = document.createElement('CANVAS');
      var ctx = canvas.getContext('2d');
      
      canvas.height = this.naturalHeight;
      canvas.width = this.naturalWidth;
      ctx.drawImage(this, 0, 0);
      dataURL = canvas.toDataURL(outputFormat);
      img.src = dataURL;
      callback(dataURL);
    };
    // img.src = src;
    // img.src = dataURL;
    if (img.complete || img.complete === undefined) {
      img.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";
      img.src = src;
    }
  }

  // toDataURL(
  //   'https://www.gravatar.com/avatar/d50c83cc0c6523b4d3f6085295c953e0',
  //   function(dataUrl) {
  //     // console.log('RESULT:', dataUrl)
  //   }
  // )
  
</script>

</body>

</html>