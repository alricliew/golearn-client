<!doctype html>
<html lang="en">

<head>
  <title>GoLearn</title>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <!-- Fonts and icons -->
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
  <script src="https://kit.fontawesome.com/2bdd669e92.js" crossorigin="anonymous"></script>
  <!-- Material Kit CSS -->
  <link href="../../assets/css/material-dashboard.css?v=2.1.2" rel="stylesheet" />
  <!-- Tutor specific css -->
  <link href="../../assets/css/tutor.css" rel="stylesheet" />
  <link href="../css/tutor-portal.css" rel="stylesheet" />
  <!-- Firebase Init -->
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-firestore.js"></script>
  <script src="../../assets/js/firebase.js"></script>
  <link href="../../assets/css/multitabform.css" rel="stylesheet" />
  <link href="../../assets/css/intlTelInput.css" rel="stylesheet">
</head>

<body>

  <div class="wrapper ">
    <div class="sidebar" data-color="purple" data-background-color="white" data-image="../../assets/img/sidebar-3.jpg">

      <div class="logo">
        <a href="../" class="simple-text logo-mini">
			    <img src="../../assets/img/logo.png" style="width: 216px; height: auto;" alt=""></img>
          
        </a>
        <a href="../" class="simple-text logo-normal">
          Welcome!
        </a>
      </div>
      <div class="sidebar-wrapper">
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link" href="../">
              <i class="material-icons">home</i>
              <p>Home</p>
            </a>
          </li>
		  		<li class="nav-item">
            <a class="nav-link" href="../class/">
              <i class="material-icons">school</i>
              <p>My Classes</p>
            </a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="./">
              <i class="material-icons">escalator_warning</i>
              <p>My Dependants</p>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="main-panel">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top ">
        <div class="container-fluid">
          <div class="navbar-wrapper">
            <a class="navbar-brand" href="javascript:;">Dependants <span><i class="material-icons" style="color: gray;">chevron_right</i></span> Edit Dependant</a>
          </div>

          <button class="navbar-toggler" type="button" data-toggle="collapse" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
          </button>
          <div class="collapse navbar-collapse justify-content-end">
            <form class="navbar-form">
              <!-- Put empty placeholder here -->
            </form>

            <ul class="navbar-nav">
              <li class="nav-item" id="activationNavItem">
                <a href="#" class="btn btn-danger btn-round" style="visibility: hidden;" id="btnActivateAccount" ></a>
              </li>
              <li class="nav-item">
                <a class="navbar-brand" href="javascript:;">
                   Hi <span id="user"></span> !
                </a> 
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link" href="javascript:;" id="navbarDropdownNotification" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="material-icons">notifications</i> Notifications
                </a>
                <!-- <a class="nav-link" href="http://example.com" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="material-icons">notifications</i>
                  <span class="notification">5</span>
                  <p class="d-lg-none d-md-block">
                    Some Actions
                  </p>
                </a> -->
								<div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
									<p style="padding: 1em;" >No notification</p>
                  <!-- <a class="dropdown-item" href="#">Mike John responded to your email</a>
                  <a class="dropdown-item" href="#">You have 5 new tasks</a>
                  <a class="dropdown-item" href="#">You're now friend with Andrew</a>
                  <a class="dropdown-item" href="#">Another Notification</a>
                  <a class="dropdown-item" href="#">Another One</a> -->
                </div>
              </li>
              <!-- your navbar here -->
			  
			  			<li class="nav-item dropdown">
                <a class="nav-link" href="javascript:;" id="navbarDropdownProfile" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="material-icons">person</i>
                  <p class="d-lg-none d-md-block">
                    Account
                  </p>
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownProfile">
                  <a class="dropdown-item" href="../edit-profile.html">Edit Profile</a>
									<a class="display:block; dropdown-item" href="../about.html">About</a>
									<div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="javascript:;" onclick="signOutFunction()" id="btn-logout">Log out</a>
									<!-- <div class="dropdown-divider"></div> -->
									<!-- <a style="font-weight: 500 ;padding: 0.5em ;text-align: center; width: 200px; background-color: #428dd4 ;display: block; color: #fff;" href="https://golearn.com.my/pricing/" target="_blank" id="btnUpgradeToPro">Upgrade to Pro</a> -->

                </div>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <!-- End Navbar -->

      <!-- Modal Start -->
      <!-- Save Data modal -->
      <div class="row">
        <div class="modal fade" id="saveModal" tabindex="-1" role="dialog" aria-labelledby="saveModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="saveLabel">Save</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="btnSaveModalClose1">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="saveModalBody">
                Are you sure you want to continue?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="btnSaveModalClose2">Cancel</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnSaveModalUpdate">Save</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sign-out modal -->
      <div class="row">
        <div class="modal fade" id="signOutModal" tabindex="-1" role="dialog" aria-labelledby="signOutModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="signOutLabel">Logging Out</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="btnSignOutModalClose1">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="signOutModalBody">
                Are you sure you want to continue?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="btnSignOutModalClose2">Cancel</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnSignOutModalUpdate">Confirm</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal End -->

      <div class="content">
        <div class="container-fluid">
          <div class="row" id="desciption-row" >
            <!-- Update button -->

            <div class="col-md-12 d-flex flex-row">
              <a href="./" class="btn btn-outline-primary btn-round" id="btnBack"><i class="material-icons" style="color: #2e74b6; margin-right: 0.5em; padding-bottom: 0.2em;">west</i> Back</a>
              <a href="javascript:;" class="btn btn-primary btn-round" id="btnSave"><i class="material-icons" style="color: #ffffff; margin-right: 0.5em; padding-bottom: 0.2em;">save</i> Save</a>
            </div>
          </div>

          <div class="container">
            <div class="row">
              <div class="col-md-12">
                <!--multitabs-form navbar-->
                <div class="row" >
                  <div class="col-12 col-lg-12 ml-auto mr-auto mb-4">
                    <div class="d-flex flex-wrap multitabs-form__progress">
                      <button class="multitabs-form__progress-btn js-active" type="button" title="Student Info">Profile</button>
                    </div>
                  </div>
                </div>

                <!--multitabs-form-->
                <div class="multitabs-form" id="multitabs_form">
                  <!--form panels-->
                  <div class="row">
                    <div class="col-12">
                      <form class="multitabs-form__form">
                        <!-- Form panel-->
                        <div class="multitabs-form__panel shadow p-4 rounded bg-white js-active" data-animation="scaleIn">
                          <h4 class="multitabs-form__title">Dependant Profile (Student / Child)</h4>
                          <div class="multitabs-form__content">
                            <!-- Student Info -->
                            <div class="row">
                               <!-- Name -->
                              <div class="col-md-6">
                                <div class="form-group">
                                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Full Name*</span> 
                                  <input type="text" class="form-control" id="inStuName" data-compulsory="true" oninput="this.className = 'form-control'">
                                </div>
                              </div>

                              <!-- Phone -->
                              <div class="col-md-6">
                                <div class="form-group" style="padding-bottom: 0;">
                                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Phone</span> 
                                </div>
                                <div class="form-group" style="margin-top: 0;">
                                  <!-- <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Phone*</span>  -->
                                  <!-- <i style="margin-right: 1rem;" class="material-icons">smartphone</i> -->
                                  <input id="phoneStudent" name="phone" type="tel" class="form-control" oninput="this.className = 'form-control'">
                                  <span id="valid-msg" class="hide" style="color: #42ba96;">✓ Valid</span>
                                  <span id="error-msg" class="hide" style="color: #F32013;"></span>
                                </div>
                              </div>
                            </div>
                              
                            <div class="row">
                              <!-- Email -->
                              <div class="col-md-6">
                                <div class="form-group" >
                                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Email</span> 
                                  <input type="text" class="form-control" id="inStuEmail" data-compulsory="false">
                                </div>
                              </div>

                              <!-- Gender -->
                              <div class="col-md-6">
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray; padding-right: 2rem;" >Gender</span> 
                                <div class="form-group" >
                                  <div class="form-check form-check-radio form-check-inline">
                                    <label class="form-check-label">
                                      <input class="form-check-input" type="radio" name="StudentGender" id="inStuMaleChecked" value="option1" data-compulsory="false" checked>
                                      Male
                                      <span class="circle">
                                        <span class="check"></span>
                                      </span>
                                    </label>
                                  </div>
                                  <div class="form-check form-check-radio form-check-inline">
                                    <label class="form-check-label">
                                      <input class="form-check-input" type="radio" name="StudentGender" id="inStuFemaleChecked" value="option2" data-compulsory="false">
                                      Female
                                      <span class="circle">
                                        <span class="check"></span>
                                      </span>
                                    </label>
                                  </div>
                                </div>
                              </div>
                            </div>

                            <div class="row">
                              <!-- School -->
                             <div class="col-md-12">
                               <div class="form-group">
                                 <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">School</span> 
                                 <input type="text" class="form-control" id="inStuSchool" data-compulsory="false">
                               </div>
                             </div>
                            </div>
  

                          </div>
                          <div style="margin: 2em;" ></div>
                          
                          <h4 class="multitabs-form__title">Guardian Profile</h4>
                          <div class="multitabs-form__content">

                            <!-- Guardian Info-->
                              <div class="row">
                                <!-- Name -->
                              <div class="col-md-6">
                                <div class="form-group">
                                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Name*</span> 
                                  <input type="text" class="form-control" id="inGurName" data-compulsory="true" oninput="this.className = 'form-control'" >
                                </div>
                              </div>

                              <!-- Phone -->
                              <div class="col-md-6">
                                <div class="form-group" style="padding-bottom: 0;">
                                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Phone</span> 
                                </div>
                                <div class="form-group" style="margin-top: 0;">
                                  <!-- <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Phone*</span>  -->
                                  <!-- <i style="margin-right: 1rem;" class="material-icons">smartphone</i> -->
                                  <input id="phoneGuardian" name="phone" type="tel" class="form-control" data-compulsory="true" oninput="this.className = 'form-control'" readonly>
                                </div>
                              </div>
                            </div>
                              
                            <div class="row">
                              <!-- Email -->
                              <div class="col-md-6">
                                <div class="form-group" >
                                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Email</span> 
                                  <input type="text" class="form-control" id="inGurEmail" data-compulsory="false">
                                </div>
                              </div>

                              <!-- Gender -->
                              <div class="col-md-6">
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray; padding-right: 2rem;" >Gender</span> 
                                <div class="form-group" >
                                  <div class="form-check form-check-radio form-check-inline">
                                    <label class="form-check-label">
                                      <input class="form-check-input" type="radio" name="GurdianGender" id="inGurMaleChecked" value="option1" data-compulsory="false" checked>
                                      Male
                                      <span class="circle">
                                        <span class="check"></span>
                                      </span>
                                    </label>
                                  </div>
                                  <div class="form-check form-check-radio form-check-inline">
                                    <label class="form-check-label">
                                      <input class="form-check-input" type="radio" name="GurdianGender" id="inGurFemaleChecked" value="option2" data-compulsory="false">
                                      Female
                                      <span class="circle">
                                        <span class="check"></span>
                                      </span>
                                    </label>
                                  </div>
                                </div>
                              </div>
                            </div>

                            <div class="row">
                              <!-- Relationship -->
                              <div class="col-md-6">
                                <span class="" style="font-size: smaller; font-weight: 300; color: gray; padding-right: 2rem;" >Relationship</span> 
                                <div class="form-group" >
                                  <div class="form-check form-check-radio form-check-inline">
                                    <label class="form-check-label">
                                      <input class="form-check-input" type="radio" name="GuardianRelationship" id="inRelParentsChecked" value="option1" data-compulsory="false" checked>
                                        Parents
                                      <span class="circle">
                                        <span class="check"></span>
                                      </span>
                                    </label>
                                  </div>
                                  <div class="form-check form-check-radio form-check-inline">
                                    <label class="form-check-label">
                                      <input class="form-check-input" type="radio" name="GuardianRelationship" id="inRelGurdianChecked" value="option2" data-compulsory="false">
                                        Legal Guardian
                                      <span class="circle">
                                        <span class="check"></span>
                                      </span>
                                    </label>
                                  </div>
                                </div>
                              </div>

                              <!-- Address -->
                              <div class="col-md-12">
                                <div class="form-group" style="margin-top: 1.5rem;" >
                                  <span class="" style="font-size: smaller; font-weight: 300; color: gray; margin-bottom: 0;">Address</span> 
                                  <textarea class="form-control" maxlength="511" rows="3" id="inGurAddress" data-compulsory="false" placeholder="Write something ..."></textarea>
                                </div>
                              </div>
                            </div>

                            <div class="row" style="margin-top: 0.5rem;">
                              <div class="col-md-6">
                                  <!-- State -->
                                <div class="form-group">
                                  <span class="" style="font-size: smaller; font-weight: 300; color: gray;">State</span> 
                                  <select class="form-control" name="tutor_course[]" id="state_drop" data-compulsory="false">
                                    <option value="">Select state</option>
                      
                                  </select>
                                </div>
                              </div>
                              <div class="col-md-6">
                                <!-- Area -->
                                <div class="form-group">
                                  <span class="" style="font-size: smaller; font-weight: 300; color: gray;" >Area</span>
                                  <select class="form-control" name="tutor_course[]" id="area_drop" data-compulsory="false">
                                    <option value="">Select area</option>
                                  </select>
                                </div>
                              </div>
                            </div>

                          </div>


                        </div>

                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
 

		    </div>
      </div>

      <footer class="footer">
        <div class="container-fluid">
          <nav class="float-left">
          <ul>
            <!-- <li>
            <a href="https://golearn.com.my" target="_blank">
              Visit GoLearn
            </a>
            </li> -->
          </ul>
          </nav>
          <!-- <div class="copyright float-right">
            &copy;
            <script>
              document.write(new Date().getFullYear())
            </script> 
            , made with <i class="material-icons">favorite</i> by <a href="#" >GoLearn Team</a>
          </div> -->
          <!-- your footer here -->
        </div>
      </footer>
    </div>
	  
  </div>
  
  <div class="fixed-plugin">
    <div class="dropdown show-dropdown">
      <a href="javascript:;" data-toggle="dropdown">
        <i class="material-icons" style="font-size: 36px; padding: 0.2em; color: white;">apps</i>
      </a>
      <ul class="dropdown-menu">
		    <br>
		    <li class="button-container text-center">
          <p style="margin : 0; font-size: 0.7rem; font-weight: 600; text-transform: uppercase;" >CONTACT US</p>
          <button id="twitter" style="background-color: #128C7E;" class="btn btn-round btn-facebook" onclick="location.href = 'https://api.whatsapp.com/send?phone=601115131661&text=Hello!%20I%27m%20looking%20for%20a%20tutor.';"><i class="fa fa-whatsapp"></i> &middot; Reply in 1 hour</button>
        </li>
        <br>
        <li class="button-container text-center">
          <p style="margin : 0; font-size: 0.7rem; font-weight: 600; text-transform: uppercase;" >I want more subjects.</p>
          <a href="https://golearn.com.my/request-a-tutor/" target="_blank" class="btn btn-primary btn-block">Request A Tutor Now</a>
        </li>
        <li class="button-container text-center">
          <p style="margin : 0; font-size: 0.7rem; font-weight: 600; text-transform: uppercase;" >Check us out now.</p>
          <a href="https://golearn.com.my/" target="_blank" class="btn btn-warning btn-block">
            Visit GoLearn
          </a>
        </li>
        <li class="button-container text-center">
          <p style="margin : 0; font-size: 0.7rem; font-weight: 600; text-transform: uppercase;" >CONTACT US</p>
			    <button id="facebook" class="btn btn-round btn-facebook" onclick="location.href = 'https://www.facebook.com/FindTutorInMalaysia/';"><i class="fa fa-facebook-f"></i> &middot; facebook</button>
          <button id="twitter"  class="btn btn-round btn-twitter" onclick="location.href = 'https://twitter.com/golearnmalaysia';"><i class="fa fa-twitter"></i> &middot; twitter</button>
          <br>
          <br>
        </li>
      </ul>
    </div>
  </div>
  
  <script src="../../assets/js/core/jquery.min.js"></script>
  <script src="../../assets/js/core/popper.min.js"></script>
  <script src="../../assets/js/core/bootstrap-material-design.min.js"></script>
  <script src="../../assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
  <!-- Plugin for the momentJs  -->
  <script src="../../assets/js/plugins/moment.min.js"></script>
  <!--  Plugin for Sweet Alert -->
  <script src="../../assets/js/plugins/sweetalert2.js"></script>
  <!-- Forms Validations Plugin -->
  <script src="../../assets/js/plugins/jquery.validate.min.js"></script>
  <!--  Notifications Plugin    -->
  <script src="../../assets/js/plugins/bootstrap-notify.js"></script>
  <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="../../assets/js/material-dashboard.js?v=2.1.2" type="text/javascript"></script>
  <!-- bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.min.js" integrity="sha384-lpyLfhYuitXl2zRZ5Bn2fqnhNAKOAaM/0Kr9laMspuaMiZfGmfwRNFh8HlMy49eQ"     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8" crossorigin="anonymous"></script>
  <!-- Common constants -->
  <script src="../../assets/js/common.js" type="text/javascript"></script>
  <!-- General Info -->
  <script src="../../assets/js/const.js" type="text/javascript"></script>
  <!-- Core Tutor Js -->
  <script src="../../assets/js/tutor-core.js" type="text/javascript"></script>
  <!-- International Telephone Input -->
  <script src="../../assets/js/plugins/intlTelInput/intlTelInput.js"></script>

  <script>
    // Global Variables
    var userId;
    var current_name, current_email, current_phone, current_imgUri, current_nric,
      current_address1, current_address2, current_addressPostCode, current_addressState, current_address;

		var db = firebase.firestore();
		db.settings({ timestampsInSnapshots: true });

    // Check the current CLASS in session Storage - Valid only if user come from class.html
    var currentDependantObj = null;
    getStudentObject()

    function getStudentObject(){
      // Check if there are valid class data in session storage.
      if (JSON.parse(sessionStorage.getItem(SESSION_STORAGE_DEPENDANT_CURRENT_DOC_KEY)) == null || 
        JSON.parse(sessionStorage.getItem(SESSION_STORAGE_DEPENDANT_CURRENT_DOC_KEY)).id == null || 
        JSON.parse(sessionStorage.getItem(SESSION_STORAGE_DEPENDANT_CURRENT_DOC_KEY)).id == '' ){
        // TODO: Flag warning
        return;
      }else{
        // Set the fields
        currentDependantObj = JSON.parse(sessionStorage.getItem(SESSION_STORAGE_DEPENDANT_CURRENT_DOC_KEY));
        // console.log(currentStudentObj);
        updatePageContent(currentDependantObj);
        return;

      }
    }

		firebase.auth().onAuthStateChanged(function(user){
      
			if(!user){
        // Return to login if user does not exist.
				window.location.href = "login.html"
			}else{
        // if the displayName is null, it means user register using Phone
        if (firebase.auth().currentUser.displayName == null ){
          userId = firebase.auth().currentUser.phoneNumber;
        }else
          userId = firebase.auth().currentUser.email.replace("[^a-zA-Z0-9]", "_").toLowerCase();

        loadUserInfo(userId);
        updateLastOnline(userId)

      }
		});

    // Tutor Specific
    function loadUserInfo(userId){
      // Tutor Id must be a phone with +60, no spacing or other chars
      var docRef = db.collection("Users").doc(userId);
      
      // docRef.get().then((doc) => {
      docRef.onSnapshot((doc) => {
        if (doc.exists) {
          // console.log("Document data:", doc.data());
          current_name = (doc.data().name == null || doc.data().name == "")? "New User" : doc.data().name;
          current_email = (doc.data().email == null || doc.data().email == "")? "" : doc.data().email;
          current_phone = (doc.data().phone == null || doc.data().phone == "")? "" : doc.data().phone; 
          current_imgUri = (doc.data().imgUrl == null || doc.data().imgUrl == "")? "../assets/img/empty-photo.png" : doc.data().imgUrl;
          current_address1= (doc.data().address1 == null || doc.data().address1 == "")? '' : doc.data().address1 + ', ';
          current_address2= (doc.data().address2 == null || doc.data().address2 == "")? '' : doc.data().address2 + ', '; 
          current_addressPostCode= (doc.data().addressPostCode == null || doc.data().addressPostCode == "")? '' : doc.data().addressPostCode + ', ';
          current_addressState= (doc.data().addressState == null || doc.data().addressState == "")? '' : doc.data().addressState;
          current_address = current_address1 + current_address2 + current_addressPostCode + current_addressState;

          // Set the nav user name and public profile link
          document.getElementById("user").textContent = doc.data().name;

        } 
        else {
          console.log("No user! Redirecting to login");
          window.location = "login.html"
          
        }
      });
    };

    // Update Last Online
    function updateLastOnline(userId){
      // Update last online
      var docRefDate = db.collection("Users").doc(userId);

      docRefDate.get().then((doc) => {
        if (doc.exists) {
          let docRef = db.collection("Users").doc(userId);
          let docRefWithMerge = docRef.set({
            [SYSTEM_LAST_ONLINE_KEY] : firebase.firestore.Timestamp.fromDate(new Date())
            }, { merge: true });
            
        } else {
            // doc.data() will be undefined in this case
            console.log("No such document!");
        }
      }).catch((error) => {
          console.log("Error getting document:", error);
      });
    }

    // Update the page content
    function updatePageContent(currentObj){
      console.log(currentObj)
      // Student Profile 
      document.getElementById("inStuName").value = currentObj[DEP_CHILD_NAME];
      document.getElementById("phoneStudent").value = currentObj[DEP_CHILD_PHONE];
      document.getElementById("inStuEmail").value = currentObj[DEP_CHILD_EMAIL];
      document.getElementById("inStuMaleChecked").checked = currentObj[DEP_CHILD_GENDER] === 0 ? true : false;
      document.getElementById("inStuFemaleChecked").checked = currentObj[DEP_CHILD_GENDER] === 1 ? true : false;
      document.getElementById("inStuSchool").value = currentObj[DEP_CHILD_SCHOOL];
      
      // Guardian Profile Panel
      document.getElementById("inGurName").value = currentObj[DEP_GUR_NAME];
      document.getElementById("phoneGuardian").value = currentObj[DEP_GUR_PHONE];
      document.getElementById("inGurEmail").value = currentObj[DEP_GUR_EMAIL];
      document.getElementById("inGurMaleChecked").checked = currentObj[DEP_GUR_GENDER] === 0 ? true : false;
      document.getElementById("inGurFemaleChecked").checked = currentObj[DEP_GUR_GENDER] === 1 ? true : false;
      document.getElementById("inRelParentsChecked").checked = currentObj[DEP_GUR_RELATIONSHIP] === DEP_GUR_RELATIONSHIP_PARENTS ? true : false;
      document.getElementById("inRelGurdianChecked").checked = currentObj[DEP_GUR_RELATIONSHIP] === DEP_GUR_RELATIONSHIP_GUARDIAN ? true : false;
      document.getElementById("inGurAddress").value = currentObj[DEP_GUR_ADDR];
    }

    // Add Dependant to DB
    function addDependantToDB(){
      var docRef = db.collection("Class")
          .doc("v1")
          .collection("Dependant")
          .doc(currentDependantObj[DEP_ID]);

      var data = {
        // [DEP_ID]: docRef.id,
        // [DEP_USER_ID]: userId,
        // [DEP_DATE_ADD]: new Date(),
        [DEP_DATE_EDIT]: new Date(),
        // [DEP_DATE_DEL]: '',
        // [DEP_STATUS]: true,

        [DEP_GUR_ID]: userId,
        [DEP_GUR_RELATIONSHIP]: document.getElementById("inRelParentsChecked").checked ? DEP_GUR_RELATIONSHIP_PARENTS : DEP_GUR_RELATIONSHIP_GUARDIAN,
        [DEP_GUR_NAME]: document.getElementById("inGurName").value,
        [DEP_GUR_PHONE]: current_phone,
        [DEP_GUR_GENDER]: document.getElementById("inGurMaleChecked").checked ? 0 : 1,
        [DEP_GUR_EMAIL]: document.getElementById("inGurEmail").value,
        [DEP_GUR_ADDR]: document.getElementById("inGurAddress").value,
        [DEP_GUR_STATE_ID]: gState,
        [DEP_GUR_AREA_ID]: gArea,
        
        [DEP_CHILD_ID]: itiPhone.getNumber(),
        [DEP_CHILD_NAME]: document.getElementById("inStuName").value,
        [DEP_CHILD_PHONE]: itiPhone.getNumber(),
        [DEP_CHILD_GENDER]: document.getElementById("inStuMaleChecked").checked ? 0 : 1,
        [DEP_CHILD_EMAIL]: document.getElementById("inStuEmail").value,
        [DEP_CHILD_SCHOOL]: document.getElementById("inStuSchool").value,
      }

      // console.log(data)
      var docRefWithMerge = docRef.set(data, { merge: true })
      .then(() => {
        window.location.href='./'
      });

    }


    // Sign out
    function signOutFunction(){
      $('#signOutModal').modal('show');
      $("#signOutModal").appendTo("body");
    }
  </script>

  <script>
    // Global variables
    var gState = currentDependantObj[DEP_GUR_STATE_ID];
    var gArea = currentDependantObj[DEP_GUR_AREA_ID];
    var gStateName='';
    var gAreaName ='';
		$( document ).ready(function() {



      // ------State Dropdown start------- //
      let state_select = document.getElementById("state_drop");
      for(i=1; i <= 100; i++){
        state_select.remove(1);
      }   
      for (let i = 0; i < MYAllState.length; i++) {
        let el = document.createElement("option");
        el.textContent = MYAllState[i];
        el.value = MYAllStateId[i];
        if (MYAllStateId[i] === currentDependantObj[DEP_GUR_STATE_ID]){
          el.selected = true;
        }
        state_select.appendChild(el);
      }   

      // Populate Area based on selected State
      $('#state_drop').on('change', function(){
          // Initialization
          // Reasign area after the statre change. It suppose to be defaulted to "Select area"
          gArea = ''; 
          gAreaName = ''; 

          // Get the val and txt of the selected state
          let StateId = $(this).val();
          let StateName = $(this).find("option:selected").text(); 
          gState = StateId;
          gStateName = StateName
          
          let select_area = document.getElementById("area_drop"); 
          // Clear the area option first, except the first one. 100 is just a magic number
          for(i=1; i <= 100; i++){
              select_area.remove(1);
          } 

          // Generate all cities based on stateId
          if  (!(StateId == "" || StateId == null )){
            let stateInfo = selectCityListBasedOnStateId (gState);
            for (let i = 0; i < stateInfo[0].length; i++) {
              let el = document.createElement("option");
              el.textContent = stateInfo[0][i];
              el.value = stateInfo[1][i];;
              select_area.appendChild(el);
            }
          }
      });
      
      // ------Area Dropdown Start------- //
      let select_area = document.getElementById("area_drop"); 
      for(i=1; i <= 100; i++){
          select_area.remove(1);
      }  
      if (!(currentDependantObj[DEP_GUR_STATE_ID] == null || currentDependantObj[DEP_GUR_STATE_ID] =='')){
        let cityInfo = selectCityListBasedOnStateId(currentDependantObj[DEP_GUR_STATE_ID]);
        let cityName = cityInfo[0];
        let cityId = cityInfo[1];
        for (let i = 0; i < cityName.length; i++) {
            let el = document.createElement("option");
            el.textContent = cityName[i];
            el.value = cityId[i];
            // Default selection based on existing class
            if (cityId[i] === currentDependantObj[DEP_GUR_AREA_ID]) {
              el.selected = true;
            }
            select_area.appendChild(el);
        }
      }
      $('#area_drop').on('change', function(){
          gArea = $(this).val() 
          gAreaName = $(this).find("option:selected").text(); 
      });

      // Update dependant data
      $('#btnSaveModalUpdate').on('click', function (event) {
        addDependantToDB();
        $('#saveModal').modal('hide');
      });

      // Update dependant data
      $('#btnSave').on('click', function (event) {
        // Validate compulsory input
        let fieldsValid = ValidateFields('multitabs_form');
        let y = document.querySelector("#phoneStudent");
        if (itiPhone.isValidNumber() || itiPhone.getNumber().length == 0){
        }else{
          y.className += ' invalid';
        }

        if ( fieldsValid && (itiPhone.isValidNumber() || itiPhone.getNumber().length == 0)){
          $('#saveModal').modal('show');
        }else{
          // Do nothing
        }
      });

      $('#btnSaveModalClose1').on('click', function (e) {
        $('#saveModal').modal('hide');
      });
      $('#btnSaveModalClose2').on('click', function (e) {
        $('#saveModal').modal('hide');
      });

      $('#btnSignOutModalUpdate').on('click', function (e) {
      
        firebase.auth().signOut().then(() => {
            // Sign-out successful.
          }).catch((error) => {
            window.alert("Logging out failed");
            func.showNotification('top','center', 'danger', 'error_outline', "Logging out failed." );
          });
        // Do something
        $('#signOutModal').modal('hide');
      });

      $('#btnSignOutModalClose1').on('click', function (e) {
        $('#signOutModal').modal('hide');
      });
      $('#btnSignOutModalClose2').on('click', function (e) {
        $('#signOutModal').modal('hide');
      });

    });

  </script>


  <!-- Tel input script -->
  <script>
    // Phone
    var inputPhone = document.querySelector("#phoneStudent");

    var itiPhone = intlTelInput(inputPhone,{
      autoHideDialCode: false,
      nationalMode: false,
      onlyCountries: ['MY', 'SG', 'TH', 'ID', 'VN', 'PH', 'BN', 'US', 'GB', 'SA'],
      preferredCountries: ['MY', 'SG'],
      separateDialCode: true,
      utilsScript: "../js/utils.js",
    });
   
    var errorMsg = document.querySelector("#error-msg");
    var validMsg = document.querySelector("#valid-msg");


    // here, the index maps to the error code returned from getValidationError - see readme
    var errorMap = ["Invalid number", "Invalid country code", "Too short", "Too long", "Invalid number"];

    var reset = function() {
      inputPhone.classList.remove("error");
      errorMsg.innerHTML = "";
      errorMsg.classList.add("hide");
      validMsg.classList.add("hide");
    };


    // on blur: validate
    
    inputPhone.addEventListener('blur', function() {
      reset();
      
      if (inputPhone.value.trim()) {
        if (itiPhone.isValidNumber()) {
          validMsg.classList.remove("hide");
        } else {
          inputPhone.classList.add("error");
          var errorCode = itiPhone.getValidationError();
          errorMsg.innerHTML = errorMap[errorCode];
          errorMsg.classList.remove("hide");
        }
      }
    });

    // on keyup / change flag: reset
    inputPhone.addEventListener('change', reset);
    inputPhone.addEventListener('keyup', reset);

    // Validate fields in based on parents. 
    function ValidateFields(parentId){
      // This function deals with validation of the form fields with data-compulsory = 'true'
      var x, y, i, valid = true;
      x = document.getElementById(parentId);
      
      y =x.querySelectorAll('[data-compulsory="true"]');

      // A loop that checks every input field in the current tab:
      for (i = 0; i < y.length; i++) {
        // console.log(y[i].value)
        // If a field is empty...
        if (y[i].value == "") {
          // add an "invalid" class to the field:
          y[i].className += " invalid";
          // and set the current valid status to false:
          valid = false;
        }
      }
      return valid; // return the valid status
    }

  </script>
 
</body>

</html>