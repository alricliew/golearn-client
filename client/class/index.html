<!doctype html>
<html lang="en">

<head>
  <title>GoLearn App</title>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <!-- Fonts and icons -->
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
  <script src="https://kit.fontawesome.com/2bdd669e92.js" crossorigin="anonymous"></script>
  <!-- Material Kit CSS -->
  <link href="../../assets/css/material-dashboard.css?v=2.1.2" rel="stylesheet" />
  <!-- Firebase Init -->
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-firestore.js"></script>
  <script src="../js/firebase.js"></script>
  <!-- Tutor Portal specific CSS -->
  <link href="../css/tutor-portal.css" rel="stylesheet" />
</head>

<body>

  <div class="wrapper ">
    <div class="sidebar" data-color="purple" data-background-color="white" data-image="../../assets/img/sidebar-3.jpg">
      <div class="logo">
        <a href="../" class="simple-text logo-mini">
			    <img src="../../assets/img/logo.png" style="width: 216px; height: auto;" alt=""></img>
        </a>
        <a href="../" class="simple-text logo-normal">
         Welcome!
        </a>
      </div>
      <div class="sidebar-wrapper">
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link" href="../">
              <i class="material-icons">home</i>
              <p>Home</p>
            </a>
          </li>
		  		<li class="nav-item active">
            <a class="nav-link" href="./">
              <i class="material-icons">school</i>
              <p>My Classes</p>
            </a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" href="../dependant/">
              <i class="material-icons">escalator_warning</i>
              <p>My Dependants</p>
            </a>
          </li>
		  		<!-- <li class="nav-item">
            <a class="nav-link" href="./job.html">
              <i class="material-icons">work_outline</i>
              <p>Tuition Jobs</p>
            </a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="./course.html">
              <i class="material-icons">format_list_bulleted</i>
              <p>My Courses</p>
            </a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" href="./update.html">
              <i class="material-icons">note_alt</i>
              <p>Update Information</p>
            </a>
          </li> -->
        </ul>
      </div>
    </div>
    <div class="main-panel">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top ">
        <div class="container-fluid">
          <div class="navbar-wrapper">
            <a class="navbar-brand" href="javascript:;">Classes</a>
          </div>
          <button class="navbar-toggler" type="button" data-toggle="collapse" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
          </button>
          <div class="collapse navbar-collapse justify-content-end">
            <form class="navbar-form">
              <!-- Put empty placeholder here -->
            </form>

            <ul class="navbar-nav">
              <li class="nav-item" id="activationNavItem">
                <a href="#" class="btn btn-danger btn-round" style="visibility: hidden;" id="btnActivateAccount" ></a>
              </li>
              <li class="nav-item">
                <a class="navbar-brand" href="javascript:;">
                   Hi <span id="user"></span> !
                </a> 
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link" href="javascript:;" id="navbarDropdownNotification" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="material-icons">notifications</i> Notifications
                </a>
                <!-- <a class="nav-link" href="http://example.com" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="material-icons">notifications</i>
                  <span class="notification">5</span>
                  <p class="d-lg-none d-md-block">
                    Some Actions
                  </p>
                </a> -->
								<div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
									<p style="padding: 1em;" >No notification</p>
                  <!-- <a class="dropdown-item" href="#">Mike John responded to your email</a>
                  <a class="dropdown-item" href="#">You have 5 new tasks</a>
                  <a class="dropdown-item" href="#">You're now friend with Andrew</a>
                  <a class="dropdown-item" href="#">Another Notification</a>
                  <a class="dropdown-item" href="#">Another One</a> -->
                </div>
              </li>
              <!-- your navbar here -->
			  
			  			<li class="nav-item dropdown">
                <a class="nav-link" href="javascript:;" id="navbarDropdownProfile" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="material-icons">person</i>
                  <p class="d-lg-none d-md-block">
                    Account
                  </p>
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownProfile">
                  <a class="dropdown-item" href="../edit-profile.html">Edit Profile</a>
									<a class="display:block; dropdown-item" href="../about.html">About</a>
									<div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="javascript:;" onclick="signOutFunction()" id="btn-logout">Log out</a>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <!-- End Navbar -->

			<!-- Modal Start -->	
      <!-- Sign Out modal -->
      <div class="row">
        <div class="modal fade" id="signOutModal" tabindex="-1" role="dialog" aria-labelledby="signOutModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="signOutLabel">Logging Out</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="btnSignOutModalClose1">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body" id="signOutModalBody">
                Are you sure you want to continue?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="btnSignOutModalClose2">Cancel</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnSignOutModalUpdate">Confirm</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Edit Class Modal -->
       <div class="row">
        <div class="modal fade" id="editClassModal" tabindex="-1" role="dialog" aria-labelledby="editClassModalLabel" aria-hidden="true">
          <div class="modal-dialog  modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="editClassModalLabel">Update Announcement</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <div class="form-group">
                  <textarea class="form-control" id="modalClassAnnouncement"maxlength="511"  rows="4" placeholder="Write something ..."></textarea>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnEditClassModalUpdate">Update</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Main content -->
      <div class="content">
        <div class="container-fluid">
          <!-- your content here -->
          <!-- All Class Start Here -->
          <div class="row" id="card-all-classes">
           
            <div class="col-md-12 card-student">
              <div class="row" >
                <div class="col-md-11" style="padding: 0;">
                  <div class="row" style="margin: 0;">
                    <div class="col-md-2">
                      <h6 style="font-weight: 600; color: #2e74b6; font-size: 0.8rem; margin: 0;" data-toggle="tooltip" title="No info">Class Name</h6>
                    </div>
                    <div class="col-md-3">
                      <h6 style="font-weight: 600; color: #2e74b6; font-size: 0.8rem; margin: 0;" data-toggle="tooltip" title="No info">Class Announcement</h6>
                    </div>
                    <div class="col-md-2">
                      <h6 style="font-weight: 600; color: #2e74b6; font-size: 0.8rem; margin: 0;" data-toggle="tooltip" title="No info">Schedule</h6>
                    </div>
                    <div class="col-md-2">
                      <h6 style="font-weight: 600; color: #2e74b6; font-size: 0.8rem; margin: 0;" data-toggle="tooltip" title="No info">Teacher</h6>
                    </div>
                    <div class="col-md-2">
                      <h6 style="font-weight: 600; color: #2e74b6; font-size: 0.8rem; margin: 0;" data-toggle="tooltip" title="No info">Last Update</h6>
                    </div>
                    <div class="col-md-1">
                      <h6 style="font-weight: 600; color: #2e74b6; font-size: 0.8rem; margin: 0;" data-toggle="tooltip" title="No info">Status</h6>
                    </div>
                  </div>
                </div>
                <div class="col-md-1">
                  <h6 style="font-weight: 600; color: #2e74b6; font-size: 0.8rem; margin: 0;" data-toggle="tooltip" title="No info">Action</h6>
                </div>

              </div>
            </div>

          </div>

          <!-- Load More -->
          <div class="row" id="desciption-row" >
            <div class="col-md-12 d-flex flex-row" style="margin-top: 1rem;">
              <a href="javascript:;" class="btn btn-outline-primary btn-round" id="btnClassLoadMore">Load More <i class="material-icons" style="color: #2e74b6; margin-left: 0.5em; padding-bottom: 0.2em;">expand_more</i></a>
            </div>
          </div>
        </div>
      </div>

      <footer class="footer">
        <div class="container-fluid">
          <nav class="float-left">
          <ul>
            <!-- <li>
            <a href="https://golearn.com.my/join-us" target="_blank">
              Visit GoLearn Tutor
            </a>
            </li> -->
          </ul>
          </nav>
        </div>
      </footer>
    </div>
	  
  </div>

  <div class="fixed-plugin">
    <div class="dropdown show-dropdown">
      <a href="javascript:;" data-toggle="dropdown">
        <i class="material-icons" style="font-size: 36px; padding: 0.2em; color: white;">apps</i>
      </a>
      <ul class="dropdown-menu">
		    <br>
		    <li class="button-container text-center">
          <p style="margin : 0; font-size: 0.7rem; font-weight: 600; text-transform: uppercase;" >CONTACT US</p>
          <button id="twitter" style="background-color: #128C7E;" class="btn btn-round btn-facebook" onclick="location.href = 'https://api.whatsapp.com/send?phone=601115131661&text=Hello!%20I%27m%20looking%20for%20a%20tutor.';"><i class="fa fa-whatsapp"></i> &middot; Reply in 1 hour</button>
        </li>
        <br>
        <li class="button-container text-center">
          <p style="margin : 0; font-size: 0.7rem; font-weight: 600; text-transform: uppercase;" >I want more subjects.</p>
          <a href="https://golearn.com.my/request-a-tutor/" target="_blank" class="btn btn-primary btn-block">Request A Tutor Now</a>
        </li>
        <li class="button-container text-center">
          <p style="margin : 0; font-size: 0.7rem; font-weight: 600; text-transform: uppercase;" >Check us out now.</p>
          <a href="https://golearn.com.my/" target="_blank" class="btn btn-warning btn-block">
            Visit GoLearn
          </a>
        </li>
        <li class="button-container text-center">
          <p style="margin : 0; font-size: 0.7rem; font-weight: 600; text-transform: uppercase;" >CONTACT US</p>
			    <button id="facebook" class="btn btn-round btn-facebook" onclick="location.href = 'https://www.facebook.com/FindTutorInMalaysia/';"><i class="fa fa-facebook-f"></i> &middot; facebook</button>
          <button id="twitter"  class="btn btn-round btn-twitter" onclick="location.href = 'https://twitter.com/golearnmalaysia';"><i class="fa fa-twitter"></i> &middot; twitter</button>
          <br>
          <br>
        </li>
      </ul>
    </div>
  </div>

  <script src="../../assets/js/core/jquery.min.js"></script>
  <script src="../../assets/js/core/popper.min.js"></script>
  <script src="../../assets/js/core/bootstrap-material-design.min.js"></script>
  <script src="../../assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
  <!-- Plugin for the momentJs  -->
  <script src="../../assets/js/plugins/moment.min.js"></script>
  <!--  Plugin for Sweet Alert -->
  <script src="../../assets/js/plugins/sweetalert2.js"></script>
  <!-- Forms Validations Plugin -->
  <script src="../../assets/js/plugins/jquery.validate.min.js"></script>
  <!--  Notifications Plugin    -->
  <script src="../../assets/js/plugins/bootstrap-notify.js"></script>
  <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="../../assets/js/material-dashboard.js?v=2.1.2" type="text/javascript"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.min.js" integrity="sha384-lpyLfhYuitXl2zRZ5Bn2fqnhNAKOAaM/0Kr9laMspuaMiZfGmfwRNFh8HlMy49eQ"     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8" crossorigin="anonymous"></script>
  <!-- Common constants -->
  <script src="../../assets/js/common.js" type="text/javascript"></script>
  <!-- General Info -->
  <script src="../../assets/js/const.js" type="text/javascript"></script>
  <!-- Core Tutor Js -->
  <script src="../../assets/js/tutor-core.js" type="text/javascript"></script>
	<script>
    // Global Variables
    var userId;
    var current_name, current_email, current_phone, current_imgUri, current_nric,
      current_address1, current_address2, current_addressPostCode, current_addressState, current_address;
  
    // Course-specific var
    var allCourseSize;

    var latestClassDoc = null;// Store last document - Used for Class Load More btn
    // Session Storage data
    var docsObj = [];


		var db = firebase.firestore();
		db.settings({ timestampsInSnapshots: true });

		firebase.auth().onAuthStateChanged(function(user){
      
			if(!user){
        // Return to login if user does not exist.
				window.location.href = "login.html"
			}else{
        // if the displayName is null, it means user register using Phone
        if (firebase.auth().currentUser.displayName == null ){
          userId = firebase.auth().currentUser.phoneNumber;
        }else
          userId = firebase.auth().currentUser.email.replace("[^a-zA-Z0-9]", "_").toLowerCase();

        loadUserInfo(userId)
        loadAllClassInfo();
          
			}
		});

    // Client Specific
    function loadUserInfo(userId){
      // Tutor Id must be a phone with +60, no spacing or other chars
      var docRef = db.collection("Users").doc(userId);
      
      // docRef.get().then((doc) => {
      docRef.onSnapshot((doc) => {
        if (doc.exists) {
          // console.log("Document data:", doc.data());
          current_name = (doc.data().name == null || doc.data().name == "")? "New User" : doc.data().name;
          current_email = (doc.data().email == null || doc.data().email == "")? "" : doc.data().email;
          current_phone = (doc.data().phone == null || doc.data().phone == "")? "" : doc.data().phone; 
          current_imgUri = (doc.data().imgUrl == null || doc.data().imgUrl == "")? "../assets/img/empty-photo.png" : doc.data().imgUrl;
          current_address1= (doc.data().address1 == null || doc.data().address1 == "")? '' : doc.data().address1 + ', ';
          current_address2= (doc.data().address2 == null || doc.data().address2 == "")? '' : doc.data().address2 + ', '; 
          current_addressPostCode= (doc.data().addressPostCode == null || doc.data().addressPostCode == "")? '' : doc.data().addressPostCode + ', ';
          current_addressState= (doc.data().addressState == null || doc.data().addressState == "")? '' : doc.data().addressState;
          current_address = current_address1 + current_address2 + current_addressPostCode + current_addressState;

          // Set the nav user name 
          document.getElementById("user").textContent = doc.data()[NAME_KEY];
        } 
        else {
          console.log("No user! Redirecting to login");
          window.location = "login.html"
          
        }
      });
    };



    //---------- Load all class details ----------//
    // Lesson Load More Button - Init
    const classLoadmore = document.querySelector('#btnClassLoadMore');
    classLoadmore.style.visibility='hidden';
    const classLoadMoreHandleClick = () =>{
      loadAllClassInfo();
    }
    classLoadmore.addEventListener('click', classLoadMoreHandleClick );

    // Client Specific
    function loadAllClassInfo(){
      var docRef = db.collection("Class")
          .doc("v1")
          .collection("Class")
          .where(CLASS_VIEWER_ID_ARR, "array-contains", userId)
          .where(STATUS_KEY, "==", true)
          .orderBy(CLASS_STATUS, 'asc')
          .orderBy(CLASS_NAME, 'asc')
          .startAfter(latestClassDoc)
          .limit(10);

      docRef
      .get()
      .then((querySnapshot) => {
        querySnapshot.forEach((doc) => {
          // console.log(doc.data())
          docsObj.push(doc.data());
          // courseId = doc.id;
          renderAllActiveClasses2(doc, "", false);

        });

        // Store in session storage
        sessionStorage.setItem(SESSION_STORAGE_CLIENT_CLASS_ALL_DOCS_KEY, JSON.stringify(docsObj));
        sessionStorage.setItem(SESSION_STORAGE_CLIENT_CLASS_CURRENT_DOC_KEY, null);

        // Load more handling
        latestClassDoc = querySnapshot.docs[querySnapshot.docs.length - 1];

        // Handle Lesson Load more btn
        if (querySnapshot.empty){
          classLoadmore.removeEventListener('click', classLoadMoreHandleClick );
        }
        if (querySnapshot.docs.length == 10){
          classLoadmore.style.visibility='visible';
        }else{
          classLoadmore.style.visibility='hidden';
        }
      });

    };


    function renderAllActiveClasses2(doc, courseId, renderNull){
    //   <div class="col-md-12 card-student-item">
    //   <div class="row">
    //     <div class="col-md-11" style="padding: 0;">
    //       <div class="row" style="margin: 0;">
    //         <div class="col-md-3">
    //           <p>Year 3 Std Mathematics</p>
    //         </div>
    //         <div class="col-md-4">
    //           <p>Class AnnoucementClass AnnoucementClass AnnoucementClass AnnoucementClass Annoucement</p>
    //         </div>
    //         <div class="col-md-2">
    //           <p >Tuesday 8:00am -</p>
    //         </div>
    //         <div class="col-md-2">
    //           <p>Cikgu Norhalizah Binti Mahmud</p>
    //         </div>
    //         <div class="col-md-1">
    //           <p class="card-student-status-label active">ACTIVE</p>
    //         </div>
    //       </div>
    //     </div>
    //     <div class="col-md-1">
      // <a href="#" style="margin: 0.1rem; padding: 0.3em; background-color: white;   box-shadow: 0 6px 10px rgba(0, 0, 0, 0.08), 0 0 6px rgba(0, 0, 0, 0.05);" class="btn btn-sm btn-outline-default btn-round" id="btnDelStudent" data-toggle="modal" data-target="#delStuModal" data-id="stuId" >
      //   <img id='inUrlGroupIcon' height="22" width="22" src="http://www.google.com/s2/favicons?domain=https://meet.google.com/" style="object-fit: cover; border-radius: 50%; "/>
      // </a>
      // <a href="#" style="margin: 0.1rem; padding: 0.3em;background-color: white;   box-shadow: 0 6px 10px rgba(0, 0, 0, 0.08), 0 0 6px rgba(0, 0, 0, 0.05);" class="btn btn-sm btn-outline-default btn-round" id="btnDelStudent" data-toggle="modal" data-target="#delStuModal" data-id="stuId" >
      //   <img id='inUrlGroupIcon' height="22" width="22" src="http://www.google.com/s2/favicons?domain=https://web.whatsapp.com/" style="object-fit: cover; border-radius: 50%; "/>
      // </a>
      // <a href="#" style="margin: 0.1rem; padding: 0.3em;background-color: white;   box-shadow: 0 6px 10px rgba(0, 0, 0, 0.08), 0 0 6px rgba(0, 0, 0, 0.05);" class="btn btn-sm btn-outline-default btn-round" id="btnDelStudent" data-toggle="modal" data-target="#delStuModal" data-id="stuId" >
      //   <img id='inUrlGroupIcon' height="22" width="22" src="http://www.google.com/s2/favicons?domain=https://golearn.com.my/" style="object-fit: cover; border-radius: 50%; "/>
      // </a>
    //     </div>
    //   </div>
    // </div>
      // Class Name
      let className_p = document.createElement('p');
      className_p.textContent = doc.data()[CLASS_NAME];
      let className_div = document.createElement('div');
      className_div.className = "col-md-2";
      className_div.appendChild(className_p);

      // Announcement
      let announcement_p = document.createElement('p');
      announcement_p.textContent = doc.data()[CLASS_ANNOUNCEMENT];
      let announcement_div = document.createElement('div');
      announcement_div.className = "col-md-3";
      announcement_div.appendChild(announcement_p);

      // Timeslot
      let myDayOfWeekId = MyDayOfWeekId; 
      let myDayOfWeek = MyDayOfWeek; 
      let timeslot = '';
      let startTime, endTime = '';

      for (let i = 0; i<doc.data()[CLASS_TIMESLOT_DAY_OF_WEEK_ARR].length; i++){
        if (doc.data()[CLASS_TIMESLOT_DAY_OF_WEEK_ARR][i] == null || doc.data()[CLASS_TIMESLOT_DAY_OF_WEEK_ARR][i] == ''){
          continue;
        }

        startTime = doc.data()[CLASS_TIMESLOT_START_ARR][i];
        endTime = doc.data()[CLASS_TIMESLOT_END_ARR][i];
        startTime = (parseInt(startTime.substring(0, 2))>12) ? (parseInt(startTime.substring(0, 2)) - 12) + startTime.substring(2, 5) + 'PM' : startTime + 'AM';
        endTime = (parseInt(endTime.substring(0, 2))>12) ? (parseInt(endTime.substring(0, 2)) - 12) + endTime.substring(2, 5) + 'PM' : endTime + 'AM';
        
        timeslot += myDayOfWeek[myDayOfWeekId.indexOf(doc.data()[CLASS_TIMESLOT_DAY_OF_WEEK_ARR][i])] +' '+startTime+'-'+endTime;
        // console.log
        if (i == doc.data()[CLASS_TIMESLOT_DAY_OF_WEEK_ARR].length - 1){
          // Last item
        }else{
          timeslot += ', '
        }
      }
      let timeslot_p = document.createElement('p');
      timeslot_p.textContent = timeslot;
      let timeSlot_div = document.createElement('div');
      timeSlot_div.className = "col-md-2";
      timeSlot_div.appendChild(timeslot_p);

      // Teacher
      let tutor_p = document.createElement('p');
      tutor_p.textContent = doc.data()[CLASS_TUTOR_NAME_ARR][0];
      let tutor_div = document.createElement('div');
      tutor_div.className = "col-md-2";
      tutor_div.appendChild(tutor_p);

      // Last Update
      let lastUpdate_p = document.createElement('p');
      lastUpdate_p.textContent = doc.data()[CLASS_DATE_EDIT].toDate().toLocaleDateString("en-GB") + ': '+ doc.data()[CLASS_EDIT_MSG] ;
      let lastUpdate_div = document.createElement('div');
      lastUpdate_div.className = "col-md-2";
      lastUpdate_div.appendChild(lastUpdate_p);

      // Status
      let status_p = document.createElement('p');
      status_p.textContent = doc.data()[CLASS_STATUS] === CLASS_STATUS_ACTIVE ? 'Active': 'Inactive';
      if (doc.data()[CLASS_STATUS] === CLASS_STATUS_ACTIVE){
        status_p.className = "card-student-status-label active";
      }else{
        status_p.className = "card-student-status-label pending";
      }
      let status_div = document.createElement('div');
      status_div.className = "col-md-1";
      status_div.appendChild(status_p);


      // Student Detail 
      let detail_div = document.createElement('div');
      detail_div.className = 'row';
      detail_div.setAttribute("style","margin: 0;");
      detail_div.appendChild(className_div);
      detail_div.appendChild(announcement_div);
      detail_div.appendChild(timeSlot_div);
      detail_div.appendChild(tutor_div);
      detail_div.appendChild(lastUpdate_div);
      detail_div.appendChild(status_div);
      let detail_top_div = document.createElement('div');
      detail_top_div.className = "col-md-11";
      detail_top_div.setAttribute("style","padding: 0;");
      detail_top_div.setAttribute("onclick","editClassFunction(this)");
      detail_top_div.setAttribute("data-id", doc.data().id);
      detail_top_div.appendChild(detail_div);

      //Del btn
      let btn_div = document.createElement('div');
      btn_div.className = "col-md-1";

      urlArray = [CLASS_CLASS_URL, CLASS_CHAT_GROUP_URL, CLASS_MATERIAL_URL];
      urlArray.forEach((item) => {
        // console.log(item);
          
        let UrlGroupUrl = '';
        let UrlGroupFaviconUrl = ''
        if (isValidHttpUrl(doc.data()[item])){
          UrlGroupUrl = doc.data()[item];
          UrlGroupFaviconUrl = "http://www.google.com/s2/favicons?domain="+doc.data()[item];
        }else{
          UrlGroupUrl = 'javascript:;';
          UrlGroupFaviconUrl = "../../assets/img/broken-link.png";
        }

        let urlGroupHtml = '';
        urlGroupHtml += "<img height='22' width='22' src=" + UrlGroupFaviconUrl + " style='object-fit: cover; border-radius: 50%;'/>";
        let btn_a = document.createElement('a');
        btn_a.innerHTML = urlGroupHtml;
        btn_a.className = "btn btn-sm btn-danger btn-round";
        // btn_a.setAttribute("id","btnDelStudent");
        btn_a.setAttribute("href", UrlGroupUrl);
        btn_a.setAttribute("target", 'blank');
        btn_a.setAttribute("style","margin: 0.1rem; padding: 0.3em; background-color: white; box-shadow: 2px 2px 4px rgba(46, 46, 46, 0.8);");

        // btn_a.setAttribute("style","margin: 0; padding: 0.3em;");
        // btn_a.setAttribute("data-toggle","modal");
        // btn_a.setAttribute("data-target","#delStuModal");
        // btn_a.setAttribute("data-id", doc.data().id);
        // btn_a.setAttribute("data-studentname",  doc.data().childName);

        if (isValidHttpUrl(doc.data()[item])){
          btn_div.appendChild(btn_a);
        }else{

        }
        
      });

      //Update btn
      // let blogsHtml_btn = '';
      // blogsHtml_btn += "<i class='material-icons'>campaign</i>";
      // let btn_announcement = document.createElement('a');
      // btn_announcement.innerHTML = blogsHtml_btn;
      // btn_announcement.className = "btn btn-primary btn-sm btn-round";
      // btn_announcement.setAttribute("style","background-color: white; color: #2e74b6; margin: 0.1rem; padding: 0.3rem; box-shadow: 2px 2px 4px rgba(46, 46, 46, 0.8);");
      // btn_announcement.setAttribute("data-toggle","modal");
      // btn_announcement.setAttribute("data-target","#editClassModal");
      // btn_announcement.setAttribute("data-id", doc.data().id);
      // if (doc.data().announcement == '' || doc.data().announcement == null){
      //   btn_announcement.setAttribute("data-announcement",  "");
      // }else{
      //   btn_announcement.setAttribute("data-announcement",  doc.data().announcement);
      // }
      // btn_div.appendChild(btn_announcement);

 
      // Student Top
      let card_div = document.createElement('div');
      card_div.className = "row"
      card_div.appendChild(detail_top_div);
      card_div.appendChild(btn_div);

      // Card top
      let card_top_div = document.createElement('div');
      card_top_div.className = "col-md-12 card-student-item"
      card_top_div.appendChild(card_div);

      const card_all_students = document.getElementById("card-all-classes");
      card_all_students.appendChild(card_top_div);

    }
    
    function renderAllActiveClasses(doc, courseId, renderNull){

      // subject
      let blogsHtml_subject = '';
      if (doc.data().online){
        blogsHtml_subject += doc.data()[CLASS_NAME]+"<span class='card-class-online-label'>OL</span>";
      }else{
        blogsHtml_subject += doc.data()[CLASS_NAME];
      }
      let subject_h4 = document.createElement('h4');
      subject_h4.innerHTML = blogsHtml_subject;

      // Update
      let lastUpdate_p = document.createElement('p');
      lastUpdate_p.className = "card-class-item";
      lastUpdate_p.setAttribute("style","font-size: x-small; line-height: 1.5em;");
      lastUpdate_p.textContent = 'Last updated: ' + doc.data()[CLASS_DATE_EDIT].toDate().toLocaleDateString("en-GB") + ' '+ doc.data()[CLASS_EDIT_MSG] ;

      // Announcement
      let blogsHtml_announcement = '';
      if (doc.data().announcement == '' || doc.data().announcement == null){
        blogsHtml_announcement += "<i class='fas fa-bullhorn fa-fw'></i>No recent announcement.";
      }else{
        blogsHtml_announcement += "<i class='fas fa-bullhorn fa-fw'></i>"+doc.data()[CLASS_ANNOUNCEMENT];
      }
      let announcement_p = document.createElement('p');
      announcement_p.className = "card-class-item";
      announcement_p.innerHTML = blogsHtml_announcement;
      let announcement_a = document.createElement('a');
      announcement_a.className = "card-class-item-wrapper"
      announcement_a.appendChild(announcement_p);
     // Timeslot
      let myDayOfWeekId = MyDayOfWeekId; 
      let myDayOfWeek = MyDayOfWeek; 
      let timeslot = '';
      let startTime, endTime = '';

      for (let i = 0; i<doc.data()[CLASS_TIMESLOT_DAY_OF_WEEK_ARR].length; i++){
        if (doc.data()[CLASS_TIMESLOT_DAY_OF_WEEK_ARR][i] == null || doc.data()[CLASS_TIMESLOT_DAY_OF_WEEK_ARR][i] == ''){
          continue;
        }

        startTime = doc.data()[CLASS_TIMESLOT_START_ARR][i];
        endTime = doc.data()[CLASS_TIMESLOT_END_ARR][i];
        // console.log(parseInt(startTime.substring(0, 2)))
        startTime = (parseInt(startTime.substring(0, 2))>12) ? (parseInt(startTime.substring(0, 2)) - 12) + startTime.substring(2, 5) + 'PM' : startTime + 'AM';
        endTime = (parseInt(endTime.substring(0, 2))>12) ? (parseInt(endTime.substring(0, 2)) - 12) + endTime.substring(2, 5) + 'PM' : endTime + 'AM';

        
        timeslot += myDayOfWeek[myDayOfWeekId.indexOf(doc.data()[CLASS_TIMESLOT_DAY_OF_WEEK_ARR][i])] +' '+startTime+'-'+endTime;
        // console.log
        if (i == doc.data()[CLASS_TIMESLOT_DAY_OF_WEEK_ARR].length - 1){
          // Last item
        }else{
          timeslot += ', '
        }
      }
      let blogsHtml_timeslot = '';
      blogsHtml_timeslot += "<i class='fas fa-calendar fa-fw'></i>"+timeslot;
      let timeslot_p = document.createElement('p');
      timeslot_p.className = "card-class-item";
      timeslot_p.innerHTML = blogsHtml_timeslot;
      let timeslot_a = document.createElement('a');
      timeslot_a.className = "card-class-item-wrapper"
      timeslot_a.appendChild(timeslot_p);
     // Venue
      let blogsHtml_student = '';
      blogsHtml_student += "<i class='fas fa-map-marker-alt fa-fw'></i>"+doc.data()[CLASS_VENUE];
      let student_p = document.createElement('p');
      student_p.className = "card-class-item";
      student_p.innerHTML = blogsHtml_student;
      let student_a = document.createElement('a');
      student_a.className = "card-class-item-wrapper"
      student_a.appendChild(student_p);
      // Teacher
      let blogsHtml_teacher = '';
      blogsHtml_teacher += "<i class='fas fa-chalkboard-teacher fa-fw'></i>"+doc.data()[CLASS_TUTOR_NAME_ARR][0];
      let teacher_p = document.createElement('p');
      teacher_p.className = "card-class-item";
      teacher_p.innerHTML = blogsHtml_teacher;
      let teacher_a = document.createElement('a');
      teacher_a.className = "card-class-item-wrapper"
      teacher_a.appendChild(teacher_p);

      // Card top
      let card_div = document.createElement('div');
      card_div.className = "card-class-wrapper"
      card_div.setAttribute("style","padding: 0;");
      card_div.setAttribute("onclick","editClassFunction(this)");
      card_div.setAttribute("data-id", doc.data().id);
      card_div.appendChild(subject_h4);
      card_div.appendChild(lastUpdate_p);
      card_div.appendChild(announcement_a);
      card_div.appendChild(timeslot_a);
      card_div.appendChild(student_a);
      card_div.appendChild(teacher_a);
      //Update btn
      let blogsHtml_btn = '';
      blogsHtml_btn += "Update <i class='fas fa-bullhorn fa-fw' style='margin-left: 0.5rem;'></i>";
      let btn_a = document.createElement('a');
      btn_a.innerHTML = blogsHtml_btn;
      btn_a.className = "btn btn-primary btn-round";
      btn_a.setAttribute("style","color: white;");
      btn_a.setAttribute("data-toggle","modal");
      btn_a.setAttribute("data-target","#editClassModal");
      btn_a.setAttribute("data-id", doc.data().id);
      if (doc.data().announcement == '' || doc.data().announcement == null){
        btn_a.setAttribute("data-announcement",  "");
      }else{
        btn_a.setAttribute("data-announcement",  doc.data().announcement);
      }

      // Create card-class
      let card_top_div = document.createElement('div');
      card_top_div.className = "card-class"
      card_top_div.appendChild(card_div);
      card_top_div.appendChild(btn_a);

      let card_top = document.createElement('div');
      card_top.className = "col-md-3 col-lg-3 col-sm-3";
      // If the course size is less than 2, we need to render empty placeholder so bootstrap looks good.
      if (renderNull){
        // render nothing
      }else{
        card_top.appendChild(card_top_div);
      }

      const card_all_courses = document.getElementById("card-all-classes");
      card_all_courses.appendChild(card_top);

    }

     
    // Check if valid url. Return true if valid.
    function isValidHttpUrl(string) {
      let url;
      try {
        url = new URL(string);
      } catch (_) {
        return false;  
      }
      return true;
    }
    // Sign out
    function signOutFunction(){
      $('#signOutModal').modal('show');
      $("#signOutModal").appendTo("body");
    }
  
  </script>

  <script>
		$( document ).ready(function() {
      // Class Announcement
      var KEY = ""; // Extract info from data-* attributes
      var DATETIME = ""; // Extract info from data-* attributes
      var ID = ""; // Extract info from data-* attributes
      var ANNOUNCEMENT = ""; // Extract info from data-* attributes

      // Update Class Annoucement
      $('#btnEditClassModalUpdate').on('click', function (e) {
        var docData = {
          [CLASS_ANNOUNCEMENT]: document.getElementById("modalClassAnnouncement").value,
          // [CLASS_DATE_ADD]: '',
          [CLASS_DATE_EDIT]: new Date(),
          // [CLASS_DATE_DEL]: '',
          [CLASS_EDIT_MSG]: 'New announcement from '+ current_name, // Update: CLASS_DATE_EDIT + CLASS_EDIT_MSG
        }
        // Set data
        db.collection("Class")        
          .doc("v1")
          .collection("Class")
          .doc(ID)
          .set(docData, {merge: true})
          .then(() => {
            window.location = './class.html';
          })
          .catch((error) => {
              console.error("Error writing document: ", error);
          });;

			  $('#editClassModal').modal('hide');
		  });

      $('#editClassModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget) // Button/Components that triggered the modal
        ID = button.data('id') // Extract info from data-* attributes
        ANNOUNCEMENT = button.data('announcement') // Extract info from data-* attributes
        // Load Desription 
        document.getElementById("modalClassAnnouncement").textContent = ANNOUNCEMENT;

      });
      
      // Clear key and fields in modal when modal dismiss
      $('#editClassModal').on('hide.bs.modal', function (event) {
        ID = "";
        ANNOUNCEMENT = "";
        document.getElementById("modalClassAnnouncement").textContent = "";
      });

      // Sign out
      $('#btnSignOutModalUpdate').on('click', function (e) {
        firebase.auth().signOut().then(() => {
            // Sign-out successful.
          }).catch((error) => {
            // window.alert("Logging out failed");
            func.showNotification('top','center', 'danger', 'error_outline', "Logging out failed." );

          });
        // Do something
        $('#signOutModal').modal('hide');
      });

      $('#btnSignOutModalClose1').on('click', function (e) {
        $('#signOutModal').modal('hide');
      });
      $('#btnSignOutModalClose2').on('click', function (e) {
        $('#signOutModal').modal('hide');
      });
    
		});

  </script>
  
  <!-- More functions -->
  <script>
	  function editClassFunction(elem){
      // Get attribute and 
      if (JSON.parse(sessionStorage.getItem(SESSION_STORAGE_CLIENT_CLASS_ALL_DOCS_KEY)) == null ){
        console.log("Error: Impossible to reach this state");
        // Because this func only trigger when there's active class loaded
        return;
      }else{

        let classObj = null;
        let allClassList = null;

        // Set the fields
        allClassList = JSON.parse(sessionStorage.getItem(SESSION_STORAGE_CLIENT_CLASS_ALL_DOCS_KEY));
        allClassList.forEach((item) => {
          if (item.id === elem.getAttribute('data-id')){
            sessionStorage.setItem(SESSION_STORAGE_CLIENT_CLASS_CURRENT_DOC_KEY, JSON.stringify(item));
          }
          window.location = './view-class.html';
        });
        
      }
		}

  </script>
 
</body>

</html>